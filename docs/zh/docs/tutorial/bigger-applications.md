# æ›´å¤§çš„åº”ç”¨ - å¤šä¸ªæ–‡ä»¶

å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ– Web APIï¼Œå¾ˆå°‘ä¼šå°†æ‰€æœ‰çš„å†…å®¹éƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

**FastAPI** æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„å·¥å…·ï¼Œå¯ä»¥åœ¨ä¿æŒæ‰€æœ‰çµæ´»æ€§çš„åŒæ—¶æ„å»ºä½ çš„åº”ç”¨ç¨‹åºã€‚

!!! info
    å¦‚æœä½ æ¥è‡ª Flaskï¼Œé‚£è¿™å°†ç›¸å½“äº Flask çš„ Blueprintsã€‚

## ä¸€ä¸ªæ–‡ä»¶ç»“æ„ç¤ºä¾‹

å‡è®¾ä½ çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š

```
.
â”œâ”€â”€ app
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ main.py
â”‚Â Â  â”œâ”€â”€ dependencies.py
â”‚Â Â  â””â”€â”€ routers
â”‚Â Â  â”‚   â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚   â”œâ”€â”€ items.py
â”‚Â Â  â”‚   â””â”€â”€ users.py
â”‚Â Â  â””â”€â”€ internal
â”‚Â Â      â”œâ”€â”€ __init__.py
â”‚Â Â      â””â”€â”€ admin.py
```

!!! tip
    ä¸Šé¢æœ‰å‡ ä¸ª `__init__.py` æ–‡ä»¶ï¼šæ¯ä¸ªç›®å½•æˆ–å­ç›®å½•ä¸­éƒ½æœ‰ä¸€ä¸ªã€‚

    è¿™å°±æ˜¯èƒ½å°†ä»£ç ä»ä¸€ä¸ªæ–‡ä»¶å¯¼å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶çš„åŸå› ã€‚

    ä¾‹å¦‚ï¼Œåœ¨ `app/main.py` ä¸­ï¼Œä½ å¯ä»¥æœ‰å¦‚ä¸‹ä¸€è¡Œï¼š

    ```
    from app.routers import items
    ```

* `app` ç›®å½•åŒ…å«äº†æ‰€æœ‰å†…å®¹ã€‚å¹¶ä¸”å®ƒæœ‰ä¸€ä¸ªç©ºæ–‡ä»¶ `app/__init__.py`ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªã€ŒPython åŒ…ã€ï¼ˆã€ŒPython æ¨¡å—ã€çš„é›†åˆï¼‰ï¼š`app`ã€‚
* å®ƒåŒ…å«ä¸€ä¸ª `app/main.py` æ–‡ä»¶ã€‚ç”±äºå®ƒä½äºä¸€ä¸ª Python åŒ…ï¼ˆä¸€ä¸ªåŒ…å« `__init__.py` æ–‡ä»¶çš„ç›®å½•ï¼‰ä¸­ï¼Œå› æ­¤å®ƒæ˜¯è¯¥åŒ…çš„ä¸€ä¸ªã€Œæ¨¡å—ã€ï¼š`app.main`ã€‚
* è¿˜æœ‰ä¸€ä¸ª `app/dependencies.py` æ–‡ä»¶ï¼Œå°±åƒ `app/main.py` ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªã€Œæ¨¡å—ã€ï¼š`app.dependencies`ã€‚
* æœ‰ä¸€ä¸ªå­ç›®å½• `app/routers/` åŒ…å«å¦ä¸€ä¸ª `__init__.py` æ–‡ä»¶ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªã€ŒPython å­åŒ…ã€ï¼š`app.routers`ã€‚
* æ–‡ä»¶ `app/routers/items.py` ä½äº `app/routers/` åŒ…ä¸­ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªå­æ¨¡å—ï¼š`app.routers.items`ã€‚
* åŒæ ·é€‚ç”¨äº `app/routers/users.py`ï¼Œå®ƒæ˜¯å¦ä¸€ä¸ªå­æ¨¡å—ï¼š`app.routers.users`ã€‚
* è¿˜æœ‰ä¸€ä¸ªå­ç›®å½• `app/internal/` åŒ…å«å¦ä¸€ä¸ª `__init__.py` æ–‡ä»¶ï¼Œå› æ­¤å®ƒæ˜¯åˆä¸€ä¸ªã€ŒPython å­åŒ…ã€ï¼š`app.internal`ã€‚
* `app/internal/admin.py` æ˜¯å¦ä¸€ä¸ªå­æ¨¡å—ï¼š`app.internal.admin`ã€‚

<img src="https://fastapi.tiangolo.com/img/tutorial/bigger-applications/package.svg">

å¸¦æœ‰æ³¨é‡Šçš„åŒä¸€æ–‡ä»¶ç»“æ„ï¼š

```
.
â”œâ”€â”€ app                  # ã€Œappã€æ˜¯ä¸€ä¸ª Python åŒ…
â”‚Â Â  â”œâ”€â”€ __init__.py      # è¿™ä¸ªæ–‡ä»¶ä½¿ã€Œappã€æˆä¸ºä¸€ä¸ª Python åŒ…
â”‚Â Â  â”œâ”€â”€ main.py          # ã€Œmainã€æ¨¡å—ï¼Œä¾‹å¦‚ import app.main
â”‚Â Â  â”œâ”€â”€ dependencies.py  # ã€Œdependenciesã€æ¨¡å—ï¼Œä¾‹å¦‚ import app.dependencies
â”‚Â Â  â””â”€â”€ routers          # ã€Œroutersã€æ˜¯ä¸€ä¸ªã€ŒPython å­åŒ…ã€
â”‚Â Â  â”‚   â”œâ”€â”€ __init__.py  # ä½¿ã€Œroutersã€æˆä¸ºä¸€ä¸ªã€ŒPython å­åŒ…ã€
â”‚Â Â  â”‚   â”œâ”€â”€ items.py     # ã€Œitemsã€å­æ¨¡å—ï¼Œä¾‹å¦‚ import app.routers.items
â”‚Â Â  â”‚   â””â”€â”€ users.py     # ã€Œusersã€å­æ¨¡å—ï¼Œä¾‹å¦‚ import app.routers.users
â”‚Â Â  â””â”€â”€ internal         # ã€Œinternalã€æ˜¯ä¸€ä¸ªã€ŒPython å­åŒ…ã€
â”‚Â Â      â”œâ”€â”€ __init__.py  # ä½¿ã€Œinternalã€æˆä¸ºä¸€ä¸ªã€ŒPython å­åŒ…ã€
â”‚Â Â      â””â”€â”€ admin.py     # ã€Œadminã€å­æ¨¡å—ï¼Œä¾‹å¦‚ import app.internal.admin
```

## `APIRouter`

å‡è®¾ä¸“é—¨ç”¨äºå¤„ç†ç”¨æˆ·é€»è¾‘çš„æ–‡ä»¶æ˜¯ä½äº `/app/routers/users.py` çš„å­æ¨¡å—ã€‚

ä½ å¸Œæœ›å°†ä¸ç”¨æˆ·ç›¸å…³çš„*è·¯å¾„æ“ä½œ*ä¸å…¶ä»–ä»£ç åˆ†å¼€ï¼Œä»¥ä½¿å…¶äº•äº•æœ‰æ¡ã€‚

ä½†å®ƒä»ç„¶æ˜¯åŒä¸€ **FastAPI** åº”ç”¨ç¨‹åº/web API çš„ä¸€éƒ¨åˆ†ï¼ˆå®ƒæ˜¯åŒä¸€ã€ŒPython åŒ…ã€çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚

ä½ å¯ä»¥ä½¿ç”¨ `APIRouter` ä¸ºè¯¥æ¨¡å—åˆ›å»º*è·¯å¾„æ“ä½œ*ã€‚

### å¯¼å…¥ `APIRouter`

ä½ å¯ä»¥å¯¼å…¥å®ƒå¹¶é€šè¿‡ä¸ `FastAPI` ç±»ç›¸åŒçš„æ–¹å¼åˆ›å»ºä¸€ä¸ªã€Œå®ä¾‹ã€ï¼š

```Python hl_lines="1  3"
{!../../../docs_src/bigger_applications/app/routers/users.py!}
```

### ä½¿ç”¨ `APIRouter` çš„*è·¯å¾„æ“ä½œ*

ç„¶åä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥å£°æ˜*è·¯å¾„æ“ä½œ*ã€‚

ä½¿ç”¨æ–¹å¼ä¸ `FastAPI` ç±»ç›¸åŒï¼š

```Python hl_lines="6  11  16"
{!../../../docs_src/bigger_applications/app/routers/users.py!}
```

ä½ å¯ä»¥å°† `APIRouter` è§†ä¸ºä¸€ä¸ªã€Œè¿·ä½  `FastAPI`ã€ç±»ã€‚

æ‰€æœ‰ç›¸åŒçš„é€‰é¡¹éƒ½å¾—åˆ°æ”¯æŒã€‚

æ‰€æœ‰ç›¸åŒçš„ `parameters`ã€`responses`ã€`dependencies`ã€`tags` ç­‰ç­‰ã€‚

!!! tip
    åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè¯¥å˜é‡è¢«å‘½åä¸º `router`ï¼Œä½†ä½ å¯ä»¥æ ¹æ®ä½ çš„æƒ³æ³•è‡ªç”±å‘½åã€‚

æˆ‘ä»¬å°†åœ¨ä¸» `FastAPI` åº”ç”¨ä¸­åŒ…å«è¯¥ `APIRouter`ï¼Œä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¾èµ–é¡¹å’Œå¦ä¸€ä¸ª `APIRouter`ã€‚

## ä¾èµ–é¡¹

æˆ‘ä»¬äº†è§£åˆ°æˆ‘ä»¬å°†éœ€è¦ä¸€äº›åœ¨åº”ç”¨ç¨‹åºçš„å¥½å‡ ä¸ªåœ°æ–¹æ‰€ä½¿ç”¨çš„ä¾èµ–é¡¹ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å°†å®ƒä»¬æ”¾åœ¨å®ƒä»¬è‡ªå·±çš„ `dependencies` æ¨¡å—ï¼ˆ`app/dependencies.py`ï¼‰ä¸­ã€‚

ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ä¾èµ–é¡¹æ¥è¯»å–ä¸€ä¸ªè‡ªå®šä¹‰çš„ `X-Token` è¯·æ±‚é¦–éƒ¨ï¼š

```Python hl_lines="1  4-6"
{!../../../docs_src/bigger_applications/app/dependencies.py!}
```

!!! tip
    æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨è™šæ„çš„è¯·æ±‚é¦–éƒ¨æ¥ç®€åŒ–æ­¤ç¤ºä¾‹ã€‚

    ä½†åœ¨å®é™…æƒ…å†µä¸‹ï¼Œä½¿ç”¨é›†æˆçš„[å®‰å…¨æ€§å®ç”¨å·¥å…·](./security/index.md){.internal-link target=_blank}ä¼šå¾—åˆ°æ›´å¥½çš„æ•ˆæœã€‚

## å…¶ä»–ä½¿ç”¨ `APIRouter` çš„æ¨¡å—

å‡è®¾ä½ åœ¨ä½äº `app/routers/items.py` çš„æ¨¡å—ä¸­è¿˜æœ‰ä¸“é—¨ç”¨äºå¤„ç†åº”ç”¨ç¨‹åºä¸­ã€Œé¡¹ç›®ã€çš„ç«¯ç‚¹ã€‚

ä½ å…·æœ‰ä»¥ä¸‹*è·¯å¾„æ“ä½œ*ï¼š

* `/items/`
* `/items/{item_id}`

è¿™å’Œ `app/routers/users.py` çš„ç»“æ„å®Œå…¨ç›¸åŒã€‚

ä½†æ˜¯æˆ‘ä»¬æƒ³å˜å¾—æ›´èªæ˜å¹¶ç®€åŒ–ä¸€äº›ä»£ç ã€‚

æˆ‘ä»¬çŸ¥é“æ­¤æ¨¡å—ä¸­çš„æ‰€æœ‰*è·¯å¾„æ“ä½œ*éƒ½æœ‰ç›¸åŒçš„ï¼š

* è·¯å¾„ `prefix`ï¼š`/items`ã€‚
* `tags`ï¼šï¼ˆä»…æœ‰ä¸€ä¸ª `items` æ ‡ç­¾ï¼‰ã€‚
* é¢å¤–çš„ `responses`ã€‚
* `dependencies`ï¼šå®ƒä»¬éƒ½éœ€è¦æˆ‘ä»¬åˆ›å»ºçš„ `X-Token` ä¾èµ–é¡¹ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ·»åŠ åˆ° `APIRouter` ä¸­ï¼Œè€Œä¸æ˜¯å°†å…¶æ·»åŠ åˆ°æ¯ä¸ªè·¯å¾„æ“ä½œä¸­ã€‚

```Python hl_lines="5-10  16  21"
{!../../../docs_src/bigger_applications/app/routers/items.py!}
```

ç”±äºæ¯ä¸ª*è·¯å¾„æ“ä½œ*çš„è·¯å¾„éƒ½å¿…é¡»ä»¥ `/` å¼€å¤´ï¼Œä¾‹å¦‚ï¼š

```Python hl_lines="1"
@router.get("/{item_id}")
async def read_item(item_id: str):
    ...
```

...å‰ç¼€ä¸èƒ½ä»¥ `/` ä½œä¸ºç»“å°¾ã€‚

å› æ­¤ï¼Œæœ¬ä¾‹ä¸­çš„å‰ç¼€ä¸º `/items`ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ª `tags` åˆ—è¡¨å’Œé¢å¤–çš„ `responses` åˆ—è¡¨ï¼Œè¿™äº›å‚æ•°å°†åº”ç”¨äºæ­¤è·¯ç”±å™¨ä¸­åŒ…å«çš„æ‰€æœ‰*è·¯å¾„æ“ä½œ*ã€‚

æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª `dependencies` åˆ—è¡¨ï¼Œè¿™äº›ä¾èµ–é¡¹å°†è¢«æ·»åŠ åˆ°è·¯ç”±å™¨ä¸­çš„æ‰€æœ‰*è·¯å¾„æ“ä½œ*ä¸­ï¼Œå¹¶å°†é’ˆå¯¹å‘å®ƒä»¬å‘èµ·çš„æ¯ä¸ªè¯·æ±‚æ‰§è¡Œ/è§£å†³ã€‚

!!! tip
    è¯·æ³¨æ„ï¼Œå’Œ[*è·¯å¾„æ“ä½œè£…é¥°å™¨*ä¸­çš„ä¾èµ–é¡¹](dependencies/dependencies-in-path-operation-decorators.md){.internal-link target=_blank}å¾ˆç±»ä¼¼ï¼Œæ²¡æœ‰å€¼ä¼šè¢«ä¼ é€’ç»™ä½ çš„*è·¯å¾„æ“ä½œå‡½æ•°*ã€‚

æœ€ç»ˆç»“æœæ˜¯é¡¹ç›®ç›¸å…³çš„è·¯å¾„ç°åœ¨ä¸ºï¼š

* `/items/`
* `/items/{item_id}`

...å¦‚æˆ‘ä»¬æ‰€æ„¿ã€‚

* å®ƒä»¬å°†è¢«æ ‡è®°ä¸ºä»…åŒ…å«å•ä¸ªå­—ç¬¦ä¸² `"items"` çš„æ ‡ç­¾åˆ—è¡¨ã€‚
    * è¿™äº›ã€Œæ ‡ç­¾ã€å¯¹äºè‡ªåŠ¨åŒ–äº¤äº’å¼æ–‡æ¡£ç³»ç»Ÿï¼ˆä½¿ç”¨ OpenAPIï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚
* æ‰€æœ‰çš„è·¯å¾„æ“ä½œéƒ½å°†åŒ…å«é¢„å®šä¹‰çš„ `responses`ã€‚
* æ‰€æœ‰çš„è¿™äº›*è·¯å¾„æ“ä½œ*éƒ½å°†åœ¨è‡ªèº«ä¹‹å‰è®¡ç®—/æ‰§è¡Œ `dependencies` åˆ—è¡¨ã€‚
    * å¦‚æœä½ è¿˜åœ¨ä¸€ä¸ªå…·ä½“çš„*è·¯å¾„æ“ä½œ*ä¸­å£°æ˜äº†ä¾èµ–é¡¹ï¼Œ**å®ƒä»¬ä¹Ÿä¼šè¢«æ‰§è¡Œ**ã€‚
    * è·¯ç”±å™¨çš„ä¾èµ–é¡¹æœ€å…ˆæ‰§è¡Œï¼Œç„¶åæ˜¯[è£…é¥°å™¨ä¸­çš„ `dependencies`](dependencies/dependencies-in-path-operation-decorators.md){.internal-link target=_blank}ï¼Œå†ç„¶åæ˜¯æ™®é€šçš„å‚æ•°ä¾èµ–é¡¹ã€‚
    * ä½ è¿˜å¯ä»¥æ·»åŠ [å…·æœ‰ `scopes` çš„ `Security` ä¾èµ–é¡¹](../advanced/security/oauth2-scopes.md){.internal-link target=_blank}ã€‚

!!! tip
    åœ¨ `APIRouter`ä¸­å…·æœ‰ `dependencies` å¯ä»¥ç”¨æ¥ï¼Œä¾‹å¦‚ï¼Œå¯¹ä¸€æ•´ç»„çš„*è·¯å¾„æ“ä½œ*è¦æ±‚èº«ä»½è®¤è¯ã€‚å³ä½¿è¿™äº›ä¾èµ–é¡¹å¹¶æ²¡æœ‰åˆ†åˆ«æ·»åŠ åˆ°æ¯ä¸ªè·¯å¾„æ“ä½œä¸­ã€‚

!!! check
    `prefix`ã€`tags`ã€`responses` ä»¥åŠ `dependencies` å‚æ•°åªæ˜¯ï¼ˆå’Œå…¶ä»–å¾ˆå¤šæƒ…å†µä¸€æ ·ï¼‰**FastAPI** çš„ä¸€ä¸ªç”¨äºå¸®åŠ©ä½ é¿å…ä»£ç é‡å¤çš„åŠŸèƒ½ã€‚

### å¯¼å…¥ä¾èµ–é¡¹

è¿™äº›ä»£ç ä½äº `app.routers.items` æ¨¡å—ï¼Œ`app/routers/items.py` æ–‡ä»¶ä¸­ã€‚

æˆ‘ä»¬éœ€è¦ä» `app.dependencies` æ¨¡å—å³ `app/dependencies.py` æ–‡ä»¶ä¸­è·å–ä¾èµ–å‡½æ•°ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡ `..` å¯¹ä¾èµ–é¡¹ä½¿ç”¨äº†ç›¸å¯¹å¯¼å…¥ï¼š

```Python hl_lines="3"
{!../../../docs_src/bigger_applications/app/routers/items.py!}
```

#### ç›¸å¯¹å¯¼å…¥å¦‚ä½•å·¥ä½œ

!!! tip
    å¦‚æœä½ å®Œå…¨äº†è§£å¯¼å…¥çš„å·¥ä½œåŸç†ï¼Œè¯·ä»ä¸‹é¢çš„ä¸‹ä¸€éƒ¨åˆ†ç»§ç»­ã€‚

ä¸€ä¸ªå•ç‚¹ `.`ï¼Œä¾‹å¦‚ï¼š

```Python
from .dependencies import get_token_header
```

è¡¨ç¤ºï¼š

* ä»è¯¥æ¨¡å—ï¼ˆ`app/routers/items.py` æ–‡ä»¶ï¼‰æ‰€åœ¨çš„åŒä¸€ä¸ªåŒ…ï¼ˆ`app/routers/` ç›®å½•ï¼‰å¼€å§‹...
* æ‰¾åˆ° `dependencies` æ¨¡å—ï¼ˆä¸€ä¸ªä½äº `app/routers/dependencies.py` çš„è™šæ„æ–‡ä»¶ï¼‰...
* ç„¶åä»ä¸­å¯¼å…¥å‡½æ•° `get_token_header`ã€‚

ä½†æ˜¯è¯¥æ–‡ä»¶å¹¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬çš„ä¾èµ–é¡¹ä½äº `app/dependencies.py` æ–‡ä»¶ä¸­ã€‚

è¯·è®°ä½æˆ‘ä»¬çš„ç¨‹åº/æ–‡ä»¶ç»“æ„æ˜¯æ€æ ·çš„ï¼š

<img src="https://fastapi.tiangolo.com/img/tutorial/bigger-applications/package.svg">

---

ä¸¤ä¸ªç‚¹ `..`ï¼Œä¾‹å¦‚ï¼š

```Python
from ..dependencies import get_token_header
```

è¡¨ç¤ºï¼š

* ä»è¯¥æ¨¡å—ï¼ˆ`app/routers/items.py` æ–‡ä»¶ï¼‰æ‰€åœ¨çš„åŒä¸€ä¸ªåŒ…ï¼ˆ`app/routers/` ç›®å½•ï¼‰å¼€å§‹...
* è·³è½¬åˆ°å…¶çˆ¶åŒ…ï¼ˆ`app/` ç›®å½•ï¼‰...
* åœ¨è¯¥çˆ¶åŒ…ä¸­ï¼Œæ‰¾åˆ° `dependencies` æ¨¡å—ï¼ˆä½äº `app/dependencies.py` çš„æ–‡ä»¶ï¼‰...
* ç„¶åä»ä¸­å¯¼å…¥å‡½æ•° `get_token_header`ã€‚

æ­£å¸¸å·¥ä½œäº†ï¼ğŸ‰

---

åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†ä¸‰ä¸ªç‚¹ `...`ï¼Œä¾‹å¦‚ï¼š

```Python
from ...dependencies import get_token_header
```

é‚£å°†æ„å‘³ç€ï¼š

* ä»è¯¥æ¨¡å—ï¼ˆ`app/routers/items.py` æ–‡ä»¶ï¼‰æ‰€åœ¨çš„åŒä¸€ä¸ªåŒ…ï¼ˆ`app/routers/` ç›®å½•ï¼‰å¼€å§‹...
* è·³è½¬åˆ°å…¶çˆ¶åŒ…ï¼ˆ`app/` ç›®å½•ï¼‰...
* ç„¶åè·³è½¬åˆ°è¯¥åŒ…çš„çˆ¶åŒ…ï¼ˆè¯¥çˆ¶åŒ…å¹¶ä¸å­˜åœ¨ï¼Œ`app` å·²ç»æ˜¯æœ€é¡¶å±‚çš„åŒ… ğŸ˜±ï¼‰...
* åœ¨è¯¥çˆ¶åŒ…ä¸­ï¼Œæ‰¾åˆ° `dependencies` æ¨¡å—ï¼ˆä½äº `app/` æ›´ä¸Šä¸€çº§ç›®å½•ä¸­çš„ `dependencies.py` æ–‡ä»¶ï¼‰...
* ç„¶åä»ä¸­å¯¼å…¥å‡½æ•° `get_token_header`ã€‚

è¿™å°†å¼•ç”¨ `app/` çš„å¾€ä¸Šä¸€çº§ï¼Œå¸¦æœ‰å…¶è‡ªå·±çš„ `__init __.py` ç­‰æ–‡ä»¶çš„æŸä¸ªåŒ…ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰è¿™ä¸ªåŒ…ã€‚å› æ­¤ï¼Œè¿™å°†åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­å¼•å‘é”™è¯¯ã€‚ğŸš¨

ä½†æ˜¯ç°åœ¨ä½ çŸ¥é“äº†å®ƒçš„å·¥ä½œåŸç†ï¼Œå› æ­¤æ— è®ºå®ƒä»¬å¤šä¹ˆå¤æ‚ï¼Œä½ éƒ½å¯ä»¥åœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ã€‚ğŸ¤“

### æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„ `tags`ã€`responses` å’Œ `dependencies`

æˆ‘ä»¬ä¸æ‰“ç®—åœ¨æ¯ä¸ª*è·¯å¾„æ“ä½œ*ä¸­æ·»åŠ å‰ç¼€ `/items` æˆ– `tags =["items"]`ï¼Œå› ä¸ºæˆ‘ä»¬å°†å®ƒä»¬æ·»åŠ åˆ°äº† `APIRouter` ä¸­ã€‚

ä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥æ·»åŠ *æ›´å¤š*å°†ä¼šåº”ç”¨äºç‰¹å®šçš„*è·¯å¾„æ“ä½œ*çš„ `tags`ï¼Œä»¥åŠä¸€äº›ç‰¹å®šäºè¯¥*è·¯å¾„æ“ä½œ*çš„é¢å¤– `responses`ï¼š

```Python hl_lines="30-31"
{!../../../docs_src/bigger_applications/app/routers/items.py!}
```

!!! tip
    æœ€åçš„è¿™ä¸ªè·¯å¾„æ“ä½œå°†åŒ…å«æ ‡ç­¾çš„ç»„åˆï¼š`["items"ï¼Œ"custom"]`ã€‚

    å¹¶ä¸”åœ¨æ–‡æ¡£ä¸­ä¹Ÿä¼šæœ‰ä¸¤ä¸ªå“åº”ï¼Œä¸€ä¸ªç”¨äº `404`ï¼Œä¸€ä¸ªç”¨äº `403`ã€‚

## `FastAPI` ä¸»ä½“

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä½äº `app/main.py` çš„æ¨¡å—ã€‚

åœ¨è¿™é‡Œä½ å¯¼å…¥å¹¶ä½¿ç”¨ `FastAPI` ç±»ã€‚

è¿™å°†æ˜¯ä½ çš„åº”ç”¨ç¨‹åºä¸­å°†æ‰€æœ‰å†…å®¹è”ç»“åœ¨ä¸€èµ·çš„ä¸»æ–‡ä»¶ã€‚

å¹¶ä¸”ç”±äºä½ çš„å¤§éƒ¨åˆ†é€»è¾‘ç°åœ¨éƒ½å­˜åœ¨äºå…¶è‡ªå·±çš„ç‰¹å®šæ¨¡å—ä¸­ï¼Œå› æ­¤ä¸»æ–‡ä»¶çš„å†…å®¹å°†éå¸¸ç®€å•ã€‚

### å¯¼å…¥ `FastAPI`

ä½ å¯ä»¥åƒå¹³å¸¸ä¸€æ ·å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª `FastAPI` ç±»ã€‚

æˆ‘ä»¬ç”šè‡³å¯ä»¥å£°æ˜[å…¨å±€ä¾èµ–é¡¹](dependencies/global-dependencies.md){.internal-link target=_blank}ï¼Œå®ƒä¼šå’Œæ¯ä¸ª `APIRouter` çš„ä¾èµ–é¡¹ç»„åˆåœ¨ä¸€èµ·ï¼š

```Python hl_lines="1  3  7"
{!../../../docs_src/bigger_applications/app/main.py!}
```

### å¯¼å…¥ `APIRouter`

ç°åœ¨ï¼Œæˆ‘ä»¬å¯¼å…¥å…·æœ‰ `APIRouter` çš„å…¶ä»–å­æ¨¡å—ï¼š

```Python hl_lines="5"
{!../../../docs_src/bigger_applications/app/main.py!}
```

ç”±äºæ–‡ä»¶ `app/routers/users.py` å’Œ `app/routers/items.py` æ˜¯åŒä¸€ Python åŒ… `app` ä¸€ä¸ªéƒ¨åˆ†çš„å­æ¨¡å—ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•ä¸ªç‚¹ ` .` é€šè¿‡ã€Œç›¸å¯¹å¯¼å…¥ã€æ¥å¯¼å…¥å®ƒä»¬ã€‚

### å¯¼å…¥æ˜¯å¦‚ä½•å·¥ä½œçš„

è¿™æ®µä»£ç ï¼š

```Python
from .routers import items, users
```

è¡¨ç¤ºï¼š

* ä»è¯¥æ¨¡å—ï¼ˆ`app/main.py` æ–‡ä»¶ï¼‰æ‰€åœ¨çš„åŒä¸€ä¸ªåŒ…ï¼ˆ`app/` ç›®å½•ï¼‰å¼€å§‹...
* å¯»æ‰¾ `routers` å­åŒ…ï¼ˆä½äº `app/routers/` çš„ç›®å½•ï¼‰...
* ä»è¯¥åŒ…ä¸­ï¼Œå¯¼å…¥å­æ¨¡å— `items` (ä½äº `app/routers/items.py` çš„æ–‡ä»¶) ä»¥åŠ `users` (ä½äº `app/routers/users.py` çš„æ–‡ä»¶)...

`items` æ¨¡å—å°†å…·æœ‰ä¸€ä¸ª `router` å˜é‡ï¼ˆ`items.router`ï¼‰ã€‚è¿™ä¸æˆ‘ä»¬åœ¨ `app/routers/items.py` æ–‡ä»¶ä¸­åˆ›å»ºçš„å˜é‡ç›¸åŒï¼Œå®ƒæ˜¯ä¸€ä¸ª `APIRouter` å¯¹è±¡ã€‚

ç„¶åæˆ‘ä»¬å¯¹ `users` æ¨¡å—è¿›è¡Œç›¸åŒçš„æ“ä½œã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒè¿™æ ·å¯¼å…¥å®ƒä»¬ï¼š

```Python
from app.routers import items, users
```

!!! info
    ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯ã€Œç›¸å¯¹å¯¼å…¥ã€ï¼š

    ```Python
    from .routers import items, users
    ```

    ç¬¬äºŒä¸ªç‰ˆæœ¬æ˜¯ã€Œç»å¯¹å¯¼å…¥ã€ï¼š

    ```Python
    from app.routers import items, users
    ```

    è¦äº†è§£æœ‰å…³ Python åŒ…å’Œæ¨¡å—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥é˜…<a href="https://docs.python.org/3/tutorial/modules.html" class="external-link" target="_blank">å…³äº Modules çš„ Python å®˜æ–¹æ–‡æ¡£</a>ã€‚

### é¿å…åç§°å†²çª

æˆ‘ä»¬å°†ç›´æ¥å¯¼å…¥ `items` å­æ¨¡å—ï¼Œè€Œä¸æ˜¯ä»…å¯¼å…¥å…¶ `router` å˜é‡ã€‚

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ `users` å­æ¨¡å—ä¸­ä¹Ÿæœ‰å¦ä¸€ä¸ªåä¸º `router` çš„å˜é‡ã€‚

å¦‚æœæˆ‘ä»¬ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å¯¼å…¥ï¼Œä¾‹å¦‚ï¼š

```Python
from .routers.items import router
from .routers.users import router
```

æ¥è‡ª `users` çš„ `router` å°†è¦†ç›–æ¥è‡ª `items` ä¸­çš„ `router`ï¼Œæˆ‘ä»¬å°†æ— æ³•åŒæ—¶ä½¿ç”¨å®ƒä»¬ã€‚

å› æ­¤ï¼Œä¸ºäº†èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬ç›´æ¥å¯¼å…¥å­æ¨¡å—ï¼š

```Python hl_lines="4"
{!../../../docs_src/bigger_applications/app/main.py!}
```

### åŒ…å« `users` å’Œ `items` çš„ `APIRouter`

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥åŒ…å«æ¥è‡ª `users` å’Œ `items` å­æ¨¡å—çš„ `router`ã€‚

```Python hl_lines="10-11"
{!../../../docs_src/bigger_applications/app/main.py!}
```

!!! info
    `users.router` åŒ…å«äº† `app/routers/users.py` æ–‡ä»¶ä¸­çš„ `APIRouter`ã€‚

    `items.router` åŒ…å«äº† `app/routers/items.py` æ–‡ä»¶ä¸­çš„ `APIRouter`ã€‚

ä½¿ç”¨ `app.include_router()`ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ª `APIRouter` æ·»åŠ åˆ°ä¸» `FastAPI` åº”ç”¨ç¨‹åºä¸­ã€‚

å®ƒå°†åŒ…å«æ¥è‡ªè¯¥è·¯ç”±å™¨çš„æ‰€æœ‰è·¯ç”±ä½œä¸ºå…¶ä¸€éƒ¨åˆ†ã€‚

!!! note "æŠ€æœ¯ç»†èŠ‚"
    å®é™…ä¸Šï¼Œå®ƒå°†åœ¨å†…éƒ¨ä¸ºå£°æ˜åœ¨ `APIRouter` ä¸­çš„æ¯ä¸ª*è·¯å¾„æ“ä½œ*åˆ›å»ºä¸€ä¸ª*è·¯å¾„æ“ä½œ*ã€‚

    æ‰€ä»¥ï¼Œåœ¨å¹•åï¼Œå®ƒå®é™…ä¸Šä¼šåƒæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸€æ ·å·¥ä½œã€‚

!!! check
    åŒ…å«è·¯ç”±å™¨æ—¶ï¼Œä½ ä¸å¿…æ‹…å¿ƒæ€§èƒ½é—®é¢˜ã€‚

    è¿™å°†èŠ±è´¹å‡ å¾®ç§’æ—¶é—´ï¼Œå¹¶ä¸”åªä¼šåœ¨å¯åŠ¨æ—¶å‘ç”Ÿã€‚

    å› æ­¤ï¼Œå®ƒä¸ä¼šå½±å“æ€§èƒ½ã€‚âš¡

### åŒ…å«ä¸€ä¸ªæœ‰è‡ªå®šä¹‰ `prefix`ã€`tags`ã€`responses` å’Œ `dependencies` çš„ `APIRouter`

ç°åœ¨ï¼Œå‡è®¾ä½ çš„ç»„ç»‡ä¸ºä½ æä¾›äº† `app/internal/admin.py` æ–‡ä»¶ã€‚

å®ƒåŒ…å«ä¸€ä¸ªå¸¦æœ‰ä¸€äº›ç”±ä½ çš„ç»„ç»‡åœ¨å¤šä¸ªé¡¹ç›®ä¹‹é—´å…±äº«çš„ç®¡ç†å‘˜*è·¯å¾„æ“ä½œ*çš„ `APIRouter`ã€‚

å¯¹äºæ­¤ç¤ºä¾‹ï¼Œå®ƒå°†éå¸¸ç®€å•ã€‚ä½†æ˜¯å‡è®¾ç”±äºå®ƒæ˜¯ä¸ç»„ç»‡ä¸­çš„å…¶ä»–é¡¹ç›®æ‰€å…±äº«çš„ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥åŠç›´æ¥åœ¨ `APIRouter` ä¸­æ·»åŠ  `prefix`ã€`dependencies`ã€`tags` ç­‰ï¼š

```Python hl_lines="3"
{!../../../docs_src/bigger_applications/app/internal/admin.py!}
```

ä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¸Œæœ›åœ¨åŒ…å« `APIRouter` æ—¶è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„ `prefix`ï¼Œä»¥ä¾¿å…¶æ‰€æœ‰*è·¯å¾„æ“ä½œ*ä»¥ `/admin` å¼€å¤´ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨æœ¬é¡¹ç›®å·²ç»æœ‰çš„ `dependencies` ä¿æŠ¤å®ƒï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›å®ƒåŒ…å«è‡ªå®šä¹‰çš„ `tags` å’Œ `responses`ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†è¿™äº›å‚æ•°ä¼ é€’ç»™ `app.include_router()` æ¥å®Œæˆæ‰€æœ‰çš„å£°æ˜ï¼Œè€Œä¸å¿…ä¿®æ”¹åŸå§‹çš„ `APIRouter`ï¼š

```Python hl_lines="14-17"
{!../../../docs_src/bigger_applications/app/main.py!}
```

è¿™æ ·ï¼ŒåŸå§‹çš„ `APIRouter` å°†ä¿æŒä¸å˜ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶å¯ä»¥ä¸ç»„ç»‡ä¸­çš„å…¶ä»–é¡¹ç›®å…±äº«ç›¸åŒçš„ `app/internal/admin.py` æ–‡ä»¶ã€‚

ç»“æœæ˜¯åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ¥è‡ª `admin` æ¨¡å—çš„æ¯ä¸ª*è·¯å¾„æ“ä½œ*éƒ½å°†å…·æœ‰ï¼š

* `/admin` å‰ç¼€ ã€‚
* `admin` æ ‡ç­¾ã€‚
* `get_token_header` ä¾èµ–é¡¹ã€‚
* `418` å“åº”ã€‚ ğŸµ

ä½†è¿™åªä¼šå½±å“æˆ‘ä»¬åº”ç”¨ä¸­çš„ `APIRouter`ï¼Œè€Œä¸ä¼šå½±å“ä½¿ç”¨å®ƒçš„ä»»ä½•å…¶ä»–ä»£ç ã€‚

å› æ­¤ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå…¶ä»–é¡¹ç›®èƒ½å¤Ÿä»¥ä¸åŒçš„èº«ä»½è®¤è¯æ–¹æ³•ä½¿ç”¨ç›¸åŒçš„ `APIRouter`ã€‚

### åŒ…å«ä¸€ä¸ª*è·¯å¾„æ“ä½œ*

æˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥å°†*è·¯å¾„æ“ä½œ*æ·»åŠ åˆ° `FastAPI` åº”ç”¨ä¸­ã€‚

è¿™é‡Œæˆ‘ä»¬è¿™æ ·åšäº†...åªæ˜¯ä¸ºäº†è¡¨æ˜æˆ‘ä»¬å¯ä»¥åšåˆ°ğŸ¤·ï¼š

```Python hl_lines="21-23"
{!../../../docs_src/bigger_applications/app/main.py!}
```

å®ƒå°†ä¸é€šè¿‡ `app.include_router()` æ·»åŠ çš„æ‰€æœ‰å…¶ä»–*è·¯å¾„æ“ä½œ*ä¸€èµ·æ­£å¸¸è¿è¡Œã€‚

!!! info "ç‰¹åˆ«çš„æŠ€æœ¯ç»†èŠ‚"
    **æ³¨æ„**ï¼šè¿™æ˜¯ä¸€ä¸ªéå¸¸æŠ€æœ¯æ€§çš„ç»†èŠ‚ï¼Œä½ ä¹Ÿè®¸å¯ä»¥**ç›´æ¥è·³è¿‡**ã€‚

    ---

    `APIRouter` æ²¡æœ‰è¢«ã€ŒæŒ‚è½½ã€ï¼Œå®ƒä»¬ä¸åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†æ²¡æœ‰éš”ç¦»ã€‚

    è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³è¦åœ¨ OpenAPI æ¨¡å¼å’Œç”¨æˆ·ç•Œé¢ä¸­åŒ…å«å®ƒä»¬çš„*è·¯å¾„æ“ä½œ*ã€‚

    ç”±äºæˆ‘ä»¬ä¸èƒ½ä»…ä»…éš”ç¦»å®ƒä»¬å¹¶ç‹¬ç«‹äºå…¶ä½™éƒ¨åˆ†æ¥ã€ŒæŒ‚è½½ã€å®ƒä»¬ï¼Œå› æ­¤*è·¯å¾„æ“ä½œ*æ˜¯è¢«ã€Œå…‹éš†çš„ã€ï¼ˆé‡æ–°åˆ›å»ºï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥åŒ…å«ã€‚

## æŸ¥çœ‹è‡ªåŠ¨åŒ–çš„ API æ–‡æ¡£

ç°åœ¨ï¼Œä½¿ç”¨ `app.main` æ¨¡å—å’Œ `app` å˜é‡è¿è¡Œ `uvicorn`ï¼š

<div class="termy">

```console
$ uvicorn app.main:app --reload

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

ç„¶åæ‰“å¼€ä½äº <a href="http://127.0.0.1:8000/docs" class="external-link" target="_blank">http://127.0.0.1:8000/docs</a> çš„æ–‡æ¡£ã€‚

ä½ å°†çœ‹åˆ°ä½¿ç”¨äº†æ­£ç¡®è·¯å¾„ï¼ˆå’Œå‰ç¼€ï¼‰å’Œæ­£ç¡®æ ‡ç­¾çš„è‡ªåŠ¨åŒ– API æ–‡æ¡£ï¼ŒåŒ…æ‹¬äº†æ¥è‡ªæ‰€æœ‰å­æ¨¡å—çš„è·¯å¾„ï¼š

<img src="https://fastapi.tiangolo.com/img/tutorial/bigger-applications/image01.png">

## å¤šæ¬¡ä½¿ç”¨ä¸åŒçš„ `prefix` åŒ…å«åŒä¸€ä¸ªè·¯ç”±å™¨

ä½ ä¹Ÿå¯ä»¥åœ¨*åŒä¸€*è·¯ç”±å™¨ä¸Šä½¿ç”¨ä¸åŒçš„å‰ç¼€æ¥å¤šæ¬¡ä½¿ç”¨ `.include_router()`ã€‚

åœ¨æœ‰äº›åœºæ™¯è¿™å¯èƒ½æœ‰ç”¨ï¼Œä¾‹å¦‚ä»¥ä¸åŒçš„å‰ç¼€å…¬å¼€åŒä¸€ä¸ªçš„ APIï¼Œæ¯”æ–¹è¯´ `/api/v1` å’Œ `/api/latest`ã€‚

è¿™æ˜¯ä¸€ä¸ªä½ å¯èƒ½å¹¶ä¸çœŸæ­£éœ€è¦çš„é«˜çº§ç”¨æ³•ï¼Œä½†ä¸‡ä¸€ä½ æœ‰éœ€è¦äº†å°±èƒ½å¤Ÿç”¨ä¸Šã€‚

## åœ¨å¦ä¸€ä¸ª `APIRouter` ä¸­åŒ…å«ä¸€ä¸ª `APIRouter`

ä¸åœ¨ `FastAPI` åº”ç”¨ç¨‹åºä¸­åŒ…å« `APIRouter` çš„æ–¹å¼ç›¸åŒï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å¦ä¸€ä¸ª `APIRouter` ä¸­åŒ…å« `APIRouter`ï¼Œé€šè¿‡ï¼š

```Python
router.include_router(other_router)
```

è¯·ç¡®ä¿åœ¨ä½ å°† `router` åŒ…å«åˆ° `FastAPI` åº”ç”¨ç¨‹åºä¹‹å‰è¿›è¡Œæ­¤æ“ä½œï¼Œä»¥ä¾¿ `other_router` ä¸­çš„`è·¯å¾„æ“ä½œ`ä¹Ÿèƒ½è¢«åŒ…å«è¿›æ¥ã€‚
