# 고급 의존성

## 매개변수화된 의존성

앞서 본 모든 의존성은 고정된 함수 또는 클래스였습니다.

그러나 매번 여러 가지 다른 함수나 클래스를 선언하지 않고도 의존성에 대해 매개변수를 설정해야 하는 경우가 있을 수 있습니다.

예를 들어, 쿼리 매개변수 `q`에 특정 내용을 포함하고 있는지 확인하는 의존성이 필요하다고 가정해봅시다.

여기서 이 특정한 내용을 매개변수화할 수 있어야 합니다.

## "호출 가능한" 인스턴스

Python에서는 클래스 인스턴스를 "호출 가능하게" 만드는 방법이 있습니다.

이때, 클래스 자체는 이미 호출 가능하지만, 여기서는 그 클래스의 인스턴스가 호출 가능해지도록 만드는 것입니다.

이를 위해 `__call__` 메서드를 선언합니다:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}

이 경우, 이 `__call__` 은 **FastAPI** 가 추가 매개변수 및 하위 의존성을 확인하는 데 사용하게 되며, 이는 나중에 *경로 작업 함수*에서 매개변수에 값을 전달할 때 호출됩니다.

## 인스턴스 매개변수화

이제 `__init__` 을 사용하여 인스턴스의 매개변수를 선언하고 이를 통해 의존성을 매개변수화할 수 있습니다.

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}

**FastAPI** 는 절대로 `__init__`에 관여하지 않으며, 우리는 코드 내에서 직접 사용하게 됩니다.

## 인스턴스 생성

이 클래스의 인스턴스를 다음과 같이 생성할 수 있습니다.

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}

이렇게 하면, 의존성에 `"bar"`가 포함되도록 "매개변수화"할 수 있으며, `checker.fixed_content` 속성에 "bar"가 저장됩니다.

## 인스턴스 의존성으로 사용하기

그 후, `Depends(FixedContentQueryChecker)` 대신 `Depends(checker)`를 사용하여 이 `checker` 인스턴스를 의존성으로 활용할 수 있습니다. 이는 의존성으로 사용하는 것이 클래스가 아닌 인스턴스 `checker`이기 때문입니다.

의존성을 해결할 때, **FastAPI**는 다음과 같이 `checker`를 호출합니다.

```Python
checker(q="somequery")
```

...그리고 그 결과는 *경로 작업 함수*의 매개변수 `fixed_content_included`에 의존성 값으로 전달됩니다.

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}

/// tip | 팁 

이 모든 내용이 다소 복잡하게 느껴질 수 있으며, 아직 그 유용성이 명확하지 않을 수 있습니다.

예제는 고의적으로 단순하게 구성하여 이 방식의 작동 원리를 보여줍니다.

보안 관련 장에서는 이와 동일한 방식으로 구현된 유틸리티 함수가 소개될 것입니다.

이 개념을 이해했다면, 이러한 보안 도구들이 내부적으로 어떻게 작동하는지 이미 이해한 것입니다.

///
