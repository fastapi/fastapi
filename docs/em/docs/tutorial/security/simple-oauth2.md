# ğŸ™… Oauth2ï¸âƒ£ â®ï¸ ğŸ” &amp; ğŸ“¨

ğŸ”œ â¡ï¸ ğŸ— âšªï¸â¡ï¸ â®ï¸ ğŸ“ƒ &amp; ğŸš® âŒ ğŸ• âœ”ï¸ ğŸ ğŸ’‚â€â™‚ ğŸ’§.

## ğŸ¤š `username` &amp; `password`

ğŸ‘¥ ğŸ”œ âš™ï¸ **FastAPI** ğŸ’‚â€â™‚ ğŸš™ ğŸ¤š `username` &amp; `password`.

Oauth2ï¸âƒ£ âœ” ğŸ‘ˆ ğŸ•â” âš™ï¸ "ğŸ” ğŸ’§" (ğŸ‘ˆ ğŸ‘¥ âš™ï¸) ğŸ‘©â€ğŸ’»/ğŸ‘©â€ğŸ’» ğŸ”œ ğŸ“¨ `username` &amp; `password` ğŸ‘ ğŸ“¨ ğŸ’½.

&amp; ğŸ”Œ ğŸ’¬ ğŸ‘ˆ ğŸ‘ âœ”ï¸ ğŸŒŸ ğŸ’– ğŸ‘ˆ. `user-name` âš–ï¸ `email` ğŸš«ğŸ”œ ğŸ‘·.

âœ‹ï¸ ğŸš« ğŸ˜Ÿ, ğŸ‘† ğŸ’ª ğŸ¦ âš«ï¸ ğŸ‘† ğŸ‹ ğŸ‘† ğŸ ğŸ‘©â€ğŸ’» ğŸ•¸.

&amp; ğŸ‘† ğŸ’½ ğŸ· ğŸ’ª âš™ï¸ ğŸ™† ğŸ ğŸ“› ğŸ‘† ğŸ’š.

âœ‹ï¸ ğŸ’³ *â¡ ğŸ› ï¸*, ğŸ‘¥ ğŸ’ª âš™ï¸ ğŸ‘‰ ğŸ“› ğŸ”— â®ï¸ ğŸ”Œ (&amp; ğŸ’ª, ğŸ–¼, âš™ï¸ ğŸ› ï¸ ğŸ› ï¸ ğŸ§¾ âš™ï¸).

ğŸ”Œ ğŸ‡µğŸ‡¸ ğŸ‘ˆ `username` &amp; `password` ğŸ”œ ğŸ“¨ ğŸ“¨ ğŸ’½ (, ğŸ™…â€â™‚ ğŸ» ğŸ“¥).

### `scope`

ğŸ”Œ ğŸ’¬ ğŸ‘ˆ ğŸ‘©â€ğŸ’» ğŸ’ª ğŸ“¨ â•1ï¸âƒ£ ğŸ“¨ ğŸ‘ "`scope`".

ğŸ“¨ ğŸ‘ ğŸ“› `scope` (â­), âœ‹ï¸ âš«ï¸ ğŸ¤™ ğŸ“ ğŸ» â®ï¸ "â†”" ğŸ ğŸš€.

ğŸ”  "â†”" ğŸ» (ğŸµ ğŸš€).

ğŸ‘« ğŸ› âš™ï¸ ğŸ“£ ğŸ¯ ğŸ’‚â€â™‚ âœ”, ğŸ–¼:

* `users:read` âš–ï¸ `users:write` âš  ğŸ–¼.
* `instagram_basic` âš™ï¸ ğŸ‘±ğŸ“” / ğŸ‘±ğŸ“”.
* `https://www.googleapis.com/auth/drive` âš™ï¸ ğŸ‡ºğŸ‡¸ğŸ”.

/// info

Oauth2ï¸âƒ£ "â†”" ğŸ» ğŸ‘ˆ ğŸ“£ ğŸ¯ âœ” âœ”.

âš«ï¸ ğŸš« ğŸ¤” ğŸš¥ âš«ï¸ âœ”ï¸ ğŸ ğŸ¦¹ ğŸ’– `:` âš–ï¸ ğŸš¥ âš«ï¸ ğŸ“›.

ğŸ‘ˆ â„¹ ğŸ› ï¸ ğŸ¯.

Oauth2ï¸âƒ£ ğŸ‘« ğŸ».

///

## ğŸ“Ÿ ğŸ¤š `username` &amp; `password`

ğŸ”œ â¡ï¸ âš™ï¸ ğŸš™ ğŸšš **FastAPI** ğŸµ ğŸ‘‰.

### `OAuth2PasswordRequestForm`

ğŸ¥‡, ğŸ—„ `OAuth2PasswordRequestForm`, &amp; âš™ï¸ âš«ï¸ ğŸ”— â®ï¸ `Depends` *â¡ ğŸ› ï¸* `/token`:

{* ../../docs_src/security/tutorial003.py hl[4,76] *}

`OAuth2PasswordRequestForm` ğŸ“ ğŸ”— ğŸ‘ˆ ğŸ“£ ğŸ“¨ ğŸ’ª â®ï¸:

*  `username`.
*  `password`.
* ğŸ“¦ `scope` ğŸ‘ ğŸ¦ ğŸ», âœ ğŸ» ğŸ ğŸš€.
* ğŸ“¦ `grant_type`.

/// tip

Oauth2ï¸âƒ£ ğŸ”Œ ğŸ¤™ *ğŸšš* ğŸ‘ `grant_type` â®ï¸ ğŸ”§ ğŸ’² `password`, âœ‹ï¸ `OAuth2PasswordRequestForm` ğŸš« ğŸ› ï¸ âš«ï¸.

ğŸš¥ ğŸ‘† ğŸ’ª ğŸ› ï¸ âš«ï¸, âš™ï¸ `OAuth2PasswordRequestFormStrict` â†©ï¸ `OAuth2PasswordRequestForm`.

///

* ğŸ“¦ `client_id` (ğŸ‘¥ ğŸš« ğŸ’ª âš«ï¸ ğŸ‘† ğŸ–¼).
* ğŸ“¦ `client_secret` (ğŸ‘¥ ğŸš« ğŸ’ª âš«ï¸ ğŸ‘† ğŸ–¼).

/// info

`OAuth2PasswordRequestForm` ğŸš« ğŸ ğŸ“ **FastAPI** `OAuth2PasswordBearer`.

`OAuth2PasswordBearer` âš’ **FastAPI** ğŸ’­ ğŸ‘ˆ âš«ï¸ ğŸ’‚â€â™‚ âš–. âš«ï¸ ğŸš® ğŸ‘ˆ ğŸŒŒ ğŸ—„.

âœ‹ï¸ `OAuth2PasswordRequestForm` ğŸ“ ğŸ”— ğŸ‘ˆ ğŸ‘† ğŸ’ª âœ”ï¸ âœ ğŸ‘†, âš–ï¸ ğŸ‘† ğŸ’ª âœ”ï¸ ğŸ“£ `Form` ğŸ”¢ ğŸ”—.

âœ‹ï¸ âš«ï¸ âš  âš™ï¸ ğŸ’¼, âš«ï¸ ğŸšš **FastAPI** ğŸ”—, âš’ âš«ï¸ â©.

///

### âš™ï¸ ğŸ“¨ ğŸ’½

/// tip

ğŸ‘ ğŸ”— ğŸ“ `OAuth2PasswordRequestForm` ğŸ† ğŸš« âœ”ï¸ ğŸ”¢ `scope` â®ï¸ ğŸ“ ğŸ» ğŸ‘½ ğŸš€, â†©ï¸, âš«ï¸ ğŸ”œ âœ”ï¸ `scopes` ğŸ”¢ â®ï¸ â˜‘ ğŸ“‡ ğŸ» ğŸ”  â†” ğŸ“¨.

ğŸ‘¥ ğŸš« âš™ï¸ `scopes` ğŸ‘‰ ğŸ–¼, âœ‹ï¸ ğŸ› ï¸ ğŸ“¤ ğŸš¥ ğŸ‘† ğŸ’ª âš«ï¸.

///

ğŸ”œ, ğŸ¤š ğŸ‘©â€ğŸ’» ğŸ“Š âšªï¸â¡ï¸ (âŒ) ğŸ’½, âš™ï¸ `username` âšªï¸â¡ï¸ ğŸ“¨ ğŸ‘.

ğŸš¥ ğŸ“¤ ğŸ™…â€â™‚ âœ… ğŸ‘©â€ğŸ’», ğŸ‘¥ ğŸ“¨ âŒ ğŸ’¬ "âŒ ğŸ†” âš–ï¸ ğŸ”".

âŒ, ğŸ‘¥ âš™ï¸ âš  `HTTPException`:

{* ../../docs_src/security/tutorial003.py hl[3,77:79] *}

### âœ… ğŸ”

ğŸ‘‰ â˜ ğŸ‘¥ âœ”ï¸ ğŸ‘©â€ğŸ’» ğŸ“Š âšªï¸â¡ï¸ ğŸ‘† ğŸ’½, âœ‹ï¸ ğŸ‘¥ ğŸš« âœ… ğŸ”.

â¡ï¸ ğŸš® ğŸ‘ˆ ğŸ’½ Pydantic `UserInDB` ğŸ· ğŸ¥‡.

ğŸ‘† ğŸ”œ ğŸ™… ğŸ–Š ğŸ”¢ ğŸ”,, ğŸ‘¥ ğŸ”œ âš™ï¸ (âŒ) ğŸ” ğŸ” âš™ï¸.

ğŸš¥ ğŸ” ğŸš« ğŸ, ğŸ‘¥ ğŸ“¨ ğŸ âŒ.

#### ğŸ” ğŸ”

"ğŸ”" â›“: ğŸ­ ğŸš (ğŸ” ğŸ‘‰ ğŸ’¼) ğŸ”˜ ğŸ” ğŸ”¢ (ğŸ») ğŸ‘ˆ ğŸ‘€ ğŸ’– ğŸ™ƒ.

ğŸ•â” ğŸ‘† ğŸš¶â€â™€ï¸ âš«ï¸â” ğŸ ğŸš (âš«ï¸â” ğŸ ğŸ”) ğŸ‘† ğŸ¤š âš«ï¸â” ğŸ ğŸ™ƒ.

âœ‹ï¸ ğŸ‘† ğŸš«ğŸ”œ ğŸ—œ âšªï¸â¡ï¸ ğŸ™ƒ ğŸ”™ ğŸ”.

##### âš«ï¸â” âš™ï¸ ğŸ” ğŸ”

ğŸš¥ ğŸ‘† ğŸ’½ ğŸ“, ğŸ§™â€â™€ ğŸ† ğŸš« âœ”ï¸ ğŸ‘† ğŸ‘©â€ğŸ’»' ğŸ”¢ ğŸ”, ğŸ•´#ï¸âƒ£.

, ğŸ§™â€â™€ ğŸ† ğŸš« ğŸ’ª ğŸ”„ âš™ï¸ ğŸ‘ˆ ğŸ ğŸ” â•1ï¸âƒ£ âš™ï¸ (ğŸ“š ğŸ‘©â€ğŸ’» âš™ï¸ ğŸ ğŸ” ğŸŒ, ğŸ‘‰ ğŸ”œ âš ).

{* ../../docs_src/security/tutorial003.py hl[80:83] *}

#### ğŸ”ƒ `**user_dict`

`UserInDB(**user_dict)` â›“:

*ğŸš¶â€â™€ï¸ ğŸ”‘ &amp; ğŸ’² `user_dict` ğŸ”— ğŸ”‘-ğŸ’² âŒ, ğŸŒ“:*

```Python
UserInDB(
    username = user_dict["username"],
    email = user_dict["email"],
    full_name = user_dict["full_name"],
    disabled = user_dict["disabled"],
    hashed_password = user_dict["hashed_password"],
)
```

/// info

ğŸŒ… ğŸ ğŸ”‘ `**ğŸ‘©â€ğŸ’»_ #ï¸âƒ£ ` âœ… ğŸ”™ [ğŸ§¾ **â• ğŸ·**](../extra-models.md#user_indict){.internal-link target=_blank}.

///

## ğŸ“¨ ğŸ¤

ğŸ“¨ `token` ğŸ”— ğŸ”œ ğŸ» ğŸš.

âš«ï¸ ğŸ”œ âœ”ï¸ `token_type`. ğŸ‘† ğŸ’¼, ğŸ‘¥ âš™ï¸ "ğŸ“¨" ğŸ¤, ğŸ¤ ğŸ† ğŸ”œ "`bearer`".

&amp; âš«ï¸ ğŸ”œ âœ”ï¸ `access_token`, â®ï¸ ğŸ» âš— ğŸ‘† ğŸ” ğŸ¤.

ğŸ‘‰ ğŸ™… ğŸ–¼, ğŸ‘¥ ğŸ”œ ğŸ• ğŸ˜Ÿ &amp; ğŸ“¨ ğŸ `username` ğŸ¤.

/// tip

â­ ğŸ“ƒ, ğŸ‘† ğŸ”œ ğŸ‘€ ğŸ° ğŸ” ğŸ› ï¸, â®ï¸ ğŸ” #ï¸âƒ£ &amp; <abbr title="JSON Web Tokens">ğŸ¥™</abbr> ğŸ¤.

âœ‹ï¸ ğŸ”œ, â¡ï¸ ğŸ¯ ğŸ”› ğŸ¯ â„¹ ğŸ‘¥ ğŸ’ª.

///

{* ../../docs_src/security/tutorial003.py hl[85] *}

/// tip

ğŸ”Œ, ğŸ‘† ğŸ”œ ğŸ“¨ ğŸ» â®ï¸ `access_token` &amp; `token_type`, ğŸ ğŸ‘‰ ğŸ–¼.

ğŸ‘‰ ğŸ•³ ğŸ‘ˆ ğŸ‘† âœ”ï¸ ğŸ‘† ğŸ‘† ğŸ“Ÿ, &amp; âš’ ğŸ’­ ğŸ‘† âš™ï¸ ğŸ“š ğŸ» ğŸ”‘.

âš«ï¸ ğŸŒ– ğŸ•´ ğŸ‘œ ğŸ‘ˆ ğŸ‘† âœ”ï¸ ğŸ’­ â˜‘ ğŸ‘†, ğŸ› ï¸ â®ï¸ ğŸ”§.

ğŸ‚, **FastAPI** ğŸµ âš«ï¸ ğŸ‘†.

///

## â„¹ ğŸ”—

ğŸ”œ ğŸ‘¥ ğŸ”œ â„¹ ğŸ‘† ğŸ”—.

ğŸ‘¥ ğŸ’š ğŸ¤š `current_user` *ğŸ•´* ğŸš¥ ğŸ‘‰ ğŸ‘©â€ğŸ’» ğŸ¦.

, ğŸ‘¥ âœ ğŸŒ– ğŸ”— `get_current_active_user` ğŸ‘ˆ ğŸ”„ âš™ï¸ `get_current_user` ğŸ”—.

ğŸ‘¯â€â™‚ï¸ ğŸ‘‰ ğŸ”— ğŸ”œ ğŸ“¨ ğŸ‡ºğŸ‡¸ğŸ” âŒ ğŸš¥ ğŸ‘©â€ğŸ’» ğŸš« ğŸ”€, âš–ï¸ ğŸš¥ ğŸ”•.

, ğŸ‘† ğŸ”—, ğŸ‘¥ ğŸ”œ ğŸ•´ ğŸ¤š ğŸ‘©â€ğŸ’» ğŸš¥ ğŸ‘©â€ğŸ’» ğŸ”€, â˜‘ ğŸ”“, &amp; ğŸ¦:

{* ../../docs_src/security/tutorial003.py hl[58:66,69:72,90] *}

/// info

ğŸŒ– ğŸš `WWW-Authenticate` â®ï¸ ğŸ’² `Bearer` ğŸ‘¥ ğŸ›¬ ğŸ“¥ ğŸ• ğŸ”Œ.

ğŸ™† ğŸ‡ºğŸ‡¸ğŸ” (âŒ) ğŸ‘” ğŸ“Ÿ 4ï¸âƒ£0ï¸âƒ£1ï¸âƒ£ "â›”" ğŸ¤” ğŸ“¨ `WWW-Authenticate` ğŸš.

ğŸ’¼ ğŸ“¨ ğŸ¤ (ğŸ‘† ğŸ’¼), ğŸ’² ğŸ‘ˆ ğŸš ğŸ”œ `Bearer`.

ğŸ‘† ğŸ’ª ğŸ¤™ ğŸš¶ ğŸ‘ˆ â• ğŸš &amp; âš«ï¸ ğŸ”œ ğŸ‘·.

âœ‹ï¸ âš«ï¸ ğŸšš ğŸ“¥ ğŸ› ï¸ â®ï¸ ğŸ”§.

, ğŸ“¤ 5ï¸âƒ£ğŸ“† ğŸ§° ğŸ‘ˆ âŒ› &amp; âš™ï¸ âš«ï¸ (ğŸ”œ âš–ï¸ ğŸ”®) &amp; ğŸ‘ˆ ğŸ’ª âš  ğŸ‘† âš–ï¸ ğŸ‘† ğŸ‘©â€ğŸ’», ğŸ”œ âš–ï¸ ğŸ”®.

ğŸ‘ˆ ğŸ’° ğŸ©...

///

## ğŸ‘€ âš«ï¸ ğŸ¯

ğŸ“‚ ğŸ“ ğŸ©º: <a href="http://127.0.0.1:8000/docs" class="external-link" target="_blank">http://127.0.0.1:8000/docs</a>.

### ğŸ”“

ğŸ–Š "âœ”" ğŸ”¼.

âš™ï¸ ğŸ“:

ğŸ‘©â€ğŸ’»: `johndoe`

ğŸ”: `secret`

<img src="/img/tutorial/security/image04.png">

â®ï¸ ğŸ”— âš™ï¸, ğŸ‘† ğŸ”œ ğŸ‘€ âš«ï¸ ğŸ’–:

<img src="/img/tutorial/security/image05.png">

### ğŸ¤š ğŸ‘† ğŸ‘ ğŸ‘©â€ğŸ’» ğŸ’½

ğŸ”œ âš™ï¸ ğŸ› ï¸ `GET` â®ï¸ â¡ `/users/me`.

ğŸ‘† ğŸ”œ ğŸ¤š ğŸ‘† ğŸ‘©â€ğŸ’» ğŸ“Š, ğŸ’–:

```JSON
{
  "username": "johndoe",
  "email": "johndoe@example.com",
  "full_name": "John Doe",
  "disabled": false,
  "hashed_password": "fakehashedsecret"
}
```

<img src="/img/tutorial/security/image06.png">

ğŸš¥ ğŸ‘† ğŸ–Š ğŸ”’ â„¹ &amp; â, &amp; â¤´ï¸ ğŸ”„ ğŸ ğŸ› ï¸ ğŸ”„, ğŸ‘† ğŸ”œ ğŸ¤š ğŸ‡ºğŸ‡¸ğŸ” 4ï¸âƒ£0ï¸âƒ£1ï¸âƒ£ âŒ:

```JSON
{
  "detail": "Not authenticated"
}
```

### ğŸ”• ğŸ‘©â€ğŸ’»

ğŸ”œ ğŸ”„ â®ï¸ ğŸ”• ğŸ‘©â€ğŸ’», ğŸ”“ â®ï¸:

ğŸ‘©â€ğŸ’»: `alice`

ğŸ”: `secret2`

&amp; ğŸ”„ âš™ï¸ ğŸ› ï¸ `GET` â®ï¸ â¡ `/users/me`.

ğŸ‘† ğŸ”œ ğŸ¤š "ğŸ”• ğŸ‘©â€ğŸ’»" âŒ, ğŸ’–:

```JSON
{
  "detail": "Inactive user"
}
```

## ğŸŒƒ

ğŸ‘† ğŸ”œ âœ”ï¸ ğŸ§° ğŸ› ï¸ ğŸ ğŸ’‚â€â™‚ âš™ï¸ âš“ï¸ ğŸ”› `username` &amp; `password` ğŸ‘† ğŸ› ï¸.

âš™ï¸ ğŸ‘« ğŸ§°, ğŸ‘† ğŸ’ª âš’ ğŸ’‚â€â™‚ âš™ï¸ ğŸ”— â®ï¸ ğŸ™† ğŸ’½ &amp; â®ï¸ ğŸ™† ğŸ‘©â€ğŸ’» âš–ï¸ ğŸ’½ ğŸ·.

ğŸ•´ â„¹ âŒ ğŸ‘ˆ âš«ï¸ ğŸš« ğŸ¤™ "ğŸ”".

â­ ğŸ“ƒ ğŸ‘† ğŸ”œ ğŸ‘€ â” âš™ï¸ ğŸ” ğŸ” ğŸ” ğŸ—ƒ &amp; <abbr title="JSON Web Tokens">ğŸ¥™</abbr> ğŸ¤.
