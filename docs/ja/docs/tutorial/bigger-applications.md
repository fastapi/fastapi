# å¤§è¦æ¨¡ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ« { #bigger-applications-multiple-files }

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ Web API ã‚’ä½œã‚‹å ´åˆã€ã™ã¹ã¦ã‚’1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«åã‚ã‚‰ã‚Œã‚‹ã“ã¨ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã€‚

**FastAPI** ã¯ã€æŸ”è»Ÿæ€§ã‚’ä¿ã£ãŸã¾ã¾ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹é€ åŒ–ã§ãã‚‹ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚

/// info | æƒ…å ±

Flask å‡ºèº«ã§ã‚ã‚Œã°ã€Flask ã® Blueprint ã«ç›¸å½“ã—ã¾ã™ã€‚

///

## ä¾‹ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ { #an-example-file-structure }

æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆãŒã‚ã‚‹ã¨ã—ã¾ã™:

```
.
â”œâ”€â”€ app
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ main.py
â”‚Â Â  â”œâ”€â”€ dependencies.py
â”‚Â Â  â””â”€â”€ routers
â”‚Â Â  â”‚   â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚   â”œâ”€â”€ items.py
â”‚Â Â  â”‚   â””â”€â”€ users.py
â”‚Â Â  â””â”€â”€ internal
â”‚Â Â      â”œâ”€â”€ __init__.py
â”‚Â Â      â””â”€â”€ admin.py
```

/// tip | è±†çŸ¥è­˜

è¤‡æ•°ã® `__init__.py` ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™: å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«1ã¤ãšã¤ã§ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã‚³ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€`app/main.py` ã§ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™:

```
from app.routers import items
```

///

* `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã™ã¹ã¦ã‚’å«ã¿ã¾ã™ã€‚ãã—ã¦ç©ºã®ãƒ•ã‚¡ã‚¤ãƒ« `app/__init__.py` ãŒã‚ã‚Šã€ã€ŒPython ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ï¼ˆã€ŒPython ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã®é›†åˆï¼‰: `app` ã§ã™ã€‚
* `app/main.py` ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆ`__init__.py` ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã®ä¸­ã«ã‚ã‚‹ãŸã‚ã€ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€: `app.main` ã§ã™ã€‚
* `app/dependencies.py` ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã‚ã‚Šã€`app/main.py` ã¨åŒæ§˜ã«ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€: `app.dependencies` ã§ã™ã€‚
* `app/routers/` ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ¥ã® `__init__.py` ãŒã‚ã‚‹ã®ã§ã€ã€ŒPython ã‚µãƒ–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€: `app.routers` ã§ã™ã€‚
* `app/routers/items.py` ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ `app/routers/` å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§ã€ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: `app.routers.items` ã§ã™ã€‚
* `app/routers/users.py` ã‚‚åŒæ§˜ã§ã€åˆ¥ã®ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: `app.routers.users` ã§ã™ã€‚
* `app/internal/` ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚‚ `__init__.py` ãŒã‚ã‚‹ã®ã§ã€åˆ¥ã®ã€ŒPython ã‚µãƒ–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€: `app.internal` ã§ã™ã€‚
* `app/internal/admin.py` ã¯åˆ¥ã®ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: `app.internal.admin` ã§ã™ã€‚

<img src="/img/tutorial/bigger-applications/package.drawio.svg">

åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ã‘ã‚‹ã¨æ¬¡ã®ã¨ãŠã‚Šã§ã™:

```bash
.
â”œâ”€â”€ app                  # "app" is a Python package
â”‚Â Â  â”œâ”€â”€ __init__.py      # this file makes "app" a "Python package"
â”‚Â Â  â”œâ”€â”€ main.py          # "main" module, e.g. import app.main
â”‚Â Â  â”œâ”€â”€ dependencies.py  # "dependencies" module, e.g. import app.dependencies
â”‚Â Â  â””â”€â”€ routers          # "routers" is a "Python subpackage"
â”‚Â Â  â”‚   â”œâ”€â”€ __init__.py  # makes "routers" a "Python subpackage"
â”‚Â Â  â”‚   â”œâ”€â”€ items.py     # "items" submodule, e.g. import app.routers.items
â”‚Â Â  â”‚   â””â”€â”€ users.py     # "users" submodule, e.g. import app.routers.users
â”‚Â Â  â””â”€â”€ internal         # "internal" is a "Python subpackage"
â”‚Â Â      â”œâ”€â”€ __init__.py  # makes "internal" a "Python subpackage"
â”‚Â Â      â””â”€â”€ admin.py     # "admin" submodule, e.g. import app.internal.admin
```

## `APIRouter` { #apirouter }

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã ã‘ã‚’æ‰±ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `/app/routers/users.py` ã®ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã ã¨ã—ã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢é€£ã™ã‚‹ *path operations* ã‚’ã»ã‹ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰åˆ†é›¢ã—ã¦æ•´ç†ã—ãŸã„ã¯ãšã§ã™ã€‚

ãŸã ã—ã€åŒã˜ **FastAPI** ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ / Web APIï¼ˆåŒã˜ã€ŒPython ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã®ä¸€éƒ¨ï¼‰ã§ã‚ã‚‹ç‚¹ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚

ãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ `APIRouter` ã‚’ä½¿ã£ã¦ *path operations* ã‚’ä½œæˆã§ãã¾ã™ã€‚

### `APIRouter` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ { #import-apirouter }

ã‚¯ãƒ©ã‚¹ `FastAPI` ã¨åŒæ§˜ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã€ã€Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€ã‚’ä½œæˆã—ã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/routers/users.py hl[1,3] title["app/routers/users.py"] *}

### `APIRouter` ã§ã® *path operations* { #path-operations-with-apirouter }

ã“ã‚Œã‚’ä½¿ã£ã¦ *path operations* ã‚’å®£è¨€ã—ã¾ã™ã€‚

ä½¿ã„æ–¹ã¯ `FastAPI` ã‚¯ãƒ©ã‚¹ã¨åŒã˜ã§ã™:

{* ../../docs_src/bigger_applications/app_an_py310/routers/users.py hl[6,11,16] title["app/routers/users.py"] *}

`APIRouter` ã¯ã€ŒãƒŸãƒ‹ `FastAPI`ã€ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

åŒã˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã™ã¹ã¦ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

åŒã˜ `parameters`ã€`responses`ã€`dependencies`ã€`tags` ãªã©ãŒä½¿ãˆã¾ã™ã€‚

/// tip | è±†çŸ¥è­˜

ã“ã®ä¾‹ã§ã¯å¤‰æ•°åã¯ `router` ã§ã™ãŒã€ä»»æ„ã®åå‰ã‚’ä»˜ã‘ã‚‰ã‚Œã¾ã™ã€‚

///

ã“ã® `APIRouter` ã‚’ãƒ¡ã‚¤ãƒ³ã® `FastAPI` ã‚¢ãƒ—ãƒªã«å–ã‚Šè¾¼ã¿ã¾ã™ãŒã€ãã®å‰ã«ä¾å­˜é–¢ä¿‚ã¨åˆ¥ã® `APIRouter` ã‚’ç¢ºèªã—ã¾ã™ã€‚

## ä¾å­˜é–¢ä¿‚ { #dependencies }

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¤‡æ•°ç®‡æ‰€ã§ä½¿ã†ä¾å­˜é–¢ä¿‚ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã€å°‚ç”¨ã® `dependencies` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ`app/dependencies.py`ï¼‰ã«ç½®ãã¾ã™ã€‚

ã“ã“ã§ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ `X-Token` ã‚’èª­ã‚€ç°¡å˜ãªä¾å­˜é–¢ä¿‚ã‚’ä½¿ã„ã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/dependencies.py hl[3,6:8] title["app/dependencies.py"] *}

/// tip | è±†çŸ¥è­˜

ã“ã®ä¾‹ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«æ¶ç©ºã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

ã—ã‹ã—å®Ÿéš›ã«ã¯ã€çµ„ã¿è¾¼ã¿ã® [Security utilities](security/index.md){.internal-link target=_blank} ã‚’ä½¿ã†æ–¹ãŒè‰¯ã„çµæœã«ãªã‚Šã¾ã™ã€‚

///

## åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã® `APIRouter` { #another-module-with-apirouter }

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€Œitemsã€ã‚’æ‰±ã†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒ `app/routers/items.py` ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚ã‚‹ã¨ã—ã¾ã™ã€‚

æ¬¡ã® *path operations* ãŒã‚ã‚Šã¾ã™:

* `/items/`
* `/items/{item_id}`

æ§‹é€ ã¯ `app/routers/users.py` ã¨åŒã˜ã§ã™ã€‚

ã—ã‹ã—ã€ã‚‚ã†å°‘ã—è³¢ãã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å°‘ã—ç°¡æ½”ã«ã—ãŸã„ã¨ã“ã‚ã§ã™ã€‚

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã™ã¹ã¦ã® *path operations* ã«ã¯åŒã˜ã‚‚ã®ãŒã‚ã‚‹ã¨åˆ†ã‹ã£ã¦ã„ã¾ã™:

* ãƒ‘ã‚¹ã® `prefix`: `/items`
* `tags`ï¼ˆ1ã¤ã®ã‚¿ã‚°: `items`ï¼‰
* è¿½åŠ ã® `responses`
* `dependencies`: å…ˆã»ã©ä½œæˆã—ãŸ `X-Token` ã®ä¾å­˜é–¢ä¿‚ãŒå¿…è¦

ãã“ã§ã€å„ *path operation* ã«å€‹åˆ¥ã«è¿½åŠ ã™ã‚‹ä»£ã‚ã‚Šã«ã€ã“ã‚Œã‚‰ã‚’ `APIRouter` ã«è¿½åŠ ã§ãã¾ã™ã€‚

{* ../../docs_src/bigger_applications/app_an_py310/routers/items.py hl[5:10,16,21] title["app/routers/items.py"] *}

å„ *path operation* ã®ãƒ‘ã‚¹ã¯æ¬¡ã®ã‚ˆã†ã« `/` ã§å§‹ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚:

```Python hl_lines="1"
@router.get("/{item_id}")
async def read_item(item_id: str):
    ...
```

...prefix ã®æœ«å°¾ã« `/` ã‚’å«ã‚ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

ã“ã®å ´åˆã® prefix ã¯ `/items` ã§ã™ã€‚

ã¾ãŸã€`tags` ã®ãƒªã‚¹ãƒˆã‚„è¿½åŠ ã® `responses` ã‚’ã€ã“ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã«å«ã¾ã‚Œã‚‹ã™ã¹ã¦ã® *path operations* ã«é©ç”¨ã™ã‚‹ã‚ˆã†è¿½åŠ ã§ãã¾ã™ã€‚

ã•ã‚‰ã« `dependencies` ã®ãƒªã‚¹ãƒˆã‚’è¿½åŠ ã§ãã¾ã™ã€‚ã“ã‚Œã¯ã“ã®ãƒ«ãƒ¼ã‚¿ãƒ¼å†…ã®ã™ã¹ã¦ã® *path operations* ã«è¿½åŠ ã•ã‚Œã€ãã‚Œã‚‰ã¸ã®å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«å®Ÿè¡Œãƒ»è§£æ±ºã•ã‚Œã¾ã™ã€‚

/// tip | è±†çŸ¥è­˜

[*path operation ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿*ã®ä¾å­˜é–¢ä¿‚](dependencies/dependencies-in-path-operation-decorators.md){.internal-link target=_blank} ã¨åŒæ§˜ã«ã€*path operation é–¢æ•°*ã«ã¯å€¤ã¯æ¸¡ã•ã‚Œãªã„ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

///

æœ€çµ‚çš„ã«ã€item ã®ãƒ‘ã‚¹ã¯æ¬¡ã®ã¨ãŠã‚Šã«ãªã‚Šã¾ã™:

* `/items/`
* `/items/{item_id}`

...æ„å›³ã—ãŸã¨ãŠã‚Šã§ã™ã€‚

* ã“ã‚Œã‚‰ã«ã¯ã€æ–‡å­—åˆ— `"items"` ã‚’1ã¤å«ã‚€ã‚¿ã‚°ã®ãƒªã‚¹ãƒˆãŒä»˜ãã¾ã™ã€‚
    * ã“ã‚Œã‚‰ã®ã€Œã‚¿ã‚°ã€ã¯ã€ï¼ˆOpenAPI ã‚’ä½¿ã†ï¼‰è‡ªå‹•ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ç‰¹ã«æœ‰ç”¨ã§ã™ã€‚
* ã™ã¹ã¦ã«äº‹å‰å®šç¾©ã—ãŸ `responses` ãŒå«ã¾ã‚Œã¾ã™ã€‚
* ã“ã‚Œã‚‰ã™ã¹ã¦ã® *path operations* ã§ã¯ã€å®Ÿè¡Œå‰ã« `dependencies` ã®ãƒªã‚¹ãƒˆãŒè©•ä¾¡ãƒ»å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
    * ç‰¹å®šã® *path operation* ã«ä¾å­˜é–¢ä¿‚ã‚’å®£è¨€ã—ãŸå ´åˆã¯ã€**ãã‚Œã‚‰ã‚‚å®Ÿè¡Œã•ã‚Œã¾ã™**ã€‚
    * ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ä¾å­˜é–¢ä¿‚ãŒå…ˆã«å®Ÿè¡Œã•ã‚Œã€ãã®å¾Œã«[ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿å†…ã® `dependencies`](dependencies/dependencies-in-path-operation-decorators.md){.internal-link target=_blank}ã€æ¬¡ã«é€šå¸¸ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾å­˜é–¢ä¿‚ãŒç¶šãã¾ã™ã€‚
    * [`scopes` ã‚’ä¼´ã† `Security` ä¾å­˜é–¢ä¿‚](../advanced/security/oauth2-scopes.md){.internal-link target=_blank} ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

/// tip | è±†çŸ¥è­˜

`APIRouter` ã« `dependencies` ã‚’ç½®ãã“ã¨ã§ã€*path operations* ã®ã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã«èªè¨¼ã‚’è¦æ±‚ã™ã‚‹ã€ã¨ã„ã£ãŸç”¨é€”ã«ä½¿ãˆã¾ã™ã€‚å€‹ã€…ã® *path operation* ã«ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ ã—ã¦ã„ãªãã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚

///

/// check | ç¢ºèª

`prefix`ã€`tags`ã€`responses`ã€`dependencies` ã®å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ï¼ˆã»ã‹ã®å¤šãã®ã‚±ãƒ¼ã‚¹ã¨åŒæ§˜ã«ï¼‰ã‚³ãƒ¼ãƒ‰é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã® **FastAPI** ã®æ©Ÿèƒ½ã§ã™ã€‚

///

### ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ { #import-the-dependencies }

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `app.routers.items`ï¼ˆãƒ•ã‚¡ã‚¤ãƒ« `app/routers/items.py`ï¼‰å†…ã«ã‚ã‚Šã¾ã™ã€‚

ãã—ã¦ä¾å­˜é–¢ä¿‚ã®é–¢æ•°ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `app.dependencies`ï¼ˆãƒ•ã‚¡ã‚¤ãƒ« `app/dependencies.py`ï¼‰ã‹ã‚‰å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãã“ã§ã€ä¾å­˜é–¢ä¿‚ã«ã¯ `..` ã‚’ä½¿ã£ãŸç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä½¿ã„ã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/routers/items.py hl[3] title["app/routers/items.py"] *}

#### ç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ä»•çµ„ã¿ { #how-relative-imports-work }

/// tip | è±†çŸ¥è­˜

ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ä»•çµ„ã¿ã‚’ååˆ†ç†è§£ã—ã¦ã„ã‚‹å ´åˆã¯ã€æ¬¡ã®ç¯€ã«é€²ã‚“ã§ãã ã•ã„ã€‚

///

ãƒ‰ãƒƒãƒˆ1ã¤ `.` ã‚’ä½¿ã†ã¨ã€æ¬¡ã®ã‚ˆã†ãªæ„å‘³ã«ãªã‚Šã¾ã™:

```Python
from .dependencies import get_token_header
```

æ„å‘³:

* ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ`app/routers/items.py`ï¼‰ãŒå­˜åœ¨ã™ã‚‹åŒã˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `app/routers/`ï¼‰ã‹ã‚‰é–‹å§‹ã—...
* ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `dependencies`ï¼ˆä»®æƒ³çš„ã«ã¯ `app/routers/dependencies.py`ï¼‰ã‚’æ¢ã—...
* ãã“ã‹ã‚‰é–¢æ•° `get_token_header` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚

ã—ã‹ã—ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å­˜åœ¨ã›ãšã€å®Ÿéš›ã®ä¾å­˜é–¢ä¿‚ã¯ `app/dependencies.py` ã«ã‚ã‚Šã¾ã™ã€‚

ã‚¢ãƒ—ãƒªï¼ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆãŒã©ã†ãªã£ã¦ã„ãŸã‹ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„:

<img src="/img/tutorial/bigger-applications/package.drawio.svg">

---

ãƒ‰ãƒƒãƒˆ2ã¤ `..` ã‚’ä½¿ã†ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™:

```Python
from ..dependencies import get_token_header
```

æ„å‘³:

* ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ`app/routers/items.py`ï¼‰ãŒå­˜åœ¨ã™ã‚‹åŒã˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `app/routers/`ï¼‰ã‹ã‚‰é–‹å§‹ã—...
* è¦ªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `app/`ï¼‰ã«ç§»å‹•ã—...
* ãã“ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `dependencies`ï¼ˆãƒ•ã‚¡ã‚¤ãƒ« `app/dependencies.py`ï¼‰ã‚’æ¢ã—...
* ãã“ã‹ã‚‰é–¢æ•° `get_token_header` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚

ã“ã‚Œã¯æ­£ã—ãå‹•ä½œã—ã¾ã™ï¼ ğŸ‰

---

åŒæ§˜ã«ã€ãƒ‰ãƒƒãƒˆ3ã¤ `...` ã‚’ä½¿ã†ã¨:

```Python
from ...dependencies import get_token_header
```

æ„å‘³:

* ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ`app/routers/items.py`ï¼‰ãŒå­˜åœ¨ã™ã‚‹åŒã˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `app/routers/`ï¼‰ã‹ã‚‰é–‹å§‹ã—...
* è¦ªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `app/`ï¼‰ã«ç§»å‹•ã—...
* ã•ã‚‰ã«ãã®è¦ªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ç§»å‹•ã—ã‚ˆã†ã¨ã—ã¾ã™ï¼ˆ`app` ã¯æœ€ä¸Šä½ãªã®ã§è¦ªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ ğŸ˜±ï¼‰...
* ãã“ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `dependencies`ï¼ˆãƒ•ã‚¡ã‚¤ãƒ« `app/dependencies.py`ï¼‰ã‚’æ¢ã—...
* ãã“ã‹ã‚‰é–¢æ•° `get_token_header` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚

ã“ã‚Œã¯ `app/` ã‚ˆã‚Šä¸Šä½ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆç‹¬è‡ªã® `__init__.py` ã‚’æŒã¤ï¼‰ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã—ã‹ã—ãã®ã‚ˆã†ãªã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€ã“ã®ä¾‹ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ğŸš¨

ã“ã‚Œã§ä»•çµ„ã¿ãŒåˆ†ã‹ã£ãŸã®ã§ã€ã©ã‚Œã»ã©è¤‡é›‘ã§ã‚‚è‡ªåˆ†ã®ã‚¢ãƒ—ãƒªã§ç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä½¿ãˆã¾ã™ã€‚ğŸ¤“

### ã‚«ã‚¹ã‚¿ãƒ ã® `tags`ã€`responses`ã€`dependencies` ã‚’è¿½åŠ  { #add-some-custom-tags-responses-and-dependencies }

`APIRouter` ã«è¿½åŠ æ¸ˆã¿ãªã®ã§ã€å„ *path operation* ã« `/items` ã® prefix ã‚„ `tags=["items"]` ã‚’ä»˜ã‘ã¦ã„ã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€ç‰¹å®šã® *path operation* ã«é©ç”¨ã•ã‚Œã‚‹ _è¿½åŠ ã®_ `tags` ã‚„ã€ãã® *path operation* å›ºæœ‰ã®è¿½åŠ ã® `responses` ã‚’åŠ ãˆã‚‹ã“ã¨ã¯ã§ãã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/routers/items.py hl[30:31] title["app/routers/items.py"] *}

/// tip | è±†çŸ¥è­˜

ã“ã®æœ€å¾Œã® *path operation* ã¯ã€`["items", "custom"]` ã®ã‚¿ã‚°ã®çµ„ã¿åˆã‚ã›ã‚’æŒã¡ã¾ã™ã€‚

ã¾ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ `404` ã¨ `403` ã®ä¸¡æ–¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

///

## ãƒ¡ã‚¤ãƒ³ã® `FastAPI` { #the-main-fastapi }

æ¬¡ã«ã€`app/main.py` ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ã“ã“ã§ã‚¯ãƒ©ã‚¹ `FastAPI` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

ã“ã‚Œã¯ã™ã¹ã¦ã‚’ã¾ã¨ã‚ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚Šã¾ã™ã€‚

ãã—ã¦å¤§éƒ¨åˆ†ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯ãã‚Œãã‚Œã®å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ç½®ã‹ã‚Œã‚‹ãŸã‚ã€ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‹ãªã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã™ã€‚

### `FastAPI` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ { #import-fastapi }

é€šå¸¸ã©ãŠã‚Š `FastAPI` ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ä½œæˆã—ã¾ã™ã€‚

ã•ã‚‰ã«ã€å„ `APIRouter` ã®ä¾å­˜é–¢ä¿‚ã¨çµ„ã¿åˆã‚ã•ã‚Œã‚‹[ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾å­˜é–¢ä¿‚](dependencies/global-dependencies.md){.internal-link target=_blank}ã‚‚å®£è¨€ã§ãã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[1,3,7] title["app/main.py"] *}

### `APIRouter` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ { #import-the-apirouter }

æ¬¡ã«ã€`APIRouter` ã‚’æŒã¤ä»–ã®ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[4:5] title["app/main.py"] *}

`app/routers/users.py` ã¨ `app/routers/items.py` ã¯åŒã˜ Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ `app` ã®ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã®ã§ã€1ã¤ã®ãƒ‰ãƒƒãƒˆ `.` ã‚’ä½¿ã£ãŸã€Œç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚

### ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å‹•ä½œ { #how-the-importing-works }

æ¬¡ã®éƒ¨åˆ†:

```Python
from .routers import items, users
```

ã¯æ¬¡ã®æ„å‘³ã§ã™:

* ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ`app/main.py`ï¼‰ãŒå­˜åœ¨ã™ã‚‹åŒã˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `app/`ï¼‰ã‹ã‚‰é–‹å§‹ã—...
* ã‚µãƒ–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ `routers`ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `app/routers/`ï¼‰ã‚’æ¢ã—...
* ãã“ã‹ã‚‰ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `items`ï¼ˆãƒ•ã‚¡ã‚¤ãƒ« `app/routers/items.py`ï¼‰ã¨ `users`ï¼ˆãƒ•ã‚¡ã‚¤ãƒ« `app/routers/users.py`ï¼‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹...

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `items` ã«ã¯å¤‰æ•° `router`ï¼ˆ`items.router`ï¼‰ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ `app/routers/items.py` ã§ä½œæˆã—ãŸ `APIRouter` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜ã‚‚ã®ã§ã™ã€‚

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `users` ã«ã¤ã„ã¦ã‚‚åŒæ§˜ã§ã™ã€‚

æ¬¡ã®ã‚ˆã†ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:

```Python
from app.routers import items, users
```

/// info | æƒ…å ±

æœ€åˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€Œç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã§ã™:

```Python
from .routers import items, users
```

2ã¤ç›®ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€Œçµ¶å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã§ã™:

```Python
from app.routers import items, users
```

Python ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¤ã„ã¦è©³ã—ãã¯ã€<a href="https://docs.python.org/3/tutorial/modules.html" class="external-link" target="_blank">å…¬å¼ã® Python ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«é–¢ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’ã”è¦§ãã ã•ã„ã€‚

///

### åå‰è¡çªã®å›é¿ { #avoid-name-collisions }

ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `items` ã®å¤‰æ•° `router` ã ã‘ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã®ã§ã¯ãªãã€ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è‡ªä½“ã‚’ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã¯ã€ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `users` ã«ã‚‚ `router` ã¨ã„ã†å¤‰æ•°ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚

ã‚‚ã—æ¬¡ã®ã‚ˆã†ã«ç¶šã‘ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸå ´åˆ:

```Python
from .routers.items import router
from .routers.users import router
```

`users` ã® `router` ãŒ `items` ã®ã‚‚ã®ã‚’ä¸Šæ›¸ãã—ã¦ã—ã¾ã„ã€åŒæ™‚ã«ä¸¡æ–¹ã‚’ä½¿ãˆãªããªã‚Šã¾ã™ã€‚

åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã§ä¸¡æ–¹ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[5] title["app/main.py"] *}

### `users` ã¨ `items` ã® `APIRouter` ã‚’å–ã‚Šè¾¼ã‚€ { #include-the-apirouters-for-users-and-items }

ã§ã¯ã€ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« `users` ã¨ `items` ã‹ã‚‰ `router` ã‚’å–ã‚Šè¾¼ã¿ã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[10:11] title["app/main.py"] *}

/// info | æƒ…å ±

`users.router` ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ« `app/routers/users.py` å†…ã® `APIRouter` ã‚’å«ã¿ã¾ã™ã€‚

`items.router` ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ« `app/routers/items.py` å†…ã® `APIRouter` ã‚’å«ã¿ã¾ã™ã€‚

///

`app.include_router()` ã‚’ä½¿ã£ã¦ã€å„ `APIRouter` ã‚’ãƒ¡ã‚¤ãƒ³ã® `FastAPI` ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã§ãã¾ã™ã€‚

ãã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆãŒã‚¢ãƒ—ãƒªã«å«ã¾ã‚Œã¾ã™ã€‚

/// note | æŠ€è¡“è©³ç´°

å®Ÿéš›ã«ã¯ã€`APIRouter` ã§å®£è¨€ã•ã‚ŒãŸå„ *path operation* ã”ã¨ã«å†…éƒ¨çš„ã« *path operation* ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

ã¤ã¾ã‚Šè£å´ã§ã¯ã€ã™ã¹ã¦ãŒåŒã˜å˜ä¸€ã®ã‚¢ãƒ—ãƒªã§ã‚ã‚‹ã‹ã®ã‚ˆã†ã«å‹•ä½œã—ã¾ã™ã€‚

///

/// check | ç¢ºèª

ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’å–ã‚Šè¾¼ã‚“ã§ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¿ƒé…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã¯èµ·å‹•æ™‚ã«ãƒã‚¤ã‚¯ãƒ­ç§’ã§è¡Œã‚ã‚Œã¾ã™ã€‚

ã—ãŸãŒã£ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚âš¡

///

### ã‚«ã‚¹ã‚¿ãƒ ã® `prefix`ã€`tags`ã€`responses`ã€`dependencies` ä»˜ãã§ `APIRouter` ã‚’å–ã‚Šè¾¼ã‚€ { #include-an-apirouter-with-a-custom-prefix-tags-responses-and-dependencies }

ã‚ãªãŸã®çµ„ç¹”ã‹ã‚‰ `app/internal/admin.py` ãƒ•ã‚¡ã‚¤ãƒ«ãŒæä¾›ã•ã‚ŒãŸã¨ã—ã¾ã—ã‚‡ã†ã€‚

ãã“ã«ã¯ã€çµ„ç¹”ãŒè¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å…±æœ‰ã—ã¦ã„ã‚‹ç®¡ç†ç”¨ã® *path operations* ã‚’æŒã¤ `APIRouter` ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®ä¾‹ã§ã¯ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã€çµ„ç¹”å†…ã®ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨å…±æœ‰ã—ã¦ã„ã‚‹ãŸã‚ã€`APIRouter` è‡ªä½“ã‚’ç›´æ¥å¤‰æ›´ã—ã¦ `prefix`ã€`dependencies`ã€`tags` ãªã©ã‚’è¿½åŠ ã§ããªã„ã¨ã—ã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/internal/admin.py hl[3] title["app/internal/admin.py"] *}

ãã‚Œã§ã‚‚ã€`APIRouter` ã‚’å–ã‚Šè¾¼ã‚€éš›ã«ã‚«ã‚¹ã‚¿ãƒ ã® `prefix` ã‚’è¨­å®šã—ã¦ã™ã¹ã¦ã® *path operations* ã‚’ `/admin` ã§å§‹ã‚ãŸã„ã€æ—¢å­˜ã® `dependencies` ã§ä¿è­·ã—ãŸã„ã€ã•ã‚‰ã« `tags` ã¨ `responses` ã‚‚å«ã‚ãŸã„ã¨ã—ã¾ã™ã€‚

å…ƒã® `APIRouter` ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãªãã€`app.include_router()` ã«ã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã“ã¨ã§å®£è¨€ã§ãã¾ã™:

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[14:17] title["app/main.py"] *}

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã¨ã€å…ƒã® `APIRouter` ã¯æœªå¤‰æ›´ã®ã¾ã¾ãªã®ã§ã€åŒã˜ `app/internal/admin.py` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµ„ç¹”å†…ã®ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã‚‚å¼•ãç¶šãå…±æœ‰ã§ãã¾ã™ã€‚

çµæœã¨ã—ã¦ã€ã“ã®ã‚¢ãƒ—ãƒªå†…ã§ã¯ `admin` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å„ *path operation* ãŒæ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™:

* prefix ã¯ `/admin`
* ã‚¿ã‚°ã¯ `admin`
* ä¾å­˜é–¢ä¿‚ã¯ `get_token_header`
* ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ `418` ğŸµ

ãŸã ã—ã€ã“ã‚Œã¯ã“ã®ã‚¢ãƒ—ãƒªå†…ã®ãã® `APIRouter` ã«ã®ã¿å½±éŸ¿ã—ã€ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ä»–ã®ã‚³ãƒ¼ãƒ‰ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚

ä¾‹ãˆã°ã€ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯åŒã˜ `APIRouter` ã‚’åˆ¥ã®èªè¨¼æ–¹å¼ã§ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

### *path operation* ã‚’è¿½åŠ  { #include-a-path-operation }

`FastAPI` ã‚¢ãƒ—ãƒªã« *path operations* ã‚’ç›´æ¥è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ã“ã“ã§ã¯ï¼ˆã§ãã‚‹ã“ã¨ã‚’ç¤ºã™ãŸã‚ã ã‘ã«ï¼‰è¿½åŠ ã—ã¾ã™ ğŸ¤·:

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[21:23] title["app/main.py"] *}

ãã—ã¦ã€`app.include_router()` ã§è¿½åŠ ã—ãŸã»ã‹ã® *path operations* ã¨ä¸€ç·’ã«æ­£ã—ãå‹•ä½œã—ã¾ã™ã€‚

/// info | éå¸¸ã«æŠ€è¡“çš„ãªè©³ç´°

æ³¨è¨˜: ã“ã‚Œã¯éå¸¸ã«æŠ€è¡“çš„ãªè©³ç´°ã§ã€**èª­ã¿é£›ã°ã—ã¦æ§‹ã„ã¾ã›ã‚“**ã€‚

---

`APIRouter` ã¯ã€Œãƒã‚¦ãƒ³ãƒˆã€ã•ã‚Œã¦ãŠã‚‰ãšã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»–éƒ¨åˆ†ã‹ã‚‰åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ã“ã‚Œã¯ã€ãã‚Œã‚‰ã® *path operations* ã‚’ OpenAPI ã‚¹ã‚­ãƒ¼ãƒã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å«ã‚ãŸã„ã‹ã‚‰ã§ã™ã€‚

å®Œå…¨ã«åˆ†é›¢ã—ã¦ç‹¬ç«‹ã«ã€Œãƒã‚¦ãƒ³ãƒˆã€ã§ããªã„ãŸã‚ã€*path operations* ã¯ç›´æ¥å–ã‚Šè¾¼ã¾ã‚Œã‚‹ã®ã§ã¯ãªãã€Œã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆå†ä½œæˆï¼‰ã€ã•ã‚Œã¾ã™ã€‚

///

## è‡ªå‹•APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç¢ºèª { #check-the-automatic-api-docs }

ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã—ã¾ã™:

<div class="termy">

```console
$ fastapi dev app/main.py

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

ãã—ã¦ <a href="http://127.0.0.1:8000/docs" class="external-link" target="_blank">http://127.0.0.1:8000/docs</a> ã‚’é–‹ãã¾ã™ã€‚

ã™ã¹ã¦ã®ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç”±æ¥ã®ãƒ‘ã‚¹ã‚’å«ã‚€è‡ªå‹• API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã€æ­£ã—ã„ãƒ‘ã‚¹ï¼ˆãŠã‚ˆã³ prefixï¼‰ã¨æ­£ã—ã„ã‚¿ã‚°ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™:

<img src="/img/tutorial/bigger-applications/image01.png">

## åŒã˜ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ç•°ãªã‚‹ `prefix` ã§è¤‡æ•°å›å–ã‚Šè¾¼ã‚€ { #include-the-same-router-multiple-times-with-different-prefix }

åŒã˜ãƒ«ãƒ¼ã‚¿ãƒ¼ã«å¯¾ã—ã¦ã€ç•°ãªã‚‹ prefix ã§ `.include_router()` ã‚’è¤‡æ•°å›ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€åŒã˜ API ã‚’ `/api/v1` ã¨ `/api/latest` ã®ã‚ˆã†ã«ç•°ãªã‚‹ prefix ã§å…¬é–‹ã™ã‚‹å ´åˆã«å½¹ç«‹ã¡ã¾ã™ã€‚

é«˜åº¦ãªä½¿ã„æ–¹ãªã®ã§ä¸è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¿…è¦ãªå ´åˆã«å‚™ãˆã¦ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

## `APIRouter` ã‚’åˆ¥ã® `APIRouter` ã«å–ã‚Šè¾¼ã‚€ { #include-an-apirouter-in-another }

`APIRouter` ã‚’ `FastAPI` ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å–ã‚Šè¾¼ã‚ã‚‹ã®ã¨åŒã˜ã‚ˆã†ã«ã€`APIRouter` ã‚’åˆ¥ã® `APIRouter` ã«å–ã‚Šè¾¼ã‚€ã“ã¨ã‚‚ã§ãã¾ã™:

```Python
router.include_router(other_router)
```

`router` ã‚’ `FastAPI` ã‚¢ãƒ—ãƒªã«å–ã‚Šè¾¼ã‚€å‰ã«ã“ã‚Œã‚’å®Ÿè¡Œã—ã¦ã€`other_router` ã® *path operations* ã‚‚å«ã¾ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚
