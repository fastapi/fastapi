# æ›´å¤§å‹çš„æ‡‰ç”¨ç¨‹å¼ - å¤šå€‹æª”æ¡ˆ { #bigger-applications-multiple-files }

å¦‚æœä½ æ­£åœ¨å»ºç½®ä¸€å€‹æ‡‰ç”¨ç¨‹å¼æˆ– Web APIï¼Œå¾ˆå°‘æœƒæŠŠæ‰€æœ‰æ±è¥¿éƒ½æ”¾åœ¨å–®ä¸€æª”æ¡ˆè£¡ã€‚

FastAPI æä¾›äº†ä¸€å€‹æ–¹ä¾¿çš„å·¥å…·ï¼Œè®“ä½ åœ¨ç¶­æŒå½ˆæ€§çš„åŒæ™‚ï¼Œå¹«ä½ çµ„ç¹”æ‡‰ç”¨ç¨‹å¼çš„çµæ§‹ã€‚

/// info | è³‡è¨Š

å¦‚æœä½ ä¾†è‡ª Flaskï¼Œé€™ç›¸ç•¶æ–¼ Flask çš„ Blueprintsã€‚

///

## ç¯„ä¾‹æª”æ¡ˆçµæ§‹ { #an-example-file-structure }

å‡è¨­ä½ æœ‰å¦‚ä¸‹çš„æª”æ¡ˆçµæ§‹ï¼š

```
.
â”œâ”€â”€ app
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ main.py
â”‚Â Â  â”œâ”€â”€ dependencies.py
â”‚Â Â  â””â”€â”€ routers
â”‚Â Â  â”‚   â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚   â”œâ”€â”€ items.py
â”‚Â Â  â”‚   â””â”€â”€ users.py
â”‚Â Â  â””â”€â”€ internal
â”‚Â Â      â”œâ”€â”€ __init__.py
â”‚Â Â      â””â”€â”€ admin.py
```

/// tip | æç¤º

æœ‰å¥½å¹¾å€‹ `__init__.py` æª”æ¡ˆï¼šæ¯å€‹ç›®éŒ„æˆ–å­ç›®éŒ„å„ä¸€å€‹ã€‚

é€™è®“æˆ‘å€‘å¯ä»¥æŠŠä¸€å€‹æª”æ¡ˆä¸­çš„ç¨‹å¼ç¢¼åŒ¯å…¥åˆ°å¦ä¸€å€‹æª”æ¡ˆã€‚

ä¾‹å¦‚ï¼Œåœ¨ `app/main.py` ä½ å¯ä»¥æœ‰ä¸€è¡Œï¼š

```
from app.routers import items
```

///

* `app` ç›®éŒ„åŒ…å«æ‰€æœ‰å…§å®¹ã€‚å®ƒæœ‰ä¸€å€‹ç©ºçš„ `app/__init__.py` æª”æ¡ˆï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€å€‹ã€ŒPython å¥—ä»¶ã€ï¼ˆã€ŒPython æ¨¡çµ„ã€çš„é›†åˆï¼‰ï¼š`app`ã€‚
* å®ƒåŒ…å«ä¸€å€‹ `app/main.py` æª”æ¡ˆã€‚å› ç‚ºå®ƒåœ¨ä¸€å€‹ Python å¥—ä»¶ä¸­ï¼ˆæœ‰ `__init__.py` æª”æ¡ˆçš„ç›®éŒ„ï¼‰ï¼Œå®ƒæ˜¯è©²å¥—ä»¶çš„ä¸€å€‹ã€Œæ¨¡çµ„ã€ï¼š`app.main`ã€‚
* é‚„æœ‰ä¸€å€‹ `app/dependencies.py` æª”æ¡ˆï¼Œå°±åƒ `app/main.py` ä¸€æ¨£ï¼Œå®ƒæ˜¯ä¸€å€‹ã€Œæ¨¡çµ„ã€ï¼š`app.dependencies`ã€‚
* æœ‰ä¸€å€‹å­ç›®éŒ„ `app/routers/`ï¼Œè£¡é¢æœ‰å¦ä¸€å€‹ `__init__.py` æª”æ¡ˆï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€å€‹ã€ŒPython å­å¥—ä»¶ã€ï¼š`app.routers`ã€‚
* æª”æ¡ˆ `app/routers/items.py` åœ¨ä¸€å€‹å¥—ä»¶ `app/routers/` å…§ï¼Œå› æ­¤å®ƒæ˜¯ä¸€å€‹å­æ¨¡çµ„ï¼š`app.routers.items`ã€‚
* åŒæ¨£åœ°ï¼Œ`app/routers/users.py` æ˜¯å¦ä¸€å€‹å­æ¨¡çµ„ï¼š`app.routers.users`ã€‚
* é‚„æœ‰ä¸€å€‹å­ç›®éŒ„ `app/internal/`ï¼Œè£¡é¢æœ‰å¦ä¸€å€‹ `__init__.py` æª”æ¡ˆï¼Œæ‰€ä»¥å®ƒåˆæ˜¯ä¸€å€‹ã€ŒPython å­å¥—ä»¶ã€ï¼š`app.internal`ã€‚
* æª”æ¡ˆ `app/internal/admin.py` æ˜¯å¦ä¸€å€‹å­æ¨¡çµ„ï¼š`app.internal.admin`ã€‚

<img src="/img/tutorial/bigger-applications/package.drawio.svg">

åŒæ¨£çš„æª”æ¡ˆçµæ§‹ï¼Œé™„ä¸Šè¨»è§£ï¼š

```bash
.
â”œâ”€â”€ app                  # ã€Œappã€æ˜¯ä¸€å€‹ Python å¥—ä»¶
â”‚Â Â  â”œâ”€â”€ __init__.py      # é€™å€‹æª”æ¡ˆè®“ã€Œappã€æˆç‚ºã€ŒPython å¥—ä»¶ã€
â”‚Â Â  â”œâ”€â”€ main.py          # ã€Œmainã€æ¨¡çµ„ï¼Œä¾‹å¦‚ import app.main
â”‚Â Â  â”œâ”€â”€ dependencies.py  # ã€Œdependenciesã€æ¨¡çµ„ï¼Œä¾‹å¦‚ import app.dependencies
â”‚Â Â  â””â”€â”€ routers          # ã€Œroutersã€æ˜¯ä¸€å€‹ã€ŒPython å­å¥—ä»¶ã€
â”‚Â Â  â”‚   â”œâ”€â”€ __init__.py  # è®“ã€Œroutersã€æˆç‚ºã€ŒPython å­å¥—ä»¶ã€
â”‚Â Â  â”‚   â”œâ”€â”€ items.py     # ã€Œitemsã€å­æ¨¡çµ„ï¼Œä¾‹å¦‚ import app.routers.items
â”‚Â Â  â”‚   â””â”€â”€ users.py     # ã€Œusersã€å­æ¨¡çµ„ï¼Œä¾‹å¦‚ import app.routers.users
â”‚Â Â  â””â”€â”€ internal         # ã€Œinternalã€æ˜¯ä¸€å€‹ã€ŒPython å­å¥—ä»¶ã€
â”‚Â Â      â”œâ”€â”€ __init__.py  # è®“ã€Œinternalã€æˆç‚ºã€ŒPython å­å¥—ä»¶ã€
â”‚Â Â      â””â”€â”€ admin.py     # ã€Œadminã€å­æ¨¡çµ„ï¼Œä¾‹å¦‚ import app.internal.admin
```

## `APIRouter` { #apirouter }

å‡è¨­å°ˆé–€è™•ç†ä½¿ç”¨è€…çš„æª”æ¡ˆæ˜¯ä½æ–¼ `/app/routers/users.py` çš„å­æ¨¡çµ„ã€‚

ä½ å¸Œæœ›æŠŠèˆ‡ä½¿ç”¨è€…ç›¸é—œçš„ã€Œè·¯å¾‘æ“ä½œ (path operation)ã€å¾å…¶ä»–ç¨‹å¼ç¢¼åˆ†é›¢ï¼Œè®“çµæ§‹æ›´æœ‰æ¢ç†ã€‚

ä½†å®ƒä»ç„¶æ˜¯åŒä¸€å€‹ FastAPI æ‡‰ç”¨ç¨‹å¼ / Web API çš„ä¸€éƒ¨åˆ†ï¼ˆå±¬æ–¼åŒä¸€å€‹ã€ŒPython å¥—ä»¶ã€ï¼‰ã€‚

ä½ å¯ä»¥ä½¿ç”¨ `APIRouter` ç‚ºè©²æ¨¡çµ„å»ºç«‹è·¯å¾‘æ“ä½œã€‚

### åŒ¯å…¥ `APIRouter` { #import-apirouter }

ä½ å¯ä»¥åƒå° `FastAPI` é¡åˆ¥é‚£æ¨£åŒ¯å…¥ä¸¦å»ºç«‹ä¸€å€‹ã€Œå¯¦ä¾‹ã€ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/routers/users.py hl[1,3] title["app/routers/users.py"] *}

### ä½¿ç”¨ `APIRouter` å®£å‘Šè·¯å¾‘æ“ä½œ { #path-operations-with-apirouter }

ç„¶å¾Œç”¨å®ƒä¾†å®£å‘Šä½ çš„è·¯å¾‘æ“ä½œã€‚

ç”¨æ³•å°±å’Œ `FastAPI` é¡åˆ¥ä¸€æ¨£ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/routers/users.py hl[6,11,16] title["app/routers/users.py"] *}

ä½ å¯ä»¥æŠŠ `APIRouter` æƒ³æˆæ˜¯ã€Œè¿·ä½ ç‰ˆçš„ `FastAPI`ã€é¡åˆ¥ã€‚

æ‰€æœ‰ç›¸åŒçš„é¸é …éƒ½æ”¯æ´ã€‚

åŒæ¨£çš„ `parameters`ã€`responses`ã€`dependencies`ã€`tags` ç­‰å…¨éƒ½å¯ç”¨ã€‚

/// tip | æç¤º

åœ¨é€™å€‹ç¯„ä¾‹ä¸­ï¼Œè®Šæ•¸åå« `router`ï¼Œä½†ä½ å¯ä»¥ç”¨ä»»ä½•ä½ æƒ³ç”¨çš„åç¨±ã€‚

///

æˆ‘å€‘ç¨å¾ŒæœƒæŠŠé€™å€‹ `APIRouter` åŠ é€²ä¸»è¦çš„ `FastAPI` æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œä½†å…ˆä¾†çœ‹çœ‹ç›¸ä¾æ€§èˆ‡å¦ä¸€å€‹ `APIRouter`ã€‚

## ç›¸ä¾æ€§ { #dependencies }

æˆ‘å€‘ç™¼ç¾æ‡‰ç”¨ç¨‹å¼çš„å¤šå€‹åœ°æ–¹æœƒç”¨åˆ°ä¸€äº›ç›¸ä¾æ€§ã€‚

æ‰€ä»¥æŠŠå®ƒå€‘æ”¾é€²ç¨ç«‹çš„ `dependencies` æ¨¡çµ„ï¼ˆ`app/dependencies.py`ï¼‰ã€‚

æ¥ä¸‹ä¾†æˆ‘å€‘æœƒç”¨ä¸€å€‹ç°¡å–®çš„ç›¸ä¾æ€§ä¾†è®€å–è‡ªè¨‚çš„ `X-Token` æ¨™é ­ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/dependencies.py hl[3,6:8] title["app/dependencies.py"] *}

/// tip | æç¤º

ç‚ºäº†ç°¡åŒ–ç¯„ä¾‹ï¼Œæˆ‘å€‘ä½¿ç”¨äº†ä¸€å€‹è™›æ§‹çš„æ¨™é ­ã€‚

ä½†åœ¨çœŸå¯¦æƒ…æ³ä¸‹ï¼Œä½¿ç”¨å…§å»ºçš„[å®‰å…¨å·¥å…·](security/index.md){.internal-link target=_blank}æœƒæœ‰æ›´å¥½çš„æ•ˆæœã€‚

///

## å¦ä¸€å€‹å¸¶æœ‰ `APIRouter` çš„æ¨¡çµ„ { #another-module-with-apirouter }

å‡è¨­ä½ é‚„æœ‰ä¸€å€‹æ¨¡çµ„ `app/routers/items.py`ï¼Œå°ˆé–€è™•ç†æ‡‰ç”¨ç¨‹å¼ä¸­çš„ã€Œitemsã€ã€‚

ä½ æœ‰ä»¥ä¸‹è·¯å¾‘æ“ä½œï¼š

* `/items/`
* `/items/{item_id}`

å…¶çµæ§‹èˆ‡ `app/routers/users.py` ç›¸åŒã€‚

ä½†æˆ‘å€‘æƒ³è¦æ›´è°æ˜åœ°ç°¡åŒ–ä¸€äº›ç¨‹å¼ç¢¼ã€‚

æˆ‘å€‘çŸ¥é“é€™å€‹æ¨¡çµ„ä¸­çš„æ‰€æœ‰è·¯å¾‘æ“ä½œéƒ½æœ‰ç›¸åŒçš„ï¼š

* è·¯å¾‘ `prefix`ï¼š`/items`
* `tags`ï¼šï¼ˆåªæœ‰ä¸€å€‹æ¨™ç±¤ï¼š`items`ï¼‰
* é¡å¤–çš„ `responses`
* `dependencies`ï¼šå®ƒå€‘éƒ½éœ€è¦æˆ‘å€‘å…ˆå‰å»ºç«‹çš„ `X-Token` ç›¸ä¾æ€§

å› æ­¤ï¼Œæˆ‘å€‘å¯ä»¥ä¸å¿…æŠŠé€™äº›éƒ½åŠ åœ¨æ¯å€‹è·¯å¾‘æ“ä½œä¸Šï¼Œè€Œæ˜¯æŠŠå®ƒå€‘åŠ åœ¨ `APIRouter` ä¸Šã€‚

{* ../../docs_src/bigger_applications/app_an_py310/routers/items.py hl[5:10,16,21] title["app/routers/items.py"] *}

ç”±æ–¼æ¯å€‹è·¯å¾‘æ“ä½œçš„è·¯å¾‘éƒ½å¿…é ˆä»¥ `/` é–‹é ­ï¼Œä¾‹å¦‚ï¼š

```Python hl_lines="1"
@router.get("/{item_id}")
async def read_item(item_id: str):
    ...
```

...æ‰€ä»¥ prefix æœ«å°¾ä¸èƒ½å¸¶æœ‰ `/`ã€‚

å› æ­¤ï¼Œæ­¤è™•çš„ prefix æ˜¯ `/items`ã€‚

æˆ‘å€‘ä¹Ÿå¯ä»¥åŠ ä¸Šä¸€å€‹ `tags` æ¸…å–®ï¼Œä»¥åŠæœƒå¥—ç”¨åœ¨æ­¤ router å…§æ‰€æœ‰è·¯å¾‘æ“ä½œä¸Šçš„é¡å¤– `responses`ã€‚

æˆ‘å€‘é‚„å¯ä»¥åŠ ä¸Šä¸€å€‹ `dependencies` æ¸…å–®ï¼Œé€™äº›ç›¸ä¾æ€§æœƒåŠ å…¥æ­¤ router å…§æ‰€æœ‰çš„è·¯å¾‘æ“ä½œï¼Œä¸¦åœ¨å°å®ƒå€‘çš„æ¯å€‹è«‹æ±‚ä¸ŠåŸ·è¡Œ / è§£æ±ºã€‚

/// tip | æç¤º

è«‹æ³¨æ„ï¼Œå°±åƒåœ¨[è·¯å¾‘æ“ä½œè£é£¾å™¨ä¸­çš„ç›¸ä¾æ€§](dependencies/dependencies-in-path-operation-decorators.md){.internal-link target=_blank}ä¸€æ¨£ï¼Œä¸æœƒæŠŠä»»ä½•å€¼å‚³éçµ¦ä½ çš„è·¯å¾‘æ“ä½œå‡½å¼ï¼ˆpath operation functionï¼‰ã€‚

///

æœ€å¾Œçš„çµæœæ˜¯é€™äº› item çš„è·¯å¾‘å¦‚ä¸‹ï¼š

* `/items/`
* `/items/{item_id}`

...æ­£å¦‚æˆ‘å€‘é æœŸçš„ã€‚

* å®ƒå€‘æœƒè¢«æ¨™è¨˜ç‚ºåªæœ‰ä¸€å€‹å­—ä¸² `"items"` çš„æ¨™ç±¤æ¸…å–®ã€‚
    * é€™äº›ã€Œæ¨™ç±¤ã€å°è‡ªå‹•äº’å‹•å¼æ–‡ä»¶ç³»çµ±ï¼ˆä½¿ç”¨ OpenAPIï¼‰ç‰¹åˆ¥æœ‰ç”¨ã€‚
* å®ƒå€‘éƒ½æœƒåŒ…å«é å…ˆå®šç¾©çš„ `responses`ã€‚
* é€™äº›è·¯å¾‘æ“ä½œéƒ½æœƒåœ¨åŸ·è¡Œå‰è©•ä¼° / åŸ·è¡Œå…¶ `dependencies` æ¸…å–®ã€‚
    * å¦‚æœä½ ä¹Ÿåœ¨ç‰¹å®šçš„è·¯å¾‘æ“ä½œä¸­å®£å‘Šäº†ç›¸ä¾æ€§ï¼Œé€™äº›ç›¸ä¾æ€§ä¹Ÿæœƒè¢«åŸ·è¡Œã€‚
    * Router çš„ç›¸ä¾æ€§æœƒå…ˆåŸ·è¡Œï¼Œç„¶å¾Œæ˜¯[è£é£¾å™¨ä¸­çš„ `dependencies`](dependencies/dependencies-in-path-operation-decorators.md){.internal-link target=_blank}ï¼Œæœ€å¾Œæ˜¯ä¸€èˆ¬åƒæ•¸ç›¸ä¾æ€§ã€‚
    * ä½ ä¹Ÿå¯ä»¥åŠ å…¥å¸¶æœ‰ `scopes` çš„ [`Security` ç›¸ä¾æ€§](../advanced/security/oauth2-scopes.md){.internal-link target=_blank}ã€‚

/// tip | æç¤º

åœ¨ `APIRouter` ä¸­è¨­å®š `dependencies`ï¼Œä¾‹å¦‚å¯ä»¥ç”¨ä¾†å°ä¸€æ•´çµ„è·¯å¾‘æ“ä½œè¦æ±‚é©—è­‰ã€‚å³ä½¿æ²’æœ‰åœ¨æ¯å€‹è·¯å¾‘æ“ä½œå€‹åˆ¥åŠ å…¥ç›¸ä¾æ€§ä¹Ÿæ²’é—œä¿‚ã€‚

///

/// check | æª¢æŸ¥

`prefix`ã€`tags`ã€`responses` èˆ‡ `dependencies` åƒæ•¸ï¼ˆå°±åƒè¨±å¤šå…¶ä»–æƒ…æ³ä¸€æ¨£ï¼‰åªæ˜¯ FastAPI æä¾›çš„åŠŸèƒ½ï¼Œå¹«åŠ©ä½ é¿å…é‡è¤‡ç¨‹å¼ç¢¼ã€‚

///

### åŒ¯å…¥ç›¸ä¾æ€§ { #import-the-dependencies }

é€™æ®µç¨‹å¼ç¢¼åœ¨æ¨¡çµ„ `app.routers.items`ï¼ˆæª”æ¡ˆ `app/routers/items.py`ï¼‰ä¸­ã€‚

æˆ‘å€‘éœ€è¦å¾æ¨¡çµ„ `app.dependencies`ï¼ˆæª”æ¡ˆ `app/dependencies.py`ï¼‰å–å¾—ç›¸ä¾æ€§å‡½å¼ã€‚

å› æ­¤æˆ‘å€‘ç”¨ `..` åšç›¸å°åŒ¯å…¥ç›¸ä¾æ€§ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/routers/items.py hl[3] title["app/routers/items.py"] *}

#### ç›¸å°åŒ¯å…¥å¦‚ä½•é‹ä½œ { #how-relative-imports-work }

/// tip | æç¤º

å¦‚æœä½ å°åŒ¯å…¥çš„é‹ä½œæ–¹å¼ååˆ†äº†è§£ï¼Œå¯ä»¥ç›´æ¥è·³åˆ°ä¸‹ä¸€ç¯€ã€‚

///

å–®ä¸€çš„é»è™Ÿ `.`ï¼Œå¦‚ä¸‹ï¼š

```Python
from .dependencies import get_token_header
```

ä»£è¡¨ï¼š

* å¾æ­¤æ¨¡çµ„ï¼ˆæª”æ¡ˆ `app/routers/items.py`ï¼‰æ‰€åœ¨çš„ç›¸åŒå¥—ä»¶ï¼ˆç›®éŒ„ `app/routers/`ï¼‰é–‹å§‹...
* æ‰¾åˆ°æ¨¡çµ„ `dependencies`ï¼ˆæƒ³åƒçš„æª”æ¡ˆ `app/routers/dependencies.py`ï¼‰...
* ä¸¦å¾ä¸­åŒ¯å…¥å‡½å¼ `get_token_header`ã€‚

ä½†é‚£å€‹æª”æ¡ˆä¸å­˜åœ¨ï¼Œæˆ‘å€‘çš„ç›¸ä¾æ€§åœ¨ `app/dependencies.py`ã€‚

å›æƒ³ä¸€ä¸‹æˆ‘å€‘çš„æ‡‰ç”¨ / æª”æ¡ˆçµæ§‹é•·é€™æ¨£ï¼š

<img src="/img/tutorial/bigger-applications/package.drawio.svg">

---

å…©å€‹é»è™Ÿ `..`ï¼Œå¦‚ä¸‹ï¼š

```Python
from ..dependencies import get_token_header
```

ä»£è¡¨ï¼š

* å¾æ­¤æ¨¡çµ„ï¼ˆæª”æ¡ˆ `app/routers/items.py`ï¼‰æ‰€åœ¨çš„ç›¸åŒå¥—ä»¶ï¼ˆç›®éŒ„ `app/routers/`ï¼‰é–‹å§‹...
* å‰å¾€å…¶çˆ¶å¥—ä»¶ï¼ˆç›®éŒ„ `app/`ï¼‰...
* ç„¶å¾Œåœ¨é‚£è£¡æ‰¾åˆ°æ¨¡çµ„ `dependencies`ï¼ˆæª”æ¡ˆ `app/dependencies.py`ï¼‰...
* ä¸¦å¾ä¸­åŒ¯å…¥å‡½å¼ `get_token_header`ã€‚

é€™å°±æ­£ç¢ºäº†ï¼ğŸ‰

---

åŒæ¨£åœ°ï¼Œå¦‚æœæˆ‘å€‘ç”¨ä¸‰å€‹é»è™Ÿ `...`ï¼Œå¦‚ä¸‹ï¼š

```Python
from ...dependencies import get_token_header
```

å°±ä»£è¡¨ï¼š

* å¾æ­¤æ¨¡çµ„ï¼ˆæª”æ¡ˆ `app/routers/items.py`ï¼‰æ‰€åœ¨çš„ç›¸åŒå¥—ä»¶ï¼ˆç›®éŒ„ `app/routers/`ï¼‰é–‹å§‹...
* å‰å¾€å…¶çˆ¶å¥—ä»¶ï¼ˆç›®éŒ„ `app/`ï¼‰...
* å†å‰å¾€é‚£å€‹å¥—ä»¶çš„çˆ¶å±¤ï¼ˆæ²’æœ‰æ›´ä¸Šå±¤çš„å¥—ä»¶äº†ï¼Œ`app` å·²æ˜¯æœ€ä¸Šå±¤ ğŸ˜±ï¼‰...
* ç„¶å¾Œåœ¨é‚£è£¡æ‰¾åˆ°æ¨¡çµ„ `dependencies`ï¼ˆæª”æ¡ˆ `app/dependencies.py`ï¼‰...
* ä¸¦å¾ä¸­åŒ¯å…¥å‡½å¼ `get_token_header`ã€‚

é‚£æœƒæŒ‡å‘ `app/` ä¹‹ä¸Šçš„æŸå€‹å¥—ä»¶ï¼Œè©²å¥—ä»¶éœ€æœ‰è‡ªå·±çš„ `__init__.py` ç­‰ç­‰ã€‚ä½†æˆ‘å€‘æ²’æœ‰ã€‚æ‰€ä»¥åœ¨é€™å€‹ä¾‹å­ä¸­æœƒä¸Ÿå‡ºéŒ¯èª¤ã€‚ğŸš¨

ä¸éç¾åœ¨ä½ çŸ¥é“å®ƒçš„é‹ä½œæ–¹å¼äº†ï¼Œå› æ­¤ç„¡è«–ä½ çš„æ‡‰ç”¨æœ‰å¤šè¤‡é›œï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨ç›¸å°åŒ¯å…¥ã€‚ğŸ¤“

### åŠ ä¸Šä¸€äº›è‡ªè¨‚çš„ `tags`ã€`responses` èˆ‡ `dependencies` { #add-some-custom-tags-responses-and-dependencies }

æˆ‘å€‘æ²’æœ‰æŠŠ `/items` çš„ prefix ä»¥åŠ `tags=["items"]` åŠ åœ¨æ¯å€‹è·¯å¾‘æ“ä½œä¸Šï¼Œå› ç‚ºæˆ‘å€‘å·²ç¶“æŠŠå®ƒå€‘åŠ åœ¨ `APIRouter` ä¸Šäº†ã€‚

ä½†æˆ‘å€‘ä»å¯ä»¥åœ¨ç‰¹å®šçš„è·¯å¾‘æ“ä½œä¸Šå†åŠ ä¸Šæ›´å¤šçš„ `tags`ï¼Œä»¥åŠä¸€äº›åªå±¬æ–¼è©²è·¯å¾‘æ“ä½œçš„é¡å¤– `responses`ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/routers/items.py hl[30:31] title["app/routers/items.py"] *}

/// tip | æç¤º

é€™æœ€å¾Œä¸€å€‹è·¯å¾‘æ“ä½œæœƒæœ‰çµ„åˆå¾Œçš„æ¨™ç±¤ï¼š`["items", "custom"]`ã€‚

è€Œä¸”åœ¨æ–‡ä»¶ä¸­åŒæ™‚æœƒæœ‰ `404` èˆ‡ `403` å…©ç¨®å›æ‡‰ã€‚

///

## ä¸»ç¨‹å¼ `FastAPI` { #the-main-fastapi }

ç¾åœ¨ï¼Œä¾†çœ‹çœ‹ `app/main.py` é€™å€‹æ¨¡çµ„ã€‚

ä½ æœƒåœ¨é€™è£¡åŒ¯å…¥ä¸¦ä½¿ç”¨ `FastAPI` é¡åˆ¥ã€‚

é€™æœƒæ˜¯ä½ çš„æ‡‰ç”¨ç¨‹å¼ä¸­æŠŠä¸€åˆ‡ä¸²èµ·ä¾†çš„ä¸»æª”æ¡ˆã€‚

è€Œéš¨è‘—å¤§å¤šæ•¸çš„é‚è¼¯éƒ½æ”¾åœ¨å„è‡ªçš„æ¨¡çµ„ä¸­ï¼Œä¸»æª”æ¡ˆæœƒç›¸ç•¶ç°¡æ½”ã€‚

### åŒ¯å…¥ `FastAPI` { #import-fastapi }

ç…§å¸¸åŒ¯å…¥ä¸¦å»ºç«‹ `FastAPI` é¡åˆ¥ã€‚

æˆ‘å€‘ç”šè‡³å¯ä»¥å®£å‘Š[å…¨åŸŸç›¸ä¾æ€§](dependencies/global-dependencies.md){.internal-link target=_blank}ï¼Œå®ƒå€‘æœƒèˆ‡å„ `APIRouter` çš„ç›¸ä¾æ€§åˆä½µï¼š

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[1,3,7] title["app/main.py"] *}

### åŒ¯å…¥ `APIRouter` { #import-the-apirouter }

ç¾åœ¨æˆ‘å€‘åŒ¯å…¥åŒ…å« `APIRouter` çš„å…¶ä»–å­æ¨¡çµ„ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[4:5] title["app/main.py"] *}

ç”±æ–¼ `app/routers/users.py` èˆ‡ `app/routers/items.py` æ˜¯åŒä¸€å€‹ Python å¥—ä»¶ `app` çš„å­æ¨¡çµ„ï¼Œæˆ‘å€‘å¯ä»¥ç”¨å–®ä¸€çš„é»è™Ÿ `.` ä¾†é€²è¡Œã€Œç›¸å°åŒ¯å…¥ã€ã€‚

### åŒ¯å…¥å¦‚ä½•é‹ä½œ { #how-the-importing-works }

é€™æ®µï¼š

```Python
from .routers import items, users
```

ä»£è¡¨ï¼š

* å¾æ­¤æ¨¡çµ„ï¼ˆæª”æ¡ˆ `app/main.py`ï¼‰æ‰€åœ¨çš„ç›¸åŒå¥—ä»¶ï¼ˆç›®éŒ„ `app/`ï¼‰é–‹å§‹...
* å°‹æ‰¾å­å¥—ä»¶ `routers`ï¼ˆç›®éŒ„ `app/routers/`ï¼‰...
* ä¸¦å¾ä¸­åŒ¯å…¥å­æ¨¡çµ„ `items`ï¼ˆæª”æ¡ˆ `app/routers/items.py`ï¼‰èˆ‡ `users`ï¼ˆæª”æ¡ˆ `app/routers/users.py`ï¼‰...

æ¨¡çµ„ `items` æœƒæœ‰ä¸€å€‹è®Šæ•¸ `router`ï¼ˆ`items.router`ï¼‰ã€‚é€™å°±æ˜¯æˆ‘å€‘åœ¨ `app/routers/items.py` å»ºç«‹çš„é‚£å€‹ `APIRouter` ç‰©ä»¶ã€‚

æ¥è‘—æˆ‘å€‘å° `users` æ¨¡çµ„åšä¸€æ¨£çš„äº‹ã€‚

æˆ‘å€‘ä¹Ÿå¯ä»¥é€™æ¨£åŒ¯å…¥ï¼š

```Python
from app.routers import items, users
```

/// info | è³‡è¨Š

ç¬¬ä¸€ç¨®æ˜¯ã€Œç›¸å°åŒ¯å…¥ã€ï¼š

```Python
from .routers import items, users
```

ç¬¬äºŒç¨®æ˜¯ã€Œçµ•å°åŒ¯å…¥ã€ï¼š

```Python
from app.routers import items, users
```

æƒ³äº†è§£æ›´å¤šé—œæ–¼ Python å¥—ä»¶èˆ‡æ¨¡çµ„ï¼Œè«‹é–±è®€<a href="https://docs.python.org/3/tutorial/modules.html" class="external-link" target="_blank">å®˜æ–¹çš„æ¨¡çµ„èªªæ˜æ–‡ä»¶</a>ã€‚

///

### é¿å…åç¨±è¡çª { #avoid-name-collisions }

æˆ‘å€‘ç›´æ¥åŒ¯å…¥å­æ¨¡çµ„ `items`ï¼Œè€Œä¸æ˜¯åªåŒ¯å…¥å®ƒçš„è®Šæ•¸ `router`ã€‚

é€™æ˜¯å› ç‚ºåœ¨å­æ¨¡çµ„ `users` ä¸­ä¹Ÿæœ‰å¦ä¸€å€‹åç‚º `router` çš„è®Šæ•¸ã€‚

å¦‚æœæˆ‘å€‘åƒä¸‹é¢é€™æ¨£ä¸€å€‹æ¥ä¸€å€‹åŒ¯å…¥ï¼š

```Python
from .routers.items import router
from .routers.users import router
```

ä¾†è‡ª `users` çš„ `router` æœƒè¦†è“‹æ‰ `items` çš„ `router`ï¼Œæˆ‘å€‘å°±ç„¡æ³•åŒæ™‚ä½¿ç”¨å…©è€…ã€‚

å› æ­¤ï¼Œç‚ºäº†èƒ½åœ¨åŒä¸€å€‹æª”æ¡ˆä¸­åŒæ™‚ä½¿ç”¨å®ƒå€‘ï¼Œæˆ‘å€‘ç›´æ¥åŒ¯å…¥å­æ¨¡çµ„ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[5] title["app/main.py"] *}

### å°‡ `users` èˆ‡ `items` çš„ `APIRouter` ç´å…¥ { #include-the-apirouters-for-users-and-items }

ç¾åœ¨ï¼ŒæŠŠå­æ¨¡çµ„ `users` èˆ‡ `items` çš„ `router` ç´å…¥ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[10:11] title["app/main.py"] *}

/// info | è³‡è¨Š

`users.router` æ˜¯ä½æ–¼ `app/routers/users.py` æª”æ¡ˆå…§çš„ `APIRouter`ã€‚

è€Œ `items.router` æ˜¯ä½æ–¼ `app/routers/items.py` æª”æ¡ˆå…§çš„ `APIRouter`ã€‚

///

é€é `app.include_router()`ï¼Œæˆ‘å€‘å¯ä»¥æŠŠæ¯å€‹ `APIRouter` åŠ åˆ°ä¸»è¦çš„ `FastAPI` æ‡‰ç”¨ç¨‹å¼ã€‚

å®ƒæœƒæŠŠè©² router çš„æ‰€æœ‰è·¯ç”±éƒ½ç´å…¥æˆç‚ºæ‡‰ç”¨çš„ä¸€éƒ¨åˆ†ã€‚

/// note | æŠ€è¡“ç´°ç¯€

å¯¦éš›ä¸Šï¼Œå®ƒæœƒåœ¨å…§éƒ¨ç‚º `APIRouter` ä¸­å®£å‘Šçš„æ¯ä¸€å€‹ã€Œè·¯å¾‘æ“ä½œã€å»ºç«‹ä¸€å€‹å°æ‡‰çš„ã€Œè·¯å¾‘æ“ä½œã€ã€‚

æ‰€ä»¥åœ¨å¹•å¾Œï¼Œå®ƒå¯¦éš›é‹ä½œèµ·ä¾†å°±åƒæ˜¯ä¸€å€‹å–®ä¸€çš„æ‡‰ç”¨ã€‚

///

/// check | æª¢æŸ¥

æŠŠ router ç´å…¥æ™‚ä¸éœ€è¦æ“”å¿ƒæ•ˆèƒ½ã€‚

é€™åªæœƒåœ¨å•Ÿå‹•æ™‚èŠ±è²»å¾®ç§’ç­‰ç´šï¼Œä¸”åªç™¼ç”Ÿä¸€æ¬¡ã€‚

å› æ­¤ä¸æœƒå½±éŸ¿æ•ˆèƒ½ã€‚âš¡

///

### ä»¥è‡ªè¨‚çš„ `prefix`ã€`tags`ã€`responses` èˆ‡ `dependencies` ç´å…¥ä¸€å€‹ `APIRouter` { #include-an-apirouter-with-a-custom-prefix-tags-responses-and-dependencies }

ç¾åœ¨ï¼Œå‡è¨­ä½ çš„çµ„ç¹”æä¾›äº†ä¸€å€‹ `app/internal/admin.py` æª”æ¡ˆçµ¦ä½ ã€‚

å®ƒåŒ…å«ä¸€å€‹å¸¶æœ‰ä¸€äº›ç®¡ç†å“¡è·¯å¾‘æ“ä½œçš„ `APIRouter`ï¼Œä¸¦åœ¨çµ„ç¹”å…§å¤šå€‹å°ˆæ¡ˆä¹‹é–“å…±ç”¨ã€‚

ç‚ºäº†é€™å€‹ç¯„ä¾‹å®ƒæœƒéå¸¸ç°¡å–®ã€‚ä½†å‡è¨­å› ç‚ºå®ƒæœƒèˆ‡çµ„ç¹”å…§çš„å…¶ä»–å°ˆæ¡ˆå…±ç”¨ï¼Œæˆ‘å€‘ä¸èƒ½ç›´æ¥ä¿®æ”¹å®ƒä¸¦æŠŠ `prefix`ã€`dependencies`ã€`tags` ç­‰åŠ åœ¨ `APIRouter` ä¸Šï¼š

{* ../../docs_src/bigger_applications/app_an_py310/internal/admin.py hl[3] title["app/internal/admin.py"] *}

ä½†ç•¶æˆ‘å€‘æŠŠé€™å€‹ `APIRouter` ç´å…¥æ™‚ï¼Œä»ç„¶å¸Œæœ›è¨­å®šè‡ªè¨‚çš„ `prefix`ï¼Œè®“å®ƒæ‰€æœ‰çš„è·¯å¾‘æ“ä½œéƒ½ä»¥ `/admin` é–‹é ­ï¼›æˆ‘å€‘æƒ³ç”¨é€™å€‹å°ˆæ¡ˆå·²ç¶“æœ‰çš„ `dependencies` ä¾†ä¿è­·å®ƒï¼Œä¸¦ä¸”è¦åŠ å…¥ `tags` èˆ‡ `responses`ã€‚

æˆ‘å€‘å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸå§‹ `APIRouter` çš„æƒ…æ³ä¸‹ï¼Œå°‡é€™äº›åƒæ•¸å‚³çµ¦ `app.include_router()` ä¾†é”æˆï¼š

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[14:17] title["app/main.py"] *}

å¦‚æ­¤ä¸€ä¾†ï¼ŒåŸå§‹çš„ `APIRouter` å°‡ä¿æŒä¸è®Šï¼Œå› æ­¤æˆ‘å€‘ä»ç„¶å¯ä»¥æŠŠåŒä¸€å€‹ `app/internal/admin.py` æª”æ¡ˆèˆ‡çµ„ç¹”ä¸­çš„å…¶ä»–å°ˆæ¡ˆå…±ç”¨ã€‚

çµæœæ˜¯åœ¨æˆ‘å€‘çš„æ‡‰ç”¨ä¸­ï¼Œä¾†è‡ª `admin` æ¨¡çµ„çš„æ¯å€‹è·¯å¾‘æ“ä½œéƒ½æœƒæœ‰ï¼š

* å‰ç¶´ `/admin`
* æ¨™ç±¤ `admin`
* ç›¸ä¾æ€§ `get_token_header`
* å›æ‡‰ `418` ğŸµ

ä½†é€™åªæœƒå½±éŸ¿æˆ‘å€‘æ‡‰ç”¨ä¸­çš„é‚£å€‹ `APIRouter`ï¼Œä¸æœƒå½±éŸ¿ä»»ä½•å…¶ä»–ä½¿ç”¨å®ƒçš„ç¨‹å¼ç¢¼ã€‚

ä¾‹å¦‚ï¼Œå…¶ä»–å°ˆæ¡ˆå¯ä»¥ç”¨ä¸åŒçš„é©—è­‰æ–¹å¼æ­é…ç›¸åŒçš„ `APIRouter`ã€‚

### åŠ ä¸Šä¸€å€‹è·¯å¾‘æ“ä½œ { #include-a-path-operation }

æˆ‘å€‘ä¹Ÿå¯ä»¥ç›´æ¥æŠŠè·¯å¾‘æ“ä½œåŠ åˆ° `FastAPI` æ‡‰ç”¨ä¸­ã€‚

é€™è£¡æˆ‘å€‘å°±åŠ ä¸€ä¸‹... åªæ˜¯ç‚ºäº†ç¤ºç¯„å¯ä»¥é€™éº¼åš ğŸ¤·ï¼š

{* ../../docs_src/bigger_applications/app_an_py310/main.py hl[21:23] title["app/main.py"] *}

è€Œä¸”å®ƒæœƒå’Œé€é `app.include_router()` åŠ å…¥çš„å…¶ä»–è·¯å¾‘æ“ä½œæ­£ç¢ºåœ°ä¸€èµ·é‹ä½œã€‚

/// info | éå¸¸æŠ€è¡“ç´°ç¯€

æ³¨æ„ï¼šé€™æ˜¯å€‹éå¸¸æŠ€è¡“æ€§çš„ç´°ç¯€ï¼Œä½ å¤§æ¦‚å¯ä»¥ç›´æ¥ç•¥éã€‚

---

`APIRouter` ä¸æ˜¯è¢«ã€Œæ›è¼‰ (mount)ã€çš„ï¼Œå®ƒå€‘ä¸æœƒèˆ‡æ‡‰ç”¨çš„å…¶ä»–éƒ¨åˆ†éš”é›¢é–‹ä¾†ã€‚

é€™æ˜¯å› ç‚ºæˆ‘å€‘è¦æŠŠå®ƒå€‘çš„è·¯å¾‘æ“ä½œåŒ…å«é€² OpenAPI çµæ§‹èˆ‡ä½¿ç”¨è€…ä»‹é¢ä¸­ã€‚

ç”±æ–¼ç„¡æ³•å°‡å®ƒå€‘éš”é›¢ä¸¦ç¨ç«‹ã€Œæ›è¼‰ã€ï¼Œæ‰€ä»¥é€™äº›è·¯å¾‘æ“ä½œæœƒè¢«ã€Œè¤‡è£½ã€ï¼ˆé‡æ–°å»ºç«‹ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥åŒ…å«é€²ä¾†ã€‚

///

## æª¢æŸ¥è‡ªå‹•ç”¢ç”Ÿçš„ API æ–‡ä»¶ { #check-the-automatic-api-docs }

ç¾åœ¨ï¼ŒåŸ·è¡Œä½ çš„æ‡‰ç”¨ï¼š

<div class="termy">

```console
$ fastapi dev app/main.py

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

ç„¶å¾Œé–‹å•Ÿä½æ–¼ <a href="http://127.0.0.1:8000/docs" class="external-link" target="_blank">http://127.0.0.1:8000/docs</a> çš„æ–‡ä»¶ã€‚

ä½ æœƒçœ‹åˆ°è‡ªå‹•ç”¢ç”Ÿçš„ API æ–‡ä»¶ï¼ŒåŒ…å«ä¾†è‡ªæ‰€æœ‰å­æ¨¡çµ„çš„è·¯å¾‘ï¼Œä½¿ç”¨æ­£ç¢ºçš„è·¯å¾‘ï¼ˆèˆ‡å‰ç¶´ï¼‰èˆ‡æ­£ç¢ºçš„æ¨™ç±¤ï¼š

<img src="/img/tutorial/bigger-applications/image01.png">

## ä»¥ä¸åŒçš„ `prefix` å¤šæ¬¡ç´å…¥åŒä¸€å€‹ router { #include-the-same-router-multiple-times-with-different-prefix }

ä½ ä¹Ÿå¯ä»¥ç”¨ä¸åŒçš„å‰ç¶´ï¼Œå°åŒä¸€å€‹ router å¤šæ¬¡å‘¼å« `.include_router()`ã€‚

ä¾‹å¦‚ï¼Œé€™å°æ–¼åœ¨ä¸åŒå‰ç¶´ä¸‹æä¾›ç›¸åŒçš„ API å¾ˆæœ‰ç”¨ï¼Œå¦‚ `/api/v1` èˆ‡ `/api/latest`ã€‚

é€™æ˜¯é€²éšç”¨æ³•ï¼Œä½ å¯èƒ½ä¸æœƒéœ€è¦ï¼Œä½†è‹¥æœ‰éœ€è¦å®ƒå°±åœ¨é‚£è£¡ã€‚

## åœ¨å¦ä¸€å€‹ `APIRouter` ä¸­ç´å…¥ä¸€å€‹ `APIRouter` { #include-an-apirouter-in-another }

å°±åƒä½ å¯ä»¥åœ¨ `FastAPI` æ‡‰ç”¨ä¸­ç´å…¥ä¸€å€‹ `APIRouter` ä¸€æ¨£ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å¦ä¸€å€‹ `APIRouter` ä¸­ç´å…¥ä¸€å€‹ `APIRouter`ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š

```Python
router.include_router(other_router)
```

è«‹ç¢ºä¿åœ¨æŠŠ `router` ç´å…¥ `FastAPI` æ‡‰ç”¨ä¹‹å‰å…ˆé€™éº¼åšï¼Œé€™æ¨£ `other_router` çš„è·¯å¾‘æ“ä½œä¹Ÿæœƒè¢«åŒ…å«é€²å»ã€‚
