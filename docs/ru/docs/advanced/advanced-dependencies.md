# Продвинутые зависимости { #advanced-dependencies }

## Параметризованные зависимости { #parameterized-dependencies }

Все зависимости, которые мы видели, — это конкретная функция или класс.

Но бывают случаи, когда нужно задавать параметры зависимости, не объявляя много разных функций или классов.

Представим, что нам нужна зависимость, которая проверяет, содержит ли query-параметр `q` некоторое фиксированное содержимое.

Но при этом мы хотим иметь возможность параметризовать это фиксированное содержимое.

## «Вызываемый» экземпляр { #a-callable-instance }

В Python есть способ сделать экземпляр класса «вызываемым» объектом.

Не сам класс (он уже является вызываемым), а экземпляр этого класса.

Для этого объявляем метод `__call__`:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}

В этом случае именно `__call__` **FastAPI** использует для проверки дополнительных параметров и подзависимостей, и именно он будет вызван, чтобы позже передать значение параметру в вашей *функции-обработчике пути*.

## Параметризуем экземпляр { #parameterize-the-instance }

Теперь мы можем использовать `__init__`, чтобы объявить параметры экземпляра, с помощью которых будем «параметризовать» зависимость:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}

В этом случае **FastAPI** вовсе не трогает `__init__` и не зависит от него — мы используем его напрямую в нашем коде.

## Создаём экземпляр { #create-an-instance }

Мы можем создать экземпляр этого класса так:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}

Так мы «параметризуем» нашу зависимость: теперь внутри неё хранится "bar" в атрибуте `checker.fixed_content`.

## Используем экземпляр как зависимость { #use-the-instance-as-a-dependency }

Затем мы можем использовать этот `checker` в `Depends(checker)` вместо `Depends(FixedContentQueryChecker)`, потому что зависимостью является экземпляр `checker`, а не сам класс.

И при разрешении зависимости **FastAPI** вызовет `checker` примерно так:

```Python
checker(q="somequery")
```

…и передаст возвращённое значение как значение зависимости в нашу *функцию-обработчике пути* в параметр `fixed_content_included`:

{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}

/// tip | Совет

Все это может показаться притянутым за уши. И пока может быть не совсем понятно, чем это полезно.

Эти примеры намеренно простые, но они показывают, как всё устроено.

В главах про безопасность есть утилитные функции, реализованные тем же способом.

Если вы поняли всё выше, вы уже знаете, как «под капотом» работают эти утилиты для безопасности.

///
