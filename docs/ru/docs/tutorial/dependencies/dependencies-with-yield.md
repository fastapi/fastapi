# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å yield { #dependencies-with-yield }

FastAPI –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ <abbr title='–∏–Ω–æ–≥–¥–∞ —Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ–º—ã–µ "exit code", "cleanup code", "teardown code", "closing code", "context manager exit code" –∏ —Ç.–ø.'>–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</abbr>.

–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `yield` –≤–º–µ—Å—Ç–æ `return`, –∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ (–∫–æ–¥) –Ω–∞–ø–∏—à–∏—Ç–µ –ø–æ—Å–ª–µ –Ω–µ–≥–æ.

/// tip | –ü–æ–¥—Å–∫–∞–∑–∫–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `yield` —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –æ–¥–Ω—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.

///

/// note | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

–õ—é–±–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —Å –∫–æ—Ç–æ—Ä–æ–π –º–æ–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

* <a href="https://docs.python.org/3/library/contextlib.html#contextlib.contextmanager" class="external-link" target="_blank">`@contextlib.contextmanager`</a> –∏–ª–∏
* <a href="https://docs.python.org/3/library/contextlib.html#contextlib.asynccontextmanager" class="external-link" target="_blank">`@contextlib.asynccontextmanager`</a>

–±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ **FastAPI**.

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, FastAPI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –¥–≤–∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ.

///

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é `yield` { #a-database-dependency-with-yield }

–ù–∞–ø—Ä–∏–º–µ—Ä, —Å –µ–≥–æ –ø–æ–º–æ—â—å—é –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—å –µ—ë –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —Ç–æ–ª—å–∫–æ –∫–æ–¥ –¥–æ –∏ –≤–∫–ª—é—á–∞—è –æ–ø–µ—Ä–∞—Ç–æ—Ä `yield`:

{* ../../docs_src/dependencies/tutorial007.py hl[2:4] *}

–ó–Ω–∞—á–µ–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–∑ `yield`, –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è –≤ *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏* –∏ –¥—Ä—É–≥–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

{* ../../docs_src/dependencies/tutorial007.py hl[4] *}

–ö–æ–¥, —Å–ª–µ–¥—É—é—â–∏–π –∑–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º `yield`, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞:

{* ../../docs_src/dependencies/tutorial007.py hl[5:6] *}

/// tip | –ü–æ–¥—Å–∫–∞–∑–∫–∞

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ `async`, —Ç–∞–∫ –∏ –æ–±—ã—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

**FastAPI** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, —Ç–∞–∫ –∂–µ –∫–∞–∫ –∏ —Å –æ–±—ã—á–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

///

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å `yield` –∏ `try` { #a-dependency-with-yield-and-try }

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–ª–æ–∫ `try` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield`, —Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ª—é–±–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –≤—ã–±—Ä–æ—à–µ–Ω–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ –∫–æ–¥ –≤ –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ, –≤ –¥—Ä—É–≥–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–ª–∏ –≤ *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏*, —Å–¥–µ–ª–∞–ª "–æ—Ç–∫–∞—Ç" —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å–æ–∑–¥–∞–ª –ª—é–±—É—é –¥—Ä—É–≥—É—é –æ—à–∏–±–∫—É, —Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —ç—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ —Å–≤–æ–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é `except SomeException`.

–¢–æ—á–Ω–æ —Ç–∞–∫ –∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `finally`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –±—ã–ª–æ –ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –Ω–µ—Ç.

{* ../../docs_src/dependencies/tutorial007.py hl[3,5] *}

## –ü–æ–¥–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield` { #sub-dependencies-with-yield }

–í—ã –º–æ–∂–µ—Ç–µ –∏–º–µ—Ç—å –ø–æ–¥–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ "–¥–µ—Ä–µ–≤—å—è" –ø–æ–¥–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∏ —Ñ–æ—Ä–º—ã, –∏ –ª—é–±–∞—è –∏–∑ –Ω–∏—Ö –∏–ª–∏ –≤—Å–µ –æ–Ω–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `yield`.

**FastAPI** –ø—Ä–æ—Å–ª–µ–¥–∏—Ç –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã ¬´–∫–æ–¥ –≤—ã—Ö–æ–¥–∞¬ª –≤ –∫–∞–∂–¥–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield` –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä, `dependency_c` –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç `dependency_b`, –∞ `dependency_b` ‚Äî –æ—Ç `dependency_a`:

{* ../../docs_src/dependencies/tutorial008_an_py39.py hl[6,14,22] *}

–ò –≤—Å–µ –æ–Ω–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `yield`.

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ `dependency_c` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–≤–æ–µ–≥–æ –∫–æ–¥–∞ –≤—ã—Ö–æ–¥–∞ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `dependency_b` (–∑–¥–µ—Å—å `dep_b`) –≤—Å—ë –µ—â—ë –±—ã–ª–æ –¥–æ—Å—Ç—É–ø–Ω–æ.

–ò, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, `dependency_b` –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `dependency_a` (–∑–¥–µ—Å—å `dep_a`) –±—ã–ª–æ –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –µ—ë –∫–æ–¥–∞ –≤—ã—Ö–æ–¥–∞.

{* ../../docs_src/dependencies/tutorial008_an_py39.py hl[18:19,26:27] *}

–¢–æ—á–Ω–æ —Ç–∞–∫ –∂–µ –º–æ–∂–Ω–æ –∏–º–µ—Ç—å —á–∞—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å `yield`, —á–∞—Å—Ç—å ‚Äî —Å `return`, –∏ –∫–∞–∫–∏–µ-—Ç–æ –∏–∑ –Ω–∏—Ö –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–µ—Ç—å –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.

–õ–∏–±–æ —É –≤–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥—Ä—É–≥–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å `yield` –∏ —Ç.–¥.

–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫–∏–º–∏ —É–≥–æ–¥–Ω–æ.

**FastAPI** –ø—Ä–æ—Å–ª–µ–¥–∏—Ç –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã –≤—Å—ë –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

/// note | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è <a href="https://docs.python.org/3/library/contextlib.html" class="external-link" target="_blank">–º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</a> –≤ Python.

**FastAPI** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —ç—Ç–æ–≥–æ.

///

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield` –∏ `HTTPException` { #dependencies-with-yield-and-httpexception }

–í—ã –≤–∏–¥–µ–ª–∏, —á—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield` –∏ –∏–º–µ—Ç—å –±–ª–æ–∫–∏ `try`, –∫–æ—Ç–æ—Ä—ã–µ –ø—ã—Ç–∞—é—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–π –∫–æ–¥, –∞ –∑–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞—é—Ç –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ –≤ `finally`.

–¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `except`, —á—Ç–æ–±—ã –ø–æ–π–º–∞—Ç—å –≤—ã–∑–≤–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ —á—Ç–æ-—Ç–æ —Å –Ω–∏–º —Å–¥–µ–ª–∞—Ç—å.

–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ <abbr title="¬´raise¬ª –¥–æ—Å–ª–æ–≤–Ω–æ - ¬´–ø–æ–¥–Ω—è—Ç—å¬ª, –Ω–æ ¬´–≤—ã–∑–≤–∞—Ç—å¬ª, ¬´—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å¬ª –∏–ª–∏ ¬´–≤—ã–±—Ä–æ—Å–∏—Ç—å¬ª —É–ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç—Å—è —á–∞—â–µ">–≤—ã–∑–≤–∞—Ç—å</abbr> –¥—Ä—É–≥–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä `HTTPException`.

/// tip | –ü–æ–¥—Å–∫–∞–∑–∫–∞

–≠—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ç–µ—Ö–Ω–∏–∫–∞, –∏ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –æ–Ω–∞ –≤–∞–º –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–∑—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è `HTTPException`) –≤ –æ—Å—Ç–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ *—Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –ø—É—Ç–∏*.

–ù–æ –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –µ—Å—Ç—å. ü§ì

///

{* ../../docs_src/dependencies/tutorial008b_an_py39.py hl[18:22,31] *}

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏—Ö –æ—Å–Ω–æ–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ—Ç–≤–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π](../handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank}.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield` –∏ `except` { #dependencies-with-yield-and-except }

–ï—Å–ª–∏ –≤—ã –ª–æ–≤–∏—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é `except` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield` –∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç–µ –µ–≥–æ —Å–Ω–æ–≤–∞ (–∏–ª–∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç–µ –Ω–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ), FastAPI –Ω–µ —Å–º–æ–∂–µ—Ç –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –±—ã–ª–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Äî —Ç–∞–∫ –∂–µ, –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ–±—ã—á–Ω–æ–º Python:

{* ../../docs_src/dependencies/tutorial008c_an_py39.py hl[15:16] *}

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç *HTTP 500 Internal Server Error*, –∫–∞–∫ –∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å, –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã –Ω–µ –≤—ã–∑—ã–≤–∞–µ–º `HTTPException` –∏–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–¥–æ–±–Ω–æ–µ, –Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ **–Ω–µ –±—É–¥–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –ª–æ–≥–æ–≤** –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —É–∫–∞–∑–∞–Ω–∏–π –Ω–∞ —Ç–æ, –∫–∞–∫–∞—è –±—ã–ª–∞ –æ—à–∏–±–∫–∞. üò±

### –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ `raise` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö —Å `yield` –∏ `except` { #always-raise-in-dependencies-with-yield-and-except }

–ï—Å–ª–∏ –≤—ã –ª–æ–≤–∏—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield`, —Ç–æ, –µ—Å–ª–∏ –≤—ã –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç–µ –¥—Ä—É–≥–æ–π `HTTPException` –∏–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–¥–æ–±–Ω–æ–µ, –≤–∞–º —Å–ª–µ–¥—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é `raise`:

{* ../../docs_src/dependencies/tutorial008d_an_py39.py hl[17] *}

–¢–µ–ø–µ—Ä—å –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç —Ç–æ—Ç –∂–µ *HTTP 500 Internal Server Error*, –Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –Ω–∞—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ `InternalError`. üòé

## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å `yield` { #execution-of-dependencies-with-yield }

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∞—è, –∫–∞–∫ –Ω–∞ —ç—Ç–æ–π —Å—Ö–µ–º–µ. –í—Ä–µ–º—è —Ç–µ—á—ë—Ç —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑. –ê –∫–∞–∂–¥—ã–π —Å—Ç–æ–ª–±–µ—Ü ‚Äî —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ —á–∞—Å—Ç–µ–π, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —Å –∫–æ–¥–æ–º –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö –∫–æ–¥.

```mermaid
sequenceDiagram

participant client as Client
participant handler as Exception handler
participant dep as Dep with yield
participant operation as Path Operation
participant tasks as Background tasks

    Note over client,operation: Can raise exceptions, including HTTPException
    client ->> dep: Start request
    Note over dep: Run code up to yield
    opt raise Exception
        dep -->> handler: Raise Exception
        handler -->> client: HTTP error response
    end
    dep ->> operation: Run dependency, e.g. DB session
    opt raise
        operation -->> dep: Raise Exception (e.g. HTTPException)
        opt handle
            dep -->> dep: Can catch exception, raise a new HTTPException, raise other exception
        end
        handler -->> client: HTTP error response
    end

    operation ->> client: Return response to client
    Note over client,operation: Response is already sent, can't change it anymore
    opt Tasks
        operation -->> tasks: Send background tasks
    end
    opt Raise other exception
        tasks -->> tasks: Handle exceptions in the background task code
    end
```

/// info | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ö–ª–∏–µ–Ω—Ç—É –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω –æ—Ç–≤–µ—Ç**. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–∏–Ω –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ –æ–± –æ—à–∏–±–∫–µ –∏–ª–∏ –æ—Ç–≤–µ—Ç –æ—Ç *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏*.

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–¥–Ω–æ–≥–æ –∏–∑ —ç—Ç–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∏–∫–∞–∫–æ–π –¥—Ä—É–≥–æ–π –æ—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–ª—å–∑—è.

///

/// tip | –ü–æ–¥—Å–∫–∞–∑–∫–∞

–ï—Å–ª–∏ –≤—ã –≤—ã–∑–æ–≤–µ—Ç–µ –∫–∞–∫–æ–µ-–ª–∏–±–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ –∫–æ–¥–µ –∏–∑ *—Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—É—Ç–∏*, –æ–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º —Å `yield`, –≤–∫–ª—é—á–∞—è `HTTPException`. –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –Ω–æ–≤–æ–µ –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ.

///

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield`, `HTTPException`, `except` –∏ —Ñ–æ–Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ { #dependencies-with-yield-httpexception-except-and-background-tasks }

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield` —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª–∏, —á—Ç–æ–±—ã –ø–æ–∫—Ä—ã—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –º–µ–Ω—è–ª–æ—Å—å –≤ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö FastAPI, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –æ–± —ç—Ç–æ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ: [–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield`, `HTTPException`, `except` –∏ —Ñ–æ–Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏](../../advanced/advanced-dependencies.md#dependencies-with-yield-httpexception-except-and-background-tasks){.internal-link target=_blank}.
## –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã { #context-managers }

### –ß—Ç–æ —Ç–∞–∫–æ–µ ¬´–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã¬ª { #what-are-context-managers }

¬´–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã¬ª ‚Äî —ç—Ç–æ –ª—é–±—ã–µ –æ–±—ä–µ–∫—Ç—ã Python, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–µ `with`.

–ù–∞–ø—Ä–∏–º–µ—Ä, <a href="https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files" class="external-link" target="_blank">–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `with` –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞</a>:

```Python
with open("./somefile.txt") as f:
    contents = f.read()
    print(contents)
```

–ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –≤—ã–∑–æ–≤ `open("./somefile.txt")` —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç, –Ω–∞–∑—ã–≤–∞–µ–º—ã–π ¬´–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º¬ª.

–ö–æ–≥–¥–∞ –±–ª–æ–∫ `with` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –æ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª, –¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

–ö–æ–≥–¥–∞ –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å `yield`, **FastAPI** –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥–ª—è –Ω–µ—ë –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ —Å–æ—á–µ—Ç–∞–µ—Ç –µ–≥–æ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –¥—Ä—É–≥–∏–º–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö —Å `yield` { #using-context-managers-in-dependencies-with-yield }

/// warning | –í–Ω–∏–º–∞–Ω–∏–µ

–≠—Ç–æ, –±–æ–ª–µ–µ –∏–ª–∏ –º–µ–Ω–µ–µ, ¬´–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è¬ª –∏–¥–µ—è.

–ï—Å–ª–∏ –≤—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å **FastAPI**, —Ç–æ –ª—É—á—à–µ –ø–æ–∫–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç.

///

–í Python –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, <a href="https://docs.python.org/3/reference/datamodel.html#context-managers" class="external-link" target="_blank">—Å–æ–∑–¥–∞–≤ –∫–ª–∞—Å—Å —Å –¥–≤—É–º—è –º–µ—Ç–æ–¥–∞–º–∏: `__enter__()` –∏ `__exit__()`</a>.

–ò—Ö —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π **FastAPI** —Å `yield`, –ø—Ä–∏–º–µ–Ω—è—è –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
`with` –∏–ª–∏ `async with` –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

{* ../../docs_src/dependencies/tutorial010.py hl[1:9,13] *}

/// tip | –ü–æ–¥—Å–∫–∞–∑–∫–∞

–î—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Äî —Å –ø–æ–º–æ—â—å—é:

* <a href="https://docs.python.org/3/library/contextlib.html#contextlib.contextmanager" class="external-link" target="_blank">`@contextlib.contextmanager`</a> –∏–ª–∏
* <a href="https://docs.python.org/3/library/contextlib.html#contextlib.asynccontextmanager" class="external-link" target="_blank">`@contextlib.asynccontextmanager`</a>

–æ—Ñ–æ—Ä–º–∏–≤ –∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—é —Å –æ–¥–Ω–∏–º `yield`.

–ò–º–µ–Ω–Ω–æ —ç—Ç–æ **FastAPI** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å `yield`.

–ù–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π FastAPI –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–∏ –Ω–µ —Å—Ç–æ–∏—Ç).

FastAPI —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ –≤–∞—Å –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º —É—Ä–æ–≤–Ω–µ.

///
