# Тестування залежностей із перевизначеннями { #testing-dependencies-with-overrides }

## Перевизначення залежностей під час тестування { #overriding-dependencies-during-testing }

Є кілька сценаріїв, коли під час тестування може знадобитися перевизначити залежність.

Ви не хочете, щоб виконувалася початкова залежність (а також будь-які її підзалежності).

Натомість ви хочете надати іншу залежність, яка використовуватиметься лише під час тестів (можливо, лише в деяких конкретних тестах) і повертатиме значення, яке можна використати там, де використовувалося значення початкової залежності.

### Випадки використання: зовнішній сервіс { #use-cases-external-service }

Наприклад, у вас може бути зовнішній провайдер автентифікації, якого потрібно викликати.

Ви надсилаєте йому токен, і він повертає автентифікованого користувача.

Цей провайдер може брати плату за кожен запит, а виклик може займати більше часу, ніж якби для тестів ви мали фіксованого mock-користувача.

Імовірно, ви хочете протестувати зовнішнього провайдера один раз, але не обов’язково викликати його для кожного тесту, що виконується.

У такому разі ви можете перевизначити залежність, яка викликає цього провайдера, і використовувати власну залежність, що повертає mock-користувача, лише для ваших тестів.

### Використання атрибута `app.dependency_overrides` { #use-the-app-dependency-overrides-attribute }

Для таких випадків ваш застосунок **FastAPI** має атрибут `app.dependency_overrides` — це простий `dict`.

Щоб перевизначити залежність для тестування, ви вказуєте як ключ початкову залежність (функцію), а як значення — ваше перевизначення залежності (іншу функцію).

Після цього **FastAPI** викликатиме перевизначення замість початкової залежності.

{* ../../docs_src/dependency_testing/tutorial001_an_py310.py hl[26:27,30] *}

/// tip | Порада

Ви можете встановити перевизначення залежності для залежності, що використовується будь-де у вашому застосунку **FastAPI**.

Початкова залежність може використовуватися у *функції операції шляху*, у *декораторі операції шляху* (коли ви не використовуєте повернене значення), у виклику `.include_router()` тощо.

FastAPI все одно зможе її перевизначити.

///

Потім ви можете скинути перевизначення (прибрати їх), встановивши `app.dependency_overrides` як порожній `dict`:

```Python
app.dependency_overrides = {}
```

/// tip | Порада

Якщо ви хочете перевизначувати залежність лише під час деяких тестів, ви можете встановити перевизначення на початку тесту (всередині функції тесту) і скинути його в кінці (наприкінці функції тесту).

///
