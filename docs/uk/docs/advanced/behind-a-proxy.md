# –ó–∞ –ø—Ä–æ–∫—Å—ñ { #behind-a-proxy }

–£ –±–∞–≥–∞—Ç—å–æ—Ö —Å–∏—Ç—É–∞—Ü—ñ—è—Ö –ø–µ—Ä–µ–¥ –≤–∞—à–∏–º –∑–∞—Å—Ç–æ—Å—É–Ω–∫–æ–º FastAPI –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ—Ç–µ **–ø—Ä–æ–∫—Å—ñ**, —è–∫-–æ—Ç Traefik –∞–±–æ Nginx.

–¢–∞–∫—ñ –ø—Ä–æ–∫—Å—ñ –º–æ–∂—É—Ç—å –æ–±—Ä–æ–±–ª—è—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ HTTPS —Ç–∞ —ñ–Ω—à—ñ —Ä–µ—á—ñ.

## Forwarded-–∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–æ–∫—Å—ñ { #proxy-forwarded-headers }

**–ü—Ä–æ–∫—Å—ñ** –ø–µ—Ä–µ–¥ –≤–∞—à–∏–º –∑–∞—Å—Ç–æ—Å—É–Ω–∫–æ–º –∑–∞–∑–≤–∏—á–∞–π ¬´–Ω–∞ –ª—å–æ—Ç—É¬ª –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –¥–µ—è–∫—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–µ—Ä–µ–¥ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è–º –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –≤–∞—à **—Å–µ—Ä–≤–µ—Ä**, —â–æ–± –ø–æ–≤—ñ–¥–æ–º–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä—É, —â–æ –∑–∞–ø–∏—Ç –±—É–≤ **–ø–µ—Ä–µ—Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π** –ø—Ä–æ–∫—Å—ñ, —ñ –ø–µ—Ä–µ–¥–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π (–ø—É–±–ª—ñ—á–Ω–∏–π) URL, –≤–∫–ª—é—á–Ω–æ –∑ –¥–æ–º–µ–Ω–æ–º, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è HTTPS —Ç–æ—â–æ.

–ü—Ä–æ–≥—Ä–∞–º–∞ **—Å–µ—Ä–≤–µ—Ä–∞** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **Uvicorn** —á–µ—Ä–µ–∑ **FastAPI CLI**) —É–º—ñ—î —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É–≤–∞—Ç–∏ —Ü—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∞ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤–∞—à–æ–º—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.

–ê–ª–µ –∑ –º—ñ—Ä–∫—É–≤–∞–Ω—å –±–µ–∑–ø–µ–∫–∏, –æ—Å–∫—ñ–ª—å–∫–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–Ω–∞—î, —â–æ –≤—ñ–Ω –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ –¥–æ–≤—ñ—Ä–µ–Ω–∏–º –ø—Ä–æ–∫—Å—ñ, –≤—ñ–Ω –Ω–µ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É–≤–∞—Ç–∏–º–µ —Ü—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏.

/// note | –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

–ó–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–æ–∫—Å—ñ:

* <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" class="external-link" target="_blank">X-Forwarded-For</a>
* <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-Proto" class="external-link" target="_blank">X-Forwarded-Proto</a>
* <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-Host" class="external-link" target="_blank">X-Forwarded-Host</a>

///

### –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è Forwarded-–∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ –ø—Ä–æ–∫—Å—ñ { #enable-proxy-forwarded-headers }

–í–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ FastAPI CLI –∑ *CLI Option* `--forwarded-allow-ips` —ñ –ø–µ—Ä–µ–¥–∞—Ç–∏ IP-–∞–¥—Ä–µ—Å–∏, —è–∫–∏–º —Å–ª—ñ–¥ –¥–æ–≤—ñ—Ä—è—Ç–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —Ü–∏—Ö forwarded-–∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤.

–Ø–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `--forwarded-allow-ips="*"`, –¥–æ–≤—ñ—Ä–∞ –±—É–¥–µ –¥–æ –≤—Å—ñ—Ö –≤—Ö—ñ–¥–Ω–∏—Ö IP.

–Ø–∫—â–æ –≤–∞—à **—Å–µ—Ä–≤–µ—Ä** –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ –¥–æ–≤—ñ—Ä–µ–Ω–∏–º **–ø—Ä–æ–∫—Å—ñ** —ñ –ª–∏—à–µ –ø—Ä–æ–∫—Å—ñ –∑–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ –Ω—å–æ–≥–æ, —Ü–µ –∑–º—É—Å–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–π–º–∞—Ç–∏ —è–∫ ¬´–¥–æ–∑–≤–æ–ª–µ–Ω—É¬ª —Ç—É IP-–∞–¥—Ä–µ—Å—É, –∑ —è–∫–æ—ó –ø—Ä–∏—Ö–æ–¥—è—Ç—å –∑–∞–ø–∏—Ç–∏ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ ‚Äî —Ç–æ–±—Ç–æ IP —Ü—å–æ–≥–æ **–ø—Ä–æ–∫—Å—ñ**.

<div class="termy">

```console
$ fastapi run --forwarded-allow-ips="*"

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

### –†–µ–¥—ñ—Ä–µ–∫—Ç–∏ –∑ HTTPS { #redirects-with-https }

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–∏–ø—É—Å—Ç—ñ–º–æ, –≤–∏ –≤–∏–∑–Ω–∞—á–∏–ª–∏ *–æ–ø–µ—Ä–∞—Ü—ñ—é —à–ª—è—Ö—É* `/items/`:

{* ../../docs_src/behind_a_proxy/tutorial001_01_py39.py hl[6] *}

–Ø–∫—â–æ –∫–ª—ñ—î–Ω—Ç —Å–ø—Ä–æ–±—É—î –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/items`, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –π–æ–≥–æ –±—É–¥–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ `/items/`.

–ê–ª–µ –¥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è *CLI Option* `--forwarded-allow-ips` —Ä–µ–¥—ñ—Ä–µ–∫—Ç –º–æ–∂–µ –≤–µ—Å—Ç–∏ –Ω–∞ `http://localhost:8000/items/`.

–¢–∞, –º–æ–∂–ª–∏–≤–æ, –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —Ä–æ–∑–º—ñ—â–µ–Ω–æ –Ω–∞ `https://mysuperapp.com`, —ñ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –º–∞—î –≤–µ—Å—Ç–∏ –Ω–∞ `https://mysuperapp.com/items/`.

–ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `--proxy-headers` FastAPI –∑–º–æ–∂–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ. üòé

```
https://mysuperapp.com/items/
```

/// tip | –ü–æ—Ä–∞–¥–∞

–Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ HTTPS, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ø–æ—Å—ñ–±–Ω–∏–∫ [–ü—Ä–æ HTTPS](../deployment/https.md){.internal-link target=_blank}.

///

### –Ø–∫ –ø—Ä–∞—Ü—é—é—Ç—å Forwarded-–∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–æ–∫—Å—ñ { #how-proxy-forwarded-headers-work }

–û—Å—å –≤—ñ–∑—É–∞–ª—å–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ **–ø—Ä–æ–∫—Å—ñ** –¥–æ–¥–∞—î forwarded-–∑–∞–≥–æ–ª–æ–≤–∫–∏ –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–æ–º —ñ **—Å–µ—Ä–≤–µ—Ä–æ–º –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É**:

```mermaid
sequenceDiagram
    participant Client
    participant Proxy as Proxy/Load Balancer
    participant Server as FastAPI Server

    Client->>Proxy: HTTPS Request<br/>Host: mysuperapp.com<br/>Path: /items

    Note over Proxy: Proxy adds forwarded headers

    Proxy->>Server: HTTP Request<br/>X-Forwarded-For: [client IP]<br/>X-Forwarded-Proto: https<br/>X-Forwarded-Host: mysuperapp.com<br/>Path: /items

    Note over Server: Server interprets headers<br/>(if --forwarded-allow-ips is set)

    Server->>Proxy: HTTP Response<br/>with correct HTTPS URLs

    Proxy->>Client: HTTPS Response
```

**–ü—Ä–æ–∫—Å—ñ** –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç –∫–ª—ñ—î–Ω—Ç–∞ –π –¥–æ–¥–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ *forwarded*-–∑–∞–≥–æ–ª–æ–≤–∫–∏ (`X-Forwarded-*`) –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ –ø–µ—Ä–µ–¥–∞—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ **—Å–µ—Ä–≤–µ—Ä –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É**.

–¶—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç, —è–∫–∞ —ñ–Ω–∞–∫—à–µ –±—É–ª–∞ –± –≤—Ç—Ä–∞—á–µ–Ω–∞:

* **X-Forwarded-For**: IP-–∞–¥—Ä–µ—Å–∞ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞
* **X-Forwarded-Proto**: –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª (`https`)
* **X-Forwarded-Host**: –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Ö–æ—Å—Ç (`mysuperapp.com`)

–ö–æ–ª–∏ **FastAPI CLI** –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∑ `--forwarded-allow-ips`, –≤—ñ–Ω –¥–æ–≤—ñ—Ä—è—î —Ü–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∞–º —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ó—Ö, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —â–æ–± –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ URL –≤ —Ä–µ–¥—ñ—Ä–µ–∫—Ç–∞—Ö.

## –ü—Ä–æ–∫—Å—ñ –∑—ñ ¬´–∑—Ä—ñ–∑–∞–Ω–∏–º¬ª –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É { #proxy-with-a-stripped-path-prefix }

–£ –≤–∞—Å –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–æ–∫—Å—ñ, —è–∫–∏–π –¥–æ–¥–∞—î –ø—Ä–µ—Ñ—ñ–∫—Å —à–ª—è—Ö—É –¥–æ –≤–∞—à–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.

–£ —Ç–∞–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `root_path` –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.

`root_path` ‚Äî —Ü–µ –º–µ—Ö–∞–Ω—ñ–∑–º, –Ω–∞–¥–∞–Ω–∏–π —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é ASGI (–Ω–∞ —è–∫—ñ–π –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π FastAPI —á–µ—Ä–µ–∑ Starlette).

`root_path` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ —Ç–∞–∫–∏—Ö —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤.

–¢–∞–∫–æ–∂ –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ –ø—ñ–¥ —á–∞—Å –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤.

–ù–∞—è–≤–Ω—ñ—Å—Ç—å –ø—Ä–æ–∫—Å—ñ –∑—ñ ¬´–∑—Ä—ñ–∑–∞–Ω–∏–º¬ª –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É –≤ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –æ–≥–æ–ª–æ—Å–∏—Ç–∏ —à–ª—è—Ö `/app` —É —Å–≤–æ—î–º—É –∫–æ–¥—ñ, –∞–ª–µ –ø–æ—Ç—ñ–º –¥–æ–¥–∞—Ç–∏ —à–∞—Ä –∑–≤–µ—Ä—Ö—É (–ø—Ä–æ–∫—Å—ñ), —è–∫–∏–π —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç—å –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ **FastAPI** –ø—ñ–¥ —à–ª—è—Ö–æ–º –Ω–∞ –∫—à—Ç–∞–ª—Ç `/api/v1`.

–£ —Ü—å–æ–º—É —Ä–∞–∑—ñ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —à–ª—è—Ö `/app` —Ñ–∞–∫—Ç–∏—á–Ω–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏–º–µ—Ç—å—Å—è –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/api/v1/app`.

–ü–æ–ø—Ä–∏ —Ç–µ, —â–æ –≤–µ—Å—å –≤–∞—à –∫–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω–æ —Ç–∞–∫, –Ω—ñ–±–∏ —ñ—Å–Ω—É—î –ª–∏—à–µ `/app`.

{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[6] *}

–Ü –ø—Ä–æ–∫—Å—ñ –±—É–¥–µ **¬´–∑—Ä—ñ–∑–∞—Ç–∏¬ª** **–ø—Ä–µ—Ñ—ñ–∫—Å —à–ª—è—Ö—É** –Ω–∞ –ª—å–æ—Ç—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞–≤–∞–Ω–Ω—è–º –∑–∞–ø–∏—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É (–π–º–æ–≤—ñ—Ä–Ω–æ, Uvicorn —á–µ—Ä–µ–∑ FastAPI CLI), –∑–∞–ª–∏—à–∞—é—á–∏ –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –ø–µ—Ä–µ–∫–æ–Ω–∞–Ω–∏–º, —â–æ –π–æ–≥–æ –æ–±—Å–ª—É–≥–æ–≤—É—é—Ç—å –Ω–∞ `/app`, —Ç–æ–∂ –≤–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –≤–µ—Å—å –∫–æ–¥, –¥–æ–¥–∞—é—á–∏ –ø—Ä–µ—Ñ—ñ–∫—Å `/api/v1`.

–î–æ —Ü—å–æ–≥–æ –º–æ–º–µ–Ω—Ç—É –≤—Å–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ —è–∫ –∑–∞–∑–≤–∏—á–∞–π.

–ê–ª–µ –ø–æ—Ç—ñ–º, –∫–æ–ª–∏ –≤–∏ –≤—ñ–¥–∫—Ä–∏—î—Ç–µ –≤–±—É–¥–æ–≤–∞–Ω–∏–π UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó (frontend), –≤—ñ–Ω –æ—á—ñ–∫—É–≤–∞—Ç–∏–º–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å—Ö–µ–º—É OpenAPI –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/openapi.json`, –∞ –Ω–µ `/api/v1/openapi.json`.

–¢–æ–∂ frontend (—è–∫–∏–π –ø—Ä–∞—Ü—é—î –≤ –±—Ä–∞—É–∑–µ—Ä—ñ) —Å–ø—Ä–æ–±—É—î –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ `/openapi.json` —ñ –Ω–µ –∑–º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å—Ö–µ–º—É OpenAPI.

–û—Å–∫—ñ–ª—å–∫–∏ –¥–ª—è –Ω–∞—à–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–æ–∫—Å—ñ –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É `/api/v1`, frontend –º–∞—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å—Ö–µ–º—É OpenAPI –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/api/v1/openapi.json`.

```mermaid
graph LR

browser("Browser")
proxy["Proxy on http://0.0.0.0:9999/api/v1/app"]
server["Server on http://127.0.0.1:8000/app"]

browser --> proxy
proxy --> server
```

/// tip | –ü–æ—Ä–∞–¥–∞

IP `0.0.0.0` –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å, —â–æ–± –æ–∑–Ω–∞—á–∏—Ç–∏: –ø—Ä–æ–≥—Ä–∞–º–∞ —Å–ª—É—Ö–∞—î –Ω–∞ –≤—Å—ñ—Ö IP, –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –Ω–∞ —Ü—ñ–π –º–∞—à–∏–Ω—ñ/—Å–µ—Ä–≤–µ—Ä—ñ.

///

UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Å—Ö–µ–º–∞ OpenAPI, —â–æ–± –∑–∞–¥–µ–∫–ª–∞—Ä—É–≤–∞—Ç–∏, —â–æ —Ü–µ–π API `server` —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –Ω–∞ `/api/v1` (–∑–∞ –ø—Ä–æ–∫—Å—ñ). –ù–∞–ø—Ä–∏–∫–ª–∞–¥:

```JSON hl_lines="4-8"
{
    "openapi": "3.1.0",
    // More stuff here
    "servers": [
        {
            "url": "/api/v1"
        }
    ],
    "paths": {
            // More stuff here
    }
}
```

–£ —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ ¬´Proxy¬ª –º–æ–∂–µ –±—É—Ç–∏ —á–∏–º–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç **Traefik**. –ê —Å–µ—Ä–≤–µ—Ä–æ–º –º–æ–∂–µ –±—É—Ç–∏ FastAPI CLI –∑ **Uvicorn**, —è–∫–∏–π –∑–∞–ø—É—Å–∫–∞—î –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ FastAPI.

### –ù–∞–¥–∞–Ω–Ω—è `root_path` { #providing-the-root-path }

–©–æ–± —Ü—å–æ–≥–æ –¥–æ—Å—è–≥—Ç–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –æ–ø—Ü—ñ—é –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ `--root-path`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

<div class="termy">

```console
$ fastapi run main.py --forwarded-allow-ips="*" --root-path /api/v1

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

–Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ Hypercorn, —É –Ω—å–æ–≥–æ —Ç–∞–∫–æ–∂ —î –æ–ø—Ü—ñ—è `--root-path`.

/// note | –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

–°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è ASGI –≤–∏–∑–Ω–∞—á–∞—î `root_path` –¥–ª—è —Ü—å–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é.

–ê –æ–ø—Ü—ñ—è –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ `--root-path` –Ω–∞–¥–∞—î —Ü–µ–π `root_path`.

///

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ `root_path` { #checking-the-current-root-path }

–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π `root_path`, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤–∞—à–∏–º –∑–∞—Å—Ç–æ—Å—É–Ω–∫–æ–º –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É: –≤—ñ–Ω —î —á–∞—Å—Ç–∏–Ω–æ—é —Å–ª–æ–≤–Ω–∏–∫–∞ `scope` (—Ü–µ —á–∞—Å—Ç–∏–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó ASGI).

–¢—É—Ç –º–∏ –≤–∫–ª—é—á–∞—î–º–æ –π–æ–≥–æ –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ª–∏—à–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó.

{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[8] *}

–î–∞–ª—ñ, —è–∫—â–æ –≤–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Uvicorn —Ç–∞–∫:

<div class="termy">

```console
$ fastapi run main.py --forwarded-allow-ips="*" --root-path /api/v1

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

–í—ñ–¥–ø–æ–≤—ñ–¥—å –±—É–¥–µ –ø—Ä–∏–±–ª–∏–∑–Ω–æ —Ç–∞–∫–æ—é:

```JSON
{
    "message": "Hello World",
    "root_path": "/api/v1"
}
```

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `root_path` —É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É FastAPI { #setting-the-root-path-in-the-fastapi-app }

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, —è–∫—â–æ —É –≤–∞—Å –Ω–µ–º–∞—î —Å–ø–æ—Å–æ–±—É –ø–µ—Ä–µ–¥–∞—Ç–∏ –æ–ø—Ü—ñ—é –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ –Ω–∞ –∫—à—Ç–∞–ª—Ç `--root-path` –∞–±–æ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω—É, –≤–∏ –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `root_path` –ø—ñ–¥ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É FastAPI:

{* ../../docs_src/behind_a_proxy/tutorial002_py39.py hl[3] *}

–ü–µ—Ä–µ–¥–∞–≤–∞–Ω–Ω—è `root_path` —É `FastAPI` –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–Ω–Ω—é –æ–ø—Ü—ñ—ó –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ `--root-path` –¥–æ Uvicorn –∞–±–æ Hypercorn.

### –ü—Ä–æ `root_path` { #about-root-path }

–ú–∞–π—Ç–µ –Ω–∞ —É–≤–∞–∑—ñ: —Å–µ—Ä–≤–µ—Ä (Uvicorn) –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ —Ü–µ–π `root_path` –Ω—ñ –¥–ª—è —á–æ–≥–æ —ñ–Ω—à–æ–≥–æ, –æ–∫—Ä—ñ–º –ø–µ—Ä–µ–¥–∞–≤–∞–Ω–Ω—è –π–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.

–ê–ª–µ —è–∫—â–æ –≤–∏ –ø–µ—Ä–µ–π–¥–µ—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ –Ω–∞ <a href="http://127.0.0.1:8000/app" class="external-link" target="_blank">http://127.0.0.1:8000/app</a>, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –∑–≤–∏—á–∞–π–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å:

```JSON
{
    "message": "Hello World",
    "root_path": "/api/v1"
}
```

–û—Ç–∂–µ, –≤—ñ–Ω –Ω–µ –æ—á—ñ–∫—É–≤–∞—Ç–∏–º–µ –¥–æ—Å—Ç—É–ø—É –∑–∞ –∞–¥—Ä–µ—Å–æ—é `http://127.0.0.1:8000/api/v1/app`.

Uvicorn –æ—á—ñ–∫—É–≤–∞—Ç–∏–º–µ, —â–æ –ø—Ä–æ–∫—Å—ñ –∑–≤–µ—Ä—Ç–∞—Ç–∏–º–µ—Ç—å—Å—è –¥–æ Uvicorn –∑–∞ –∞–¥—Ä–µ—Å–æ—é `http://127.0.0.1:8000/app`, –∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –ø—Ä–µ—Ñ—ñ–∫—Å–∞ `/api/v1` –∑–≤–µ—Ä—Ö—É ‚Äî —Ü–µ –≤–∂–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –ø—Ä–æ–∫—Å—ñ.

## –ü—Ä–æ –ø—Ä–æ–∫—Å—ñ –∑—ñ ¬´–∑—Ä—ñ–∑–∞–Ω–∏–º¬ª –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É { #about-proxies-with-a-stripped-path-prefix }

–ú–∞–π—Ç–µ –Ω–∞ —É–≤–∞–∑—ñ: –ø—Ä–æ–∫—Å—ñ –∑—ñ ¬´–∑—Ä—ñ–∑–∞–Ω–∏–º¬ª –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É ‚Äî –ª–∏—à–µ –æ–¥–∏–Ω –∑—ñ —Å–ø–æ—Å–æ–±—ñ–≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.

–ô–º–æ–≤—ñ—Ä–Ω–æ, —É –±–∞–≥–∞—Ç—å–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø—Ä–æ–∫—Å—ñ –Ω–µ –º–∞—Ç–∏–º–µ ¬´–∑—Ä—ñ–∑–∞–Ω–æ–≥–æ¬ª –ø—Ä–µ—Ñ—ñ–∫—Å–∞ —à–ª—è—Ö—É.

–£ —Ç–∞–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É (–±–µ–∑ ¬´–∑—Ä—ñ–∑–∞–Ω–æ–≥–æ¬ª –ø—Ä–µ—Ñ—ñ–∫—Å–∞) –ø—Ä–æ–∫—Å—ñ —Å–ª—É—Ö–∞—Ç–∏–º–µ —â–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç `https://myawesomeapp.com`, —ñ —Ç–æ–¥—ñ, —è–∫—â–æ –±—Ä–∞—É–∑–µ—Ä –ø–µ—Ä–µ–π–¥–µ –Ω–∞ `https://myawesomeapp.com/api/v1/app`, –∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Uvicorn) —Å–ª—É—Ö–∞—î –Ω–∞ `http://127.0.0.1:8000`, –ø—Ä–æ–∫—Å—ñ (–±–µ–∑ ¬´–∑—Ä—ñ–∑–∞–Ω–æ–≥–æ¬ª –ø—Ä–µ—Ñ—ñ–∫—Å–∞ —à–ª—è—Ö—É) –∑–≤–µ—Ä—Ç–∞—Ç–∏–º–µ—Ç—å—Å—è –¥–æ Uvicorn –∑–∞ —Ç–∏–º —Å–∞–º–∏–º —à–ª—è—Ö–æ–º: `http://127.0.0.1:8000/api/v1/app`.

## –õ–æ–∫–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ Traefik { #testing-locally-with-traefik }

–í–∏ –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü–µ–π –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ª–æ–∫–∞–ª—å–Ω–æ –∑—ñ ¬´–∑—Ä—ñ–∑–∞–Ω–∏–º¬ª –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ <a href="https://docs.traefik.io/" class="external-link" target="_blank">Traefik</a>.

<a href="https://github.com/containous/traefik/releases" class="external-link" target="_blank">–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Traefik</a> ‚Äî —Ü–µ –æ–¥–∏–Ω –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª; –≤–∏ –º–æ–∂–µ—Ç–µ —Ä–æ–∑–ø–∞–∫—É–≤–∞—Ç–∏ —Å—Ç–∏—Å–Ω–µ–Ω–∏–π —Ñ–∞–π–ª —ñ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –π–æ–≥–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª–∞.

–ü–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `traefik.toml` —ñ–∑ —Ç–∞–∫–∏–º –≤–º—ñ—Å—Ç–æ–º:

```TOML hl_lines="3"
[entryPoints]
  [entryPoints.http]
    address = ":9999"

[providers]
  [providers.file]
    filename = "routes.toml"
```

–¶–µ –≤–∫–∞–∑—É—î Traefik —Å–ª—É—Ö–∞—Ç–∏ –ø–æ—Ä—Ç 9999 —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–π —Ñ–∞–π–ª `routes.toml`.

/// tip | –ü–æ—Ä–∞–¥–∞

–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–æ—Ä—Ç 9999 –∑–∞–º—ñ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ HTTP-–ø–æ—Ä—Ç—É 80, —â–æ–± –≤–∞–º –Ω–µ –¥–æ–≤–æ–¥–∏–ª–æ—Å—è –∑–∞–ø—É—Å–∫–∞—Ç–∏ –π–æ–≥–æ –∑ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (`sudo`).

///

–¢–µ–ø–µ—Ä —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ç–æ–π —ñ–Ω—à–∏–π —Ñ–∞–π–ª `routes.toml`:

```TOML hl_lines="5  12  20"
[http]
  [http.middlewares]

    [http.middlewares.api-stripprefix.stripPrefix]
      prefixes = ["/api/v1"]

  [http.routers]

    [http.routers.app-http]
      entryPoints = ["http"]
      service = "app"
      rule = "PathPrefix(`/api/v1`)"
      middlewares = ["api-stripprefix"]

  [http.services]

    [http.services.app]
      [http.services.app.loadBalancer]
        [[http.services.app.loadBalancer.servers]]
          url = "http://127.0.0.1:8000"
```

–¶–µ–π —Ñ–∞–π–ª –Ω–∞–ª–∞—à—Ç–æ–≤—É—î Traefik –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–µ—Ñ—ñ–∫—Å–∞ —à–ª—è—Ö—É `/api/v1`.

–Ü —Ç–æ–¥—ñ Traefik –ø–µ—Ä–µ—Å–ø—Ä—è–º–æ–≤—É–≤–∞—Ç–∏–º–µ —Å–≤–æ—ó –∑–∞–ø–∏—Ç–∏ –¥–æ –≤–∞—à–æ–≥–æ Uvicorn, —â–æ –ø—Ä–∞—Ü—é—î –Ω–∞ `http://127.0.0.1:8000`.

–¢–µ–ø–µ—Ä –∑–∞–ø—É—Å—Ç—ñ—Ç—å Traefik:

<div class="termy">

```console
$ ./traefik --configFile=traefik.toml

INFO[0000] Configuration loaded from file: /home/user/awesomeapi/traefik.toml
```

</div>

–ê —Ç–µ–ø–µ—Ä –∑–∞–ø—É—Å—Ç—ñ—Ç—å –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –æ–ø—Ü—ñ—é `--root-path`:

<div class="termy">

```console
$ fastapi run main.py --forwarded-allow-ips="*" --root-path /api/v1

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π { #check-the-responses }

–¢–µ–ø–µ—Ä, —è–∫—â–æ –≤–∏ –ø–µ—Ä–µ–π–¥–µ—Ç–µ –Ω–∞ URL –∑ –ø–æ—Ä—Ç–æ–º Uvicorn: <a href="http://127.0.0.1:8000/app" class="external-link" target="_blank">http://127.0.0.1:8000/app</a>, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –∑–≤–∏—á–∞–π–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å:

```JSON
{
    "message": "Hello World",
    "root_path": "/api/v1"
}
```

/// tip | –ü–æ—Ä–∞–¥–∞

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É: —Ö–æ—á–∞ –≤–∏ –∑–≤–µ—Ä—Ç–∞—î—Ç–µ—Å—è –∑–∞ –∞–¥—Ä–µ—Å–æ—é `http://127.0.0.1:8000/app`, –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è `root_path` `/api/v1`, —É–∑—è—Ç–∏–π –∑ –æ–ø—Ü—ñ—ó `--root-path`.

///

–ê —Ç–µ–ø–µ—Ä –≤—ñ–¥–∫—Ä–∏–π—Ç–µ URL –∑ –ø–æ—Ä—Ç–æ–º Traefik, –≤–∫–ª—é—á–Ω–æ –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É: <a href="http://127.0.0.1:9999/api/v1/app" class="external-link" target="_blank">http://127.0.0.1:9999/api/v1/app</a>.

–ú–∏ –æ—Ç—Ä–∏–º—É—î–º–æ —Ç—É —Å–∞–º—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å:

```JSON
{
    "message": "Hello World",
    "root_path": "/api/v1"
}
```

–∞–ª–µ —Ü—å–æ–≥–æ —Ä–∞–∑—É –∑–∞ URL —ñ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É, –Ω–∞–¥–∞–Ω–∏–º –ø—Ä–æ–∫—Å—ñ: `/api/v1`.

–ó–≤—ñ—Å–Ω–æ, —ñ–¥–µ—è —Ç—É—Ç —É —Ç–æ–º—É, —â–æ –≤—Å—ñ –∑–≤–µ—Ä—Ç–∞—Ç–∏–º—É—Ç—å—Å—è –¥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ, —Ç–æ–∂ –≤–∞—Ä—ñ–∞–Ω—Ç —ñ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É `/api/v1` —î ¬´–ø—Ä–∞–≤–∏–ª—å–Ω–∏–º¬ª.

–ê –≤–∞—Ä—ñ–∞–Ω—Ç –±–µ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å–∞ —à–ª—è—Ö—É (`http://127.0.0.1:8000/app`), —è–∫–∏–π –Ω–∞–¥–∞—î –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ Uvicorn, –±—É–¥–µ –≤–∏–∫–ª—é—á–Ω–æ –¥–ª—è –¥–æ—Å—Ç—É–ø—É _–ø—Ä–æ–∫—Å—ñ_ (Traefik) –¥–æ –Ω—å–æ–≥–æ.

–¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫ Proxy (Traefik) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–µ—Ñ—ñ–∫—Å —à–ª—è—Ö—É —ñ —è–∫ —Å–µ—Ä–≤–µ—Ä (Uvicorn) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `root_path` –∑ –æ–ø—Ü—ñ—ó `--root-path`.

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó { #check-the-docs-ui }

–ê–ª–µ –Ω–∞–π—Ü—ñ–∫–∞–≤—ñ—à–µ ‚Äî –¥–∞–ª—ñ. ‚ú®

¬´–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π¬ª —Å–ø–æ—Å—ñ–± –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É ‚Äî —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º —à–ª—è—Ö—É, —è–∫–∏–π –º–∏ –≤–∏–∑–Ω–∞—á–∏–ª–∏. –¢–æ–∂, —è–∫ —ñ —Å–ª—ñ–¥ –æ—á—ñ–∫—É–≤–∞—Ç–∏, —è–∫—â–æ –≤–∏ —Å–ø—Ä–æ–±—É—î—Ç–µ UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó, —è–∫–∏–π –≤—ñ–¥–¥–∞—î Uvicorn –Ω–∞–ø—Ä—è–º—É, –±–µ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å–∞ —à–ª—è—Ö—É –≤ URL, –≤—ñ–Ω –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ, –±–æ –æ—á—ñ–∫—É—î –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü–µ –∑–∞ –∞–¥—Ä–µ—Å–æ—é <a href="http://127.0.0.1:8000/docs" class="external-link" target="_blank">http://127.0.0.1:8000/docs</a>:

<img src="/img/tutorial/behind-a-proxy/image01.png">

–ê–ª–µ —è–∫—â–æ –º–∏ –∑–≤–µ—Ä–Ω–µ–º–æ—Å—è –¥–æ UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –∑–∞ ¬´–æ—Ñ—ñ—Ü—ñ–π–Ω–æ—é¬ª URL —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ –Ω–∞ –ø–æ—Ä—Ç—É `9999`, –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/api/v1/docs`, –≤—ñ–Ω –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ! üéâ

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü–µ –∑–∞ –∞–¥—Ä–µ—Å–æ—é <a href="http://127.0.0.1:9999/api/v1/docs" class="external-link" target="_blank">http://127.0.0.1:9999/api/v1/docs</a>:

<img src="/img/tutorial/behind-a-proxy/image02.png">

–°–∞–º–µ —Ç–∞–∫, —è–∫ –º–∏ –π —Ö–æ—Ç—ñ–ª–∏. ‚úîÔ∏è

–¶–µ —Ç–æ–º—É, —â–æ FastAPI –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü–µ–π `root_path`, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ `server` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤ OpenAPI –∑ URL, –Ω–∞–¥–∞–Ω–∏–º —á–µ—Ä–µ–∑ `root_path`.

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å–µ—Ä–≤–µ—Ä–∏ { #additional-servers }

/// warning | –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è

–¶–µ –±—ñ–ª—å—à –ø—Ä–æ—Å—É–Ω—É—Ç–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π. –ó–∞ –±–∞–∂–∞–Ω–Ω—è–º –º–æ–∂–µ—Ç–µ –π–æ–≥–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏.

///

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º **FastAPI** —Å—Ç–≤–æ—Ä—é—î `server` —É —Å—Ö–µ–º—ñ OpenAPI –∑ URL –¥–ª—è `root_path`.

–ê–ª–µ –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –Ω–∞–¥–∞—Ç–∏ —ñ–Ω—à—ñ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ `servers`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ —Ö–æ—á–µ—Ç–µ, —â–æ–± *—Ç–æ–π —Å–∞–º–∏–π* UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –≤–∑–∞—î–º–æ–¥—ñ—è–≤ —ñ –∑—ñ staging-, —ñ –∑ production-—Å–µ—Ä–µ–¥–æ–≤–∏—â–µ–º.

–Ø–∫—â–æ –≤–∏ –ø–µ—Ä–µ–¥–∞—î—Ç–µ –≤–ª–∞—Å–Ω–∏–π —Å–ø–∏—Å–æ–∫ `servers` —ñ —î `root_path` (–±–æ –≤–∞—à API –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ –ø—Ä–æ–∫—Å—ñ), **FastAPI** –≤—Å—Ç–∞–≤–∏—Ç—å ¬´server¬ª –∑ —Ü–∏–º `root_path` –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ —Å–ø–∏—Å–∫—É.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:

{* ../../docs_src/behind_a_proxy/tutorial003_py39.py hl[4:7] *}

–ó–≥–µ–Ω–µ—Ä—É—î —Å—Ö–µ–º—É OpenAPI –Ω–∞ –∫—à—Ç–∞–ª—Ç:

```JSON hl_lines="5-7"
{
    "openapi": "3.1.0",
    // More stuff here
    "servers": [
        {
            "url": "/api/v1"
        },
        {
            "url": "https://stag.example.com",
            "description": "Staging environment"
        },
        {
            "url": "https://prod.example.com",
            "description": "Production environment"
        }
    ],
    "paths": {
            // More stuff here
    }
}
```

/// tip | –ü–æ—Ä–∞–¥–∞

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π server –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º `url` `/api/v1`, —É–∑—è—Ç–∏–º –∑ `root_path`.

///

–£ UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –∑–∞ –∞–¥—Ä–µ—Å–æ—é <a href="http://127.0.0.1:9999/api/v1/docs" class="external-link" target="_blank">http://127.0.0.1:9999/api/v1/docs</a> —Ü–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏–º–µ —Ç–∞–∫:

<img src="/img/tutorial/behind-a-proxy/image03.png">

/// tip | –ü–æ—Ä–∞–¥–∞

UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏–º–µ –∑ —Ç–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º, —è–∫–∏–π –≤–∏ –≤–∏–±–µ—Ä–µ—Ç–µ.

///

/// note | –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

–í–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å `servers` —É —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó OpenAPI —î –Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ—é.

–Ø–∫—â–æ –≤–∏ –Ω–µ –≤–∫–∞–∑—É—î—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `servers` —ñ `root_path` –¥–æ—Ä—ñ–≤–Ω—é—î `/`, –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å `servers` —É –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ–π —Å—Ö–µ–º—ñ OpenAPI –±—É–¥–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –ø—Ä–æ–ø—É—â–µ–Ω–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, —â–æ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ –æ–¥–Ω–æ–º—É server –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º `url` `/`.

///

### –í–∏–º–∫–Ω–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ server –∑ `root_path` { #disable-automatic-server-from-root-path }

–Ø–∫—â–æ –≤–∏ –Ω–µ —Ö–æ—á–µ—Ç–µ, —â–æ–± **FastAPI** –≤–∫–ª—é—á–∞–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π server –∑ `root_path`, –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `root_path_in_servers=False`:

{* ../../docs_src/behind_a_proxy/tutorial004_py39.py hl[9] *}

—ñ —Ç–æ–¥—ñ –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—Ç–∏–º–µ—Ç—å—Å—è –≤ —Å—Ö–µ–º—É OpenAPI.

## –ú–æ–Ω—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∑–∞—Å—Ç–æ—Å—É–Ω–∫—É { #mounting-a-sub-application }

–Ø–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º–æ–Ω—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥–∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ (—è–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ [–ü—ñ–¥–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏ ‚Äî –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è](sub-applications.md){.internal-link target=_blank}), –≤–æ–¥–Ω–æ—á–∞—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø—Ä–æ–∫—Å—ñ –∑ `root_path`, –≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ —É –∑–≤–∏—á–Ω–∏–π —Å–ø–æ—Å—ñ–±.

FastAPI –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ ¬´—Ä–æ–∑—É–º–Ω–æ¬ª –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `root_path`, —Ç–æ–∂ —É—Å–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ. ‚ú®
