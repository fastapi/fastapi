# Тіло - Оновлення

## Оновленння за допомогою `PUT`

Щоб оновити елемент, Ви можете використати операцію<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PUT" class="external-link" target="_blank">HTTP `PUT`</a>.

Ви можете використовувати `jsonable_encoder` щоб конвертувати вхідні дані у дані, які можуть зберігатись у форматі JSON (наприклад NoSQL бази даних). Наприклад, конвертувати `datetime` у `str`.

{* ../../docs_src/body_updates/tutorial001_py310.py hl[28:33] *}

`PUT` використовується, щоб отримати дані, які мають замінити вже інснуючі.

### Застереження про заміну

Це означаняє, що у випадку зміни елемента `bar` використовуючи `PUT`, що містить таке тіло:

```Python
{
    "name": "Barz",
    "price": 3,
    "description": None,
}
```

то через те, що воно не включає вже збережений атрибут `"tax": 20.2`, модель введення візьме значення за замовчуванням `"tax": 10.5`.

І дані будуть збережні з цим "новим" `tax` зі значенням `10.5`.

## Часткові оновлення за допомогою `PATCH`

Також ви можете використовувати операцією<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PATCH" class="external-link" target="_blank">HTTP `PATCH`</a>, щоб *частково* оновити дані.

Це означає, що Ви можете надіслати тільки ті дані, які Ви бажаєте оновити, залишивши інші без змін

/// note

`PATCH` менш відомий, та використовується рідше ніж `PUT`.

І багато команд використовують `PUT` навіть для часткових оновлень.

Ви **вільні** і можете використовувати їх як Ви забажаєте, **FastAPI** не створює ніяких обмежень відносно цього.

Але, цей гайд показує Вам як (у більшій чи меншій мірі) задумано їхнє використання.

///

### Використання параметру `exclude_unset` з Pydantic

Якщо Ви хочете отримати часткове оновлення, дуже корисним буде використання параметру `exclude_unset` у моделі Pydantic `.model_dump()`.

Наприклад `item.model_dump(exclude_unset=True)`.

/// info

У Pydantic v1 метод називався `.dict()`, він застарів (але все ще підтримується) in Pydantic v2, і був переіменований на `.model_dump()`.

Приклади нижче використовують `.dict()` для сумісності з Pydantic v1, але Ви маєте використовувати `.model_dump()`, якщо Ви можете працювати з Pydantic v2.

///

Це згенерує `dict` тільки з тими даними, що були встановлені при створені моделі `item`, виключаючи значення за замовчуванням.

Потім, ви можете Використати `dict` тільки з тими даними, що були встановлені (надіслані у запиті), опускаючи значення за замовчуванням:

{* ../../docs_src/body_updates/tutorial002_py310.py hl[32] *}

### Використання параметру `update` з Pydantic

Тепер ви можете створити копію існуючої моделі використовуючи `.model_copy()`, і передати параметр `update` з `dict` з даними, які потрібно оновити.

/// info

У Pydantic v1 метод називався `.copy()`, він застарів (але все ще підтримується) in Pydantic v2, і був переіменований на `.model_copy()`.

Приклади нижче використовують `.copy()` для сумісності з Pydantic v1, але Ви маєте використовувати `.model_copy()`, якщо Ви можете працювати з Pydantic v2.

///

Наприклад `stored_item_model.model_copy(update=update_data)`:

{* ../../docs_src/body_updates/tutorial002_py310.py hl[33] *}

### Пригадаємо як працють часткові оновлення

У підсумку, для використання часткових оновлень Вам потрібно:

* (Опціонально) Використовуйте `PATCH` замість `PUT`.
* Витягнути збережені дані.
* Передати ці дані у модель Pydantic.
* Згенерувати `dict` без значень за замовчуванням з вхідних даних моделі (використовуючи `exclude_unset`).
    * Таким чином ви можете оновити тільки ті дані, які були встановлені користувачем, замість перезапису значень, що вже збережеі з значеннями за замовчуванням у Вашій моделі.
* Cтворити копію збереженої моделі, оновивши її атрибути за допомогою отриманих оновлень(використовуючи параметр the `update`).
* Конвертувати скопійовану модель у щось, що може бути збереже у вашій БД (наприклад, використовуючи `jsonable_encoder`).
    * Це порівнювано з використанням методу `.model_dump()` знову, але у цьому випадку він переконується (і перетворює) значення to у типи даних, що потім знову можуть бути конвертовані у JSON, наприклад, `datetime` у `str`.
* Save the data to your DB.
* Return the updated model.

{* ../../docs_src/body_updates/tutorial002_py310.py hl[28:35] *}

/// tip

Ви також можете використовувати таку ж техніку з операцією HTTP `PUT`.

Але приклади тут використовують `PATCH` саме тому, що він був створений для таких випадків.

///

/// note

Зверніть увагу, що вхідні дані моделі валідуються.

Отже, якщо ви хочете отримувати часткові оновлення, які можуть не враховувати всі атрибути, вам потрібно мати модель з усіма атрибутами, позначеними як необов'язкові (зі значеннями за замовчуванням або `None`).

Щоб відрізняти моделі з опціональними значеннями для **оновлень** і моделі зі значеннями, необхідними для **створення**, ви можете використовувати ідеї, що описані у[Extra Models](extra-models.md){.internal-link target=_blank}.

///
