# Умовний OpenAPI { #conditional-openapi }

За потреби ви можете використати налаштування та змінні середовища, щоб умовно конфігурувати OpenAPI залежно від середовища, і навіть повністю його вимкнути.

## Про безпеку, API та документацію { #about-security-apis-and-docs }

Приховування інтерфейсів документації у production *не повинно* бути способом захисту вашого API.

Це не додає жодної додаткової безпеки для вашого API — *операції шляху* усе одно будуть доступні там, де вони є.

Якщо у вашому коді є вразливість безпеки, вона все одно існуватиме.

Приховування документації лише ускладнює розуміння того, як взаємодіяти з вашим API, і може ускладнити вам налагодження в production. Це можна розглядати просто як форму <a href="https://en.wikipedia.org/wiki/Security_through_obscurity" class="external-link" target="_blank">безпеки через неочевидність</a>.

Якщо ви хочете захистити свій API, є кілька кращих речей, які ви можете зробити, наприклад:

* Переконайтеся, що у вас є чітко визначені моделі Pydantic для тіл запитів і відповідей.
* Налаштуйте всі необхідні дозволи та ролі за допомогою залежностей.
* Ніколи не зберігайте паролі у відкритому вигляді, лише хеші паролів.
* Реалізуйте та використовуйте добре відомі криптографічні інструменти, як-от pwdlib і JWT tokens тощо.
* Додайте більш деталізований контроль доступу за допомогою OAuth2 scopes там, де це потрібно.
* ...тощо.

Втім, у вас може бути дуже специфічний випадок використання, коли вам справді потрібно вимкнути документацію API для певного середовища (наприклад, для production) або залежно від конфігурацій зі змінних середовища.

## Умовний OpenAPI з налаштувань і змінних середовища { #conditional-openapi-from-settings-and-env-vars }

Ви можете легко використати ті самі налаштування Pydantic, щоб налаштувати згенерований OpenAPI та UI документації.

Наприклад:

{* ../../docs_src/conditional_openapi/tutorial001_py39.py hl[6,11] *}

Тут ми оголошуємо налаштування `openapi_url` з тим самим значенням за замовчуванням `"/openapi.json"`.

А потім використовуємо його під час створення застосунку `FastAPI`.

Далі ви можете вимкнути OpenAPI (включно з UI документації), встановивши змінну середовища `OPENAPI_URL` в порожній рядок, ось так:

<div class="termy">

```console
$ OPENAPI_URL= uvicorn main:app

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

Тоді, якщо ви перейдете за URL `/openapi.json`, `/docs` або `/redoc`, ви просто отримаєте помилку `404 Not Found`, наприклад:

```JSON
{
    "detail": "Not Found"
}
```
