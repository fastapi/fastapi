# Desenvolvimento - Contribuindo

Primeiramente, voc√™ deveria ver os meios b√°sicos para [ajudar FastAPI e pedir ajuda](help-fastapi.md){.internal-link target=_blank}.

## Desenvolvendo

Se voc√™ j√° clonou o reposit√≥rio e precisa mergulhar no c√≥digo, aqui est√£o algumas orienta√ß√µes para configurar seu ambiente.

### Ambiente virtual com `venv`

Voc√™ pode criar um ambiente virtual em um diret√≥rio utilizando o m√≥dulo `venv` do Python:

<div class="termy">

```console
$ python -m venv env
```

</div>

Isso criar√° o diret√≥rio `./env/` com os bin√°rios Python e ent√£o voc√™ ser√° capaz de instalar pacotes nesse ambiente isolado.

### Ativar o ambiente

Ative o novo ambiente com:

=== "Linux, macOS"

    <div class="termy">

    ```console
    $ source ./env/bin/activate
    ```

    </div>

=== "Windows PowerShell"

    <div class="termy">

    ```console
    $ .\env\Scripts\Activate.ps1
    ```

    </div>

=== "Windows Bash"

    Ou se voc√™ usa Bash para Windows (por exemplo <a href="https://gitforwindows.org/" class="external-link" target="_blank">Git Bash</a>):

    <div class="termy">

    ```console
    $ source ./env/Scripts/activate
    ```

    </div>

Para verificar se funcionou, use:

=== "Linux, macOS, Windows Bash"

    <div class="termy">

    ```console
    $ which pip

    some/directory/fastapi/env/bin/pip
    ```

    </div>

=== "Windows PowerShell"

    <div class="termy">

    ```console
    $ Get-Command pip

    some/directory/fastapi/env/bin/pip
    ```

    </div>

Se ele exibir o bin√°rio `pip` em `env/bin/pip` ent√£o funcionou. üéâ



!!! tip
    Toda vez que voc√™ instalar um novo pacote com `pip` nesse ambiente, ative o ambiente novamente.

    Isso garante que se voc√™ usar um programa instalado por aquele pacote, voc√™ utilizar√° aquele de seu ambiente local e n√£o outro que possa estar instalado globalmente.

### pip

Ap√≥s ativar o ambiente como descrito acima:

<div class="termy">

```console
$ pip install -r requirements.txt

---> 100%
```

</div>

Isso ir√° instalar todas as depend√™ncias e seu FastAPI local em seu ambiente local.

#### Usando seu FastAPI local

Se voc√™ cria um arquivo Python que importa e usa FastAPI, e roda com Python de seu ambiente local, ele ir√° utilizar o c√≥digo fonte de seu FastAPI local.

E se voc√™ atualizar o c√≥digo fonte do FastAPI local, como ele √© instalado com `-e`, quando voc√™ rodar aquele arquivo Python novamente, ele ir√° utilizar a nova vers√£o do FastAPI que voc√™ acabou de editar.

Desse modo, voc√™ n√£o tem que "instalar" sua vers√£o local para ser capaz de testar cada mudan√ßa.

### Formato

Tem um arquivo que voc√™ pode rodar que ir√° formatar e limpar todo o seu c√≥digo:

<div class="termy">

```console
$ bash scripts/format.sh
```

</div>

Ele ir√° organizar tamb√©m todos os seus imports.

Para que ele organize os imports corretamente, voc√™ precisa ter o FastAPI instalado localmente em seu ambiente, com o comando na se√ß√£o acima usando `-e`.

### Formato dos imports

Tem outro _script_ que formata todos os imports e garante que voc√™ n√£o tenha imports n√£o utilizados:

<div class="termy">

```console
$ bash scripts/format-imports.sh
```

</div>

Como ele roda um comando ap√≥s o outro, modificando e revertendo muitos arquivos, ele demora um pouco para concluir, ent√£o pode ser um pouco mais f√°cil utilizar `scripts/format.sh` frequentemente e `scripts/format-imports.sh` somente ap√≥s "commitar uma branch".

## Documenta√ß√£o

Primeiro, tenha certeza de configurar seu ambiente como descrito acima, isso ir√° instalar todas as requisi√ß√µes.

A documenta√ß√£o usa <a href="https://www.mkdocs.org/" class="external-link" target="_blank">MkDocs</a>.

E existem ferramentas/_scripts_ extras para controlar as tradu√ß√µes em `./scripts/docs.py`.

!!! tip
    Voc√™ n√£o precisa ver o c√≥digo em `./scripts/docs.py`, voc√™ apenas o utiliza na linha de comando.

Toda a documenta√ß√£o est√° no formato Markdown no diret√≥rio `./docs/pt/`.

Muitos dos tutoriais tem blocos de c√≥digo.

Na maioria dos casos, esse blocos de c√≥digo s√£o aplica√ß√µes completas que podem ser rodadas do jeito que est√£o apresentados.

De fato, esses blocos de c√≥digo n√£o est√£o escritos dentro do Markdown, eles s√£o arquivos Python dentro do diret√≥rio `./docs_src/`.

E esses arquivos Python s√£o inclu√≠dos/injetados na documenta√ß√£o quando se gera o site.

### Testes para Documenta√ß√£o

A maioria dos testes na verdade rodam encima dos arquivos fonte na documenta√ß√£o.

Isso ajuda a garantir:

* Que a documenta√ß√£o esteja atualizada.
* Que os exemplos da documenta√ß√£o possam ser rodadas do jeito que est√£o apresentadas.
* A maior parte dos recursos √© coberta pela documenta√ß√£o, garantida por cobertura de testes.

Durante o desenvolvimento local, existe um _script_ que constr√≥i o site e procura por quaisquer mudan√ßas, carregando na hora:

<div class="termy">

```console
$ python ./scripts/docs.py live

<span style="color: green;">[INFO]</span> Serving on http://127.0.0.1:8008
<span style="color: green;">[INFO]</span> Start watching changes
<span style="color: green;">[INFO]</span> Start detecting changes
```

</div>

Isso ir√° servir a documenta√ß√£o em `http://127.0.0.1:8008`.

Desse jeito, voc√™ poder√° editar a documenta√ß√£o/arquivos fonte e ver as mudan√ßas na hora.

#### Typer CLI (opcional)

As instru√ß√µes aqui mostram como utilizar _scripts_ em `./scripts/docs.py` com o programa `python` diretamente.

Mas voc√™ pode usar tamb√©m <a href="https://typer.tiangolo.com/typer-cli/" class="external-link" target="_blank">Typer CLI</a>, e voc√™ ter√° auto-completa√ß√£o para comandos no seu terminal ap√≥s instalar o _completion_.

Se voc√™ instalou Typer CLI, voc√™ pode instalar _completion_ com:

<div class="termy">

```console
$ typer --install-completion

zsh completion installed in /home/user/.bashrc.
Completion will take effect once you restart the terminal.
```

</div>

### Aplica√ß√µes e documenta√ß√£o ao mesmo tempo

Se voc√™ rodar os exemplos com, por exemplo:

<div class="termy">

```console
$ uvicorn tutorial001:app --reload

<span style="color: green;">INFO</span>:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

</div>

como Uvicorn utiliza por padr√£o a porta `8000`, a documenta√ß√£o na porta `8008` n√£o dar√° conflito.

### Tradu√ß√µes

Ajuda com tradu√ß√µes √â MUITO apreciada! E essa tarefa n√£o pode ser conclu√≠da sem a ajuda da comunidade. üåé üöÄ

Aqui est√£o os passos para ajudar com as tradu√ß√µes.

#### Dicas e orienta√ß√µes

* Verifique sempre os <a href="https://github.com/tiangolo/fastapi/pulls" class="external-link" target="_blank">_pull requests_ existentes</a> para a sua linguagem e fa√ßa revis√µes das altera√ß√µes e aprove elas.

!!! tip
    Voc√™ pode <a href="https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/commenting-on-a-pull-request" class="external-link" target="_blank">adicionar coment√°rios com sugest√µes de altera√ß√µes</a> para _pull requests_ existentes.

    Verifique as documenta√ß√µes sobre <a href="https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-request-reviews" class="external-link" target="_blank">adicionar revis√£o ao _pull request_</a> para aprova√ß√£o ou solicita√ß√£o de altera√ß√µes.

* Verifique em <a href="https://github.com/tiangolo/fastapi/issues" class="external-link" target="_blank">_issues_</a> para ver se existe algu√©m coordenando tradu√ß√µes para a sua linguagem.

* Adicione um √∫nico _pull request_ por p√°gina traduzida. Isso tornar√° muito mais f√°cil a revis√£o para as outras pessoas.

Para as linguagens que eu n√£o falo, vou esperar por v√°rias pessoas revisarem a tradu√ß√£o antes de _mergear_.

* Voc√™ pode verificar tamb√©m se h√° tradu√ß√µes para sua linguagem e adicionar revis√£o para elas, isso ir√° me ajudar a saber que a tradu√ß√£o est√° correta e eu possa _mergear_.

* Utilize os mesmos exemplos Python e somente traduza o texto na documenta√ß√£o. Voc√™ n√£o tem que alterar nada no c√≥digo para que funcione.

* Utilize as mesmas imagens, nomes de arquivo e links. Voc√™ n√£o tem que alterar nada disso para que funcione.

* Para verificar o c√≥digo de duas letras para a linguagem que voc√™ quer traduzir, voc√™ pode usar a <a href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes" class="external-link" target="_blank">Lista de c√≥digos ISO 639-1</a>.

#### Linguagem existente

Vamos dizer que voc√™ queira traduzir uma p√°gina para uma linguagem que j√° tenha tradu√ß√µes para algumas p√°ginas, como o Espanhol.

No caso do Espanhol, o c√≥digo de duas letras √© `es`. Ent√£o, o diret√≥rio para tradu√ß√µes em Espanhol est√° localizada em `docs/es/`.

!!! tip
    A principal ("oficial") linguagem √© o  Ingl√™s, localizado em `docs/en/`.

Agora rode o _servidor ao vivo_ para as documenta√ß√µes em Espanhol:

<div class="termy">

```console
// Use o comando "live" e passe o c√≥digo da linguagem como um argumento de linha de comando
$ python ./scripts/docs.py live es

<span style="color: green;">[INFO]</span> Serving on http://127.0.0.1:8008
<span style="color: green;">[INFO]</span> Start watching changes
<span style="color: green;">[INFO]</span> Start detecting changes
```

</div>

Agora voc√™ pode ir em <a href="http://127.0.0.1:8008" class="external-link" target="_blank">http://127.0.0.1:8008</a> e ver suas mudan√ßas ao vivo.

Se voc√™ procurar no site da documenta√ß√£o do FastAPI, voc√™ ver√° que toda linguagem tem todas as p√°ginas. Mas algumas p√°ginas n√£o est√£o traduzidas e tem notifica√ß√£o sobre a falta da tradu√ß√£o.

Mas quando voc√™ rodar localmente como descrito acima, voc√™ somente ver√° as p√°ginas que j√° est√£o traduzidas.

Agora vamos dizer que voc√™ queira adicionar uma tradu√ß√£o para a se√ß√£o  [Recursos](features.md){.internal-link target=_blank}.

* Copie o arquivo em:

```
docs/en/docs/features.md
```

* Cole ele exatamente no mesmo local mas para a linguagem que voc√™ quer traduzir, por exemplo:

```
docs/es/docs/features.md
```

!!! tip
    Observe que a √∫nica mudan√ßa na rota √© o c√≥digo da linguagem, de `en` para `es`.

* Agora abra o arquivo de configura√ß√£o MkDocs para Ingl√™s em:

```
docs/en/docs/mkdocs.yml
```

* Procure o lugar onde `docs/features.md` est√° localizado no arquivo de configura√ß√£o. Algum lugar como:

```YAML hl_lines="8"
site_name: FastAPI
# Mais coisas
nav:
- FastAPI: index.md
- Languages:
  - en: /
  - es: /es/
- features.md
```

* Abra o arquivo de configura√ß√£o MkDocs para a linguagem que voc√™ est√° editando, por exemplo:

```
docs/es/docs/mkdocs.yml
```

* Adicione no mesmo local que est√° no arquivo em Ingl√™s, por exemplo:

```YAML hl_lines="8"
site_name: FastAPI
# Mais coisas
nav:
- FastAPI: index.md
- Languages:
  - en: /
  - es: /es/
- features.md
```

Tenha certeza que se existem outras entradas, a nova entrada com sua tradu√ß√£o esteja exatamente na mesma ordem como na vers√£o em Ingl√™s.

Se voc√™ for no seu navegador ver√° que agora a documenta√ß√£o mostra sua nova se√ß√£o. üéâ

Agora voc√™ poder√° traduzir tudo e ver como est√° toda vez que salva o arquivo.

#### Nova linguagem

Vamos dizer que voc√™ queira adicionar tradu√ß√µes para uma linguagem que ainda n√£o foi traduzida, nem sequer uma p√°gina.

Vamos dizer que voc√™ queira adicionar tradu√ß√£o para Haitiano, e ainda n√£o tenha na documenta√ß√£o.

Verificando o link acima, o c√≥digo para "Haitiano" √© `ht`.

O pr√≥ximo passo √© rodar o _script_ para gerar um novo diret√≥rio de tradu√ß√£o:

<div class="termy">

```console
// Use o comando new-lang, passe o c√≥digo da linguagem como um argumento de linha de comando
$ python ./scripts/docs.py new-lang ht

Successfully initialized: docs/ht
Updating ht
Updating en
```

</div>

Agora voc√™ pode verificar em seu editor de c√≥digo o mais novo diret√≥rio criado `docs/ht/`.

!!! tip
    Crie um primeiro _pull request_ com apenas isso, para iniciar a configura√ß√£o da nova linguagem, antes de adicionar tradu√ß√µes.

    Desse modo outros poder√£o ajudar com outras p√°ginas enquanto voc√™ trabalha na primeira. üöÄ

Inicie traduzindo a p√°gina principal, `docs/ht/index.md`.

Ent√£o voc√™ pode continuar com as instru√ß√µes anteriores, para uma "Linguagem Existente".

##### Nova linguagem n√£o suportada

Se quando rodar o _script_ do _servidor ao vivo_ voc√™ pega um erro sobre linguagem n√£o suportada, alguma coisa como:

```
 raise TemplateNotFound(template)
jinja2.exceptions.TemplateNotFound: partials/language/xx.html
```

Isso significa que o tema n√£o suporta essa linguagem (nesse caso, com um c√≥digo falso de duas letras `xx`).

Mas n√£o se preocupe, voc√™ pode configurar o tema de linguagem para Ingl√™s e ent√£o traduzir o conte√∫do da documenta√ß√£o.

Se voc√™ precisar fazer isso, edite o `mkdocs.yml` para sua nova linguagem, teremos algo como:

```YAML hl_lines="5"
site_name: FastAPI
# Mais coisas
theme:
  # Mais coisas
  language: xx
```

Altere essa linguagem de `xx` (do seu c√≥digo de linguagem) para `en`.

Ent√£o voc√™ poder√° iniciar novamente o _servidor ao vivo_.

#### Pr√©-visualize o resultado

Quando voc√™ usa o _script_ em `./scripts/docs.py` com o comando `live` ele somente exibe os arquivos e tradu√ß√µes dispon√≠veis para a linguagem atual.

Mas uma vez que voc√™ tenha conclu√≠do, voc√™ poder√° testar tudo como se parecesse _online_.

Para fazer isso, primeiro construa toda a documenta√ß√£o:

<div class="termy">

```console
// Use o comando "build-all", isso lever√° um tempinho
$ python ./scripts/docs.py build-all

Updating es
Updating en
Building docs for: en
Building docs for: es
Successfully built docs for: es
Copying en index.md to README.md
```

</div>

Isso gera toda a documenta√ß√£o em `./docs_build/` para cada linguagem. Isso inclui a adi√ß√£o de quaisquer arquivos com tradu√ß√£o faltando, com uma nota dizendo que "esse arquivo ainda n√£o tem tradu√ß√£o". Mas voc√™ n√£o tem que fazer nada com esse diret√≥rio.

Ent√£o ele constr√≥i todos aqueles _sites_ independentes MkDocs para cada linguagem, combina eles, e gera a sa√≠da final em `./site/`.

Ent√£o voc√™ poder√° "servir" eles com o comando `serve`:

<div class="termy">

```console
// Use o comando "serve" ap√≥s rodar "build-all"
$ python ./scripts/docs.py serve

Warning: this is a very simple server. For development, use mkdocs serve instead.
This is here only to preview a site with translations already built.
Make sure you run the build-all command first.
Serving at: http://127.0.0.1:8008
```

</div>

## Testes

Tem um _script_ que voc√™ pode rodar localmente para testar todo o c√≥digo e gerar relat√≥rios de cobertura em HTML:

<div class="termy">

```console
$ bash scripts/test-cov-html.sh
```

</div>

Esse comando gera um diret√≥rio `./htmlcov/`, se voc√™ abrir o arquivo `./htmlcov/index.html` no seu navegador, poder√° explorar interativamente as regi√µes de c√≥digo que est√£o cobertas pelos testes, e observar se existe alguma regi√£o faltando.

### Testes no seu editor

Se voc√™ quer usar os testes integrados em seu editor adicione `./docs_src` na sua vari√°vel `PYTHONPATH`.

Por exemplo, no VS Code voc√™ pode criar um arquivo `.env` com:

```env
PYTHONPATH=./docs_src
```
